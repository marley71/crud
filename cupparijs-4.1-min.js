function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Log(e,t){this.mobile=t,this.enable=function(){this.mobile?(Log.prototype.info=console.log.bind(window.console),Log.prototype.debug=console.log.bind(window.console),Log.prototype.warn=console.log.bind(window.console),Log.prototype.error=console.error.bind(window.console)):(Log.prototype.info=console.info.bind(window.console),Log.prototype.debug=console.debug.bind(window.console),Log.prototype.warn=console.warn.bind(window.console),Log.prototype.error=console.error.bind(window.console))},this.disable=function(){Log.prototype.info=function(){},Log.prototype.debug=function(){},Log.prototype.warn=function(){},Log.prototype.error=function(){}},e?this.enable():this.disable()}function GMapMarker(){this.id=null,this.address="",this.txt="",this.lat=null,this.lng=null,this.title="",this.icon=null,this.labelClass=null,this.labelAnchor=null,this.labelContent=null,this.googlem=null,this.draggable=!1,this.click_callback=null,this.mouseover_callback=null,this.mouseout_callback=null,this.data=null,this.infoWindow=null,this.route_address=""}function GMap(objName,mapOptions){var self=this;this.markerLabel=!1,this.markerLabelScript="",this.gmap=null,this.geocoder=null,this.centerAddress=null,this.lat=42,this.lng=13,this.zoom=6,this.elementId="map_canvas",this.objName=objName,this.markers=[],this.areas=[],this.current=0,this.delay=1e3,this.infowindowprec=null,this.mapTypeId="ROADMAP",this.directionsService=null,this.directionsDisplay=null,this.directionsPanelId=null,this.language="it",this.queuedMarker=[],this.mapOptions=mapOptions?mapOptions:{},this.apiKey=null,this.version=null,this.showQueued=function(e,t){e=e?e:function(){},t=t?t:function(){};var a=this,n=function l(){if(a.app.log.info("_showQueued "+a.queuedMarker.length),a.queuedMarker.length>0){var t=a.queuedMarker.pop();a.geocoder.geocode({address:t.address},function(e,n){if(e){var r=!1;if(jQuery.each(e,function(e,i){if(n==google.maps.GeocoderStatus.OK){var o=new google.maps.LatLng(i.geometry.location.lat(),i.geometry.location.lng());t.lat=i.geometry.location.lat(),t.lng=i.geometry.location.lng(),a.showAddressByPoint(o,t),r=!0}}),!r){var i=new google.maps.LatLng(t.lat,t.lng);a.showAddressByPoint(i,t)}}else{var i=new google.maps.LatLng(t.lat,t.lng);a.showAddressByPoint(i,t)}setTimeout(function(){l()},a.delay)})}else e()};this.app.log.info("GMap.showQueued ",a.markers);for(var r in a.markers){var i=a.markers[r];if(null==i.googlem)if(i.lat&&i.lng){var o=new google.maps.LatLng(i.lat,i.lng);a.showAddressByPoint(o,i)}else if(""!=i.address)a.queuedMarker.push(i);else{var o=new google.maps.LatLng(a.lat,a.lng);a.showAddressByPoint(o,i)}}return 0==a.queuedMarker.length?e():void n()},this.updateMarkerAddress=function(e,t,a){a=a?a:function(){},self.geocoder.geocode({address:t},function(t,n){if(n==google.maps.GeocoderStatus.ZERO_RESULTS)return a({msg:"Zero risulati",error:1});if(t){var r=0;jQuery.each(t,function(t,a){if(n==google.maps.GeocoderStatus.OK&&!r){r=1;var i=new google.maps.LatLng(a.geometry.location.lat(),a.geometry.location.lng());self.markers[e].lat=a.geometry.location.lat(),self.markers[e].lng=a.geometry.location.lng(),self.markers[e].googlem.setPosition(i),self.updateArea(e)}}),a(r?{msg:"",error:0,pos:self.markers[e].googlem.getPosition()}:{msg:"Error not found ",error:1,pos:{}})}else a({msg:"errore generale",error:1,pos:{},status:n,result:result})})},this._initialize=function(){try{var e=new google.maps.LatLng(self.lat,self.lng),t={zoom:self.zoom,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP};for(var a in self.mapOptions)t[a]=self.mapOptions[a];self.gmap=new google.maps.Map(document.getElementById(self.elementId),t),setTimeout(function(){self.geocoder=new google.maps.Geocoder,self.centerAddress&&self.geocoder.geocode({address:self.centerAddress},function(e,t){e&&jQuery.each(e,function(e,a){if(t==google.maps.GeocoderStatus.OK){var n=new google.maps.LatLng(a.geometry.location.lat(),a.geometry.location.lng());self.gmap.setCenter(n)}})});var e={map:self.gmap,suppressMarkers:!0,preserveViewport:!0};self.directionsDisplay=new google.maps.DirectionsRenderer(e),self.directionsPanelId&&self.directionsDisplay.setPanel(document.getElementById(self.directionsPanelId)),google.maps.event.addListener(self.gmap,"zoom_changed",function(){self.zoom_changed()}),google.maps.event.addListener(self.gmap,"bounds_changed",function(e){self.bounds_changed(e)}),self.afterInitialize()},500)}catch(n){this.app.log.error(n)}},this.initialize=function(){self.markerLabel?self.loadMarkerWithLabelScript(function(){self._initialize()}):self._initialize()},this.geocodingResults=function(address,callback){self.geocoder.geocode({address:address},function(results,status){eval(callback+"(results)")})},this.getGeocodingResults=function(e,t){self.geocoder.geocode({address:e},function(e,a){t(e,a)})},this.showAddress=function(e,t){self.geocoder.geocode({address:e},function(e,a){jQuery.each(e,function(e,n){if(a==google.maps.GeocoderStatus.OK){var r=new google.maps.LatLng(n.geometry.location.lat(),n.geometry.location.lng());self.showAddressByPoint(r,t)}})})},this.showAddressByPoint=function(e,t){var a=self.getIndexById(t.id);if(a<0)return void alert("errore");var n={map:self.gmap,draggable:t.draggable,animation:google.maps.Animation.DROP,position:e,icon:t.icon,title:t.title,optimized:!1};if(t.icon&&(n.icon=t.icon),null===t.googlem){var r=null;self.markerLabel?(n.icon=" ",n.labelClass=t.labelClass?t.labelClass:"",n.labelAnchor=t.labelAnchor?t.labelAnchor:new google.maps.Point(25,25),n.labelContent=t.labelContent,r=new MarkerWithLabel(n)):r=new google.maps.Marker(n),self.markers[a].googlem=r}else self.markers[a].googlem.setPosition(e),self.markers[a].googlem.setMap(self.gmap);if(self.markers[a].lat=e.lat(),self.markers[a].lng=e.lng(),t.draggable){var i=self.markers[a];google.maps.event.addListener(i.googlem,"dragend",function(){var e=i.googlem.getPosition();i.lat=e.lat(),i.lng=e.lng(),self.updateArea(a),self.markerDragend(e,i)})}if(t.click_callback)google.maps.event.addListener(self.markers[a].googlem,"click",function(){t.click_callback()});else if(""!=t.txt){var o=new google.maps.InfoWindow({content:t.txt,maxWidth:250});t.infoWindow=o,google.maps.event.addListener(self.markers[a].googlem,"click",function(){self.infowindowprec&&self.infowindowprec.close(),o.open(self.gmap,self.markers[a].googlem),self.infowindowprec=o})}t.mouseover_callback&&google.maps.event.addListener(self.markers[a].googlem,"mouseover",function(){t.mouseover_callback()}),t.mouseout_callback&&google.maps.event.addListener(self.markers[a].googlem,"mouseout",function(){t.mouseout_callback()}),self.markerPositionUpdated(t)},this.loadScript=function(){var e=this,t=document.createElement("script");t.type="text/javascript";var a="http://maps.googleapis.com/maps/api/js?key="+e.apiKey;e.version&&(a+="&v="+e.version),a+="&callback="+e.objName+".initialize&language="+e.language,t.src=a,document.body.appendChild(t),e.afterLoadScript()},this.addMarker=function(e){return e.id||(e.id=self.markers.length),self.markers.push(e),self.markers.length},this.afterInitialize=function(){},this.afterLoadScript=function(){},this.deleteMarker=function(e){return self.markers[e]?(null!==self.markers[e].googlem&&(google.maps.event.clearListeners(self.markers[e].googlem,"click"),self.markers[e].googlem.setMap(null)),self.markers.splice(e,1),!0):(this.app.log.warn("indice non trovato "+e),!1)},this.hideMarker=function(e){self.markers[e]&&null!==self.markers[e].googlem&&self.markers[e].googlem.setMap(null)},this.showMarker=function(e){if(self.markers[e]&&null!==self.markers[e].googlem){var t=self.markers[e].googlem;t.setMap(self.gmap),t.setTitle(self.markers[e].title),t.setPosition(new google.maps.LatLng(self.markers[e].lat,self.markers[e].lng)),self.markers[e].infoWindow&&self.markers[e].infoWindow.setContent(self.markers[e].txt)}},this.deleteAllMarkers=function(){for(var e=this,t=0;t<e.markers.length;t++)google.maps.event.clearListeners(e.markers[t].googlem,"click"),e.markers[t].googlem.setMap(null);e.current=0,e.markers=[]},this.updateMarker=function(e,t){if(self.markers[e]&&null!==self.markers[e].googlem)if(t.address)self.current=e,self.showAddress(t.address,self.markers[e]);else{var a=self.markers[e].googlem,n=new google.maps.LatLng(t.lat,t.lng);a.setPosition(n)}},this.hidePath=function(){self.directionsDisplay.setMap(null)},this._showPath=function(e,t,a,n,r){try{n||(n=google.maps.TravelMode.DRIVING),self.directionsService||(self.directionsService=new google.maps.DirectionsService),self.directionsPanelId&&self.directionsDisplay.setPanel(document.getElementById(self.directionsPanelId)),self.hidePath();var i=self.markers[e].googlem.position,o=self.markers[t].googlem.position,l=[];for(var d in a)l.push({location:a[d],stopover:!0});var u={origin:i,destination:o,travelMode:n,waypoints:l};self.directionsService.route(u,function(e,t){switch(self.app.log("DIRECTIONSERVICE",e,t),t){case google.maps.DirectionsStatus.OK:self.directionsDisplay.setMap(self.gmap),self.directionsDisplay.setDirections(e);var a=e.routes[0].legs.length;for(var n in e.routes[0].legs)self.markers[n].route_address=e.routes[0].legs[n].start_address;self.markers[a].route_address=e.routes[0].legs[a-1].end_address;break;default:jQuery(self.directionsDisplay.getPanel()).html(jQuery.translate("percorso_non_trovato"));for(var n in self.markers)self.markers[n].route_address=null}r({msg:"",error:0,response:e})})}catch(s){this.app.log.error(s.message),r({msg:s.message,error:1,response:[]})}},this.showPath=function(e,t,a,n){self._showPath(e,t,[],a,function(e){n&&n(e)})},this.showPaths=function(e,t,a,n,r){self._showPath(e,t,a,n,function(e){r&&r(e)})},this.showArea=function(e){var t=this;t.hideArea();for(var a=0;a<t.markers.length;a++){console.log(t.markers[a]);var n=new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:t.gmap,center:{lat:t.markers[a].lat,lng:t.markers[a].lng},radius:e.raggio});t.areas.push(n)}},this.hideArea=function(){for(var e=this,t=0;t<e.areas.length;t++)e.areas[t].setMap(null);e.areas=[]},this.updateArea=function(e){var t=this;e<t.areas.length&&t.areas[e].setCenter({lat:t.markers[e].lat,lng:t.markers[e].lng})},this.getMarker=function(e){return e<self.markers.length?self.markers[e]:null},this.getIndexById=function(e){for(var t=0;t<self.markers.length;t++)if(self.markers[t].id==e)return t;return-1},this.getMarkerById=function(e){var t=self.getIndexById(e);return self.getMarker(t)},this.markerToCenter=function(e){if(e>=self.markers.length)return void log.warn("index:"+e+" out of range, size:"+self.markers.length);if(self.markers[e].googlem)var t=self.markers[e].googlem.position;else var t=new google.maps.LatLng(self.markers[e].lat,self.markers[e].lng);self.gmap.setCenter(t)},this.setCenter=function(e,t){var a=new google.maps.LatLng(e,t);self.gmap.setCenter(a)},this.setCenterToMarkers=function(e){for(var t=new google.maps.LatLngBounds,a=!1,n=0;n<self.markers.length;n++)null!==self.markers[n].googlem?self.markers[n].googlem.getMap()&&(t.extend(self.markers[n].googlem.getPosition()),a=!0):log.warn("google pointer null with index:"+n);a&&(zoomChangeBoundsListener=google.maps.event.addListener(self.gmap,"bounds_changed",function(t){e&&self.gmap.getZoom()>e&&self.gmap.setZoom(e),google.maps.event.removeListener(zoomChangeBoundsListener)}),self.gmap.fitBounds(t))},this.loadMarkerWithLabelScript=function(e){var t=document.createElement("script");t.src=self.markerLabelScript,t.async=!0,t.onreadystatechange=t.onload=function(){console.log("LOAD SCRIPT",t.readyState);t.readyState;e()},document.getElementsByTagName("head")[0].appendChild(t)},this.zoom_changed=function(){},this.showMarkersEnd=function(){},this.markerDragend=function(e,t){},this.markerPositionUpdated=function(e){},this.bounds_changed=function(e){}}function App(){var e={},t={},a=["list","search","edit","view","calendar","csv"],n=0,r={},i={},o=null;App.resources=[],App.pluginsPath="/cupparis4/plugins/",App.log=null,App.show_log=!1,App.mobile=!1,App.getResources=function(){return e},App.init=function(e,t){var a=this,n=e?e:{};for(var r in n)a[r]=n[r];o=new Log(this.showLog,this.mobile),this.showLog&&o.enable(),this.log=o,Route.prototype.app=this,Render.prototype.app=this,View.prototype.app=this,Dashboard.prototype.app=this,Action.prototype.app=this,Template.prototype.app=this,Modal.prototype.app=this,jQuery.app=this,EventManager.on("loadResource",function(e){e.preventDefault(),a.loadResource(e.params.resource,e.callback)}),EventManager.on("loadResources",function(e){e.preventDefault(),a.loadResources(e.params.resources,e.callback)}),h();var i=t?t:function(){};App.loadResources(App.resources,i)},App.loadResource=function(e,t){var a=this,n=t?t:function(){};if(!e)return a.log.warn("App.loadResorce fileName non definito!"),void n();var r=/(?:\.([^.]+))?$/,i=r.exec(e)[1];if("js"==i)m(a.pluginsPath+e,n);else{if("css"!=i)throw"invalid extension "+i+" del filename "+e;f(a.pluginsPath+e,n)}},App.loadResources=function(e,t){var a=this,n=t?t:function(){};if(!e||0==e.length)return void n();var r=function i(t){a.loadResource(e[t],function(){return t<e.length-1?void i(t+1):void n()})};r(0)},App.addView=function(e){var t=this;if(t.log.debug("App.addView",e),!e.modelName)throw"Invalid model Name";if(!window[e.viewClass])throw"View Class name "+e.viewClass+" not definited!";var o=new window[e.viewClass](e);if(!o.type||jQuery.inArray(o.type,a)<0)throw"view type "+o.type+" not supported";var l="v"+n;return o.setId(l),o.setActionListener(),t.log.debug("constraint ",e.constraint),r[l]=o,e.id&&(i[e.id]=l),t.log.debug("addView "+l,r[l]),n++,e.autorender&&t.renderView(l),l},App.addDashboard=function(e){},App.connectView=function(e,t){var a=t.action;r[e].connected_view[a]||(r[e].connected_view[a]=[]),r[e].connected_view[a].push(t)},App.renderViews=function(){var e=this;for(var t in r)e.renderView(t)},App.renderView=function(e,t){var a=t?t:function(){};r[e].show(a)},App.getView=function(e){return r[e]},App.getViews=function(){return r},App.getKeyFromId=function(e){return i[e]},App.removeViewById=function(e){return this.removeView(this.getKeyFromId(e))},App.removeAllViews=function(){var e=this;for(var t in r)e.removeView(t);r={},n=0},App.removeView=function(e){for(var t in i)if(e==i[t]){delete i[t];break}var a=r[e];return a?(a["delete"](),void delete r[e]):void self.log.warn("App.removeView con key "+e+" non trovata!")},App.renderViewById=function(e,t){this.renderView(this.getKeyFromId(e),t)},App.getViewById=function(e){return this.getView(this.getKeyFromId(e))},App.getHtmlConf=function(e){var t=this,a=e.attr("data-view"),n={};$.each(e[0].attributes,function(){this.specified&&(n[Utility.camelCase(this.name)]=this.value)}),"false"===Utility.lowerCase(n.autorender)?n.autorender=!1:n.autorender=!0;var r=null;r=n.conf?new window[n.conf]:this.getConf(n.modelName,a,n.role),r.container=e;for(var i in n)r[i]=n[i];return r.viewClass||(r.viewClass=Utility.pascalCase("view_"+a)),t.log.debug("Created view options ",r),r},App.parse=function(e){var t=this,a=e?e:"body";t.log.debug("App.parse "+a,jQuery(a).length);var n=[],r=[];return jQuery.each(jQuery(a).find("[data-view]"),function(){var e=t.getHtmlConf(jQuery(this));console.log("CONF",e);var a=t.addView(e);r.push(a),n.push(jQuery(this).data("view")+" "+jQuery(this).attr("model_name"))}),t.log.debug("founds ",n),r},App.createModal=function(e,t,a){t.autorender=!0,t.container="#generalDialog .modal-body";var n=app.addView(t);return jQuery.generalDialog(null,{title:e,hide_buttons:!0}),jQuery("#generalDialog").on("hidden.bs.modal",function(){app.removeView(n),a&&a()}),n},App.dashboardModal=function(e,t){e.container="#generalDialog .modal-body";var a=new(window[Utility.pascalCase(e.className)])(e);a.show(),jQuery.generalDialog(null,{title:e.title,hide_buttons:!0}),jQuery("#generalDialog").on("hidden.bs.modal",function(){t&&t()})},App.getConf=function(e,t,a){var n=this,r="Model_"+Utility.pascalCase(e);if(a&&!p(e,t,a))throw"Model_"+Utility.pascalCase(e)+Utility.pascalCase(a)+" Class not found!";if(n.role&&p(e,t,n.role)&&(r+=n.role?Utility.pascalCase(n.role):""),n.log.debug("checking configuration action "+t+" for  "+e+" className "+r),window[r]&&window[r][t])return new window[r][t];if("insert"==t&&window[r]&&window[r].edit){var i=new window[r].edit;return i.viewClass="ViewInsert",i}return Conf.factory(t)},App.translate=function(e,t,a){return v(e,t,a)},App.translateIfExist=function(e,t,a){return jQuery.langDefs[e]?this.translate(e,t,a):""},App.waitStart=function(e,t){return t?void jQuery(t).fadeTo("slow",.3).css("pointer-events","none").css("cursor","wait"):(e&&jQuery("#wait").find("[data-msg]").html(e),jQuery("#wait").removeClass("hide"),void jQuery("#wait").css("cursor","wait"))},App.waitEnd=function(e){return e?void jQuery(e).fadeTo("slow",1).css("cursor","auto").css("pointer-events","auto"):(jQuery("#wait").addClass("hide"),jQuery("#wait").css("cursor","default"),void jQuery("#wait").find("[data-msg]").html(""))};var l=null;App.messageDialog=function(e,t){return l||(l=new MessageModal({labels:jQuery.langDefs})),l.show(e,t),l};var d=null;App.errorDialog=function(e,t){return d||(d=new ErrorModal({labels:jQuery.langDefs})),d.show(e,t),d};var u=null;App.confirmDialog=function(e,t){return u||(u=new ConfirmModal({labels:jQuery.langDefs})),u.show(e,t),u};var s=null;App.customDialog=function(e,t){return s||(s=new CustomModal({labels:jQuery.langDefs})),s.show(e,t),s};var c=null;App.progressDialog=function(e,t){return c||(c=new ProgressModal({labels:jQuery.langDefs})),c.show(e,t),c};var p=function(e,t,a){var n="Model_"+Utility.pascalCase(e)+Utility.pascalCase(a);return!(!window[n]||!window[n][t])||!("insert"!=t||!window[n]||!window[n].edit)},m=function(a,n){var r=App,i=function(){e[a]=!0,t[a]=!0,n&&n()};if(!e[a]){var o=document.getElementsByTagName("body")[0],l=document.createElement("script");return l.type="text/javascript",l.src=a,l.onload=i,l.onerror=function(){r.log.error("cannot load script "+a)},void o.appendChild(l)}n()},f=function(a,n){var r=function(){e[a]=!0,t[a]=!0,n&&n()};if(e[a])return n();var i=document.getElementsByTagName("body")[0],o=document.createElement("link");return o.type="text/css",o.rel="stylesheet",o.href=a,o.onload=r,void i.appendChild(o)},v=function(e,t,a){var n=jQuery.langDefs[e];if(!n)return e;var r=n;if(r.indexOf("|")>=0)if(t>0){var i=r.split("|");r=i.length>t?i[t]:i[0]}else r=r.substr(0,r.indexOf("|"));if(a instanceof Array)for(var o=0;o<a.length;o++)r=r.replace("("+o+")",a[o]);return r},h=function(){jQuery("body").append('<div id="wait" class="overlay hide"><span data-msg style="position:absolute;width:100%;top:50%;text-align:center;color:white"></span></div>')};return App}var _RenderHasmanyUploadA,_Class$extend,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(a){function n(){!e&&this.init&&this.init.apply(this,arguments)}var r=this.prototype;e=!0;var i=new this;e=!1;for(var o in a)i[o]="function"==typeof a[o]&&"function"==typeof r[o]&&t.test(a[o])?function(e,t){return function(){var a=this._super;this._super=r[e];var n=t.apply(this,arguments);return this._super=a,n}}(o,a[o]):a[o];return n.prototype=i,n.prototype.constructor=n,n.extend=arguments.callee,n}}(),TraitTranslate={labels:{},labelsContext:null,setLabel:function(e,t){return this.labels[e]=t,this},setLabels:function(e){return this.labels=e,this},getLabelKeys:function(e){var t=[];return jQuery(e).find("[data-label]").each(function(e){t.push(jQuery(this).attr("data-label"))}),t},_translate:function(e){var t=this,a=t.getLabelKeys(e);for(var n in a){var r=a[n],i=t.labelsContext?t.labelsContext+"."+r:r;t.labels[i]?jQuery(e).find('[data-label="'+r+'"]').html(t.labels[i]):t.labels[r]?jQuery(e).find('[data-label="'+r+'"]').html(t.labels[r]):t.app.translateIfExist(i)?jQuery(e).find('[data-label="'+r+'"]').html(t.app.translateIfExist(i)):t.app.translateIfExist(r)&&jQuery(e).find('[data-label="'+r+'"]').html(t.app.translateIfExist(r))}}};var Component=Class.extend(TraitTranslate),Component=Component.extend({_template:function(){return""},getTemplate:function(){var e=this,t="";return t=_.isFunction(e._template)?e._template():1==jQuery(e._template).length?jQuery(e._template).html():e._template,Component.parseHtml(t)},html:function(){return jQuery(this.container).html()},show:function(e){var t=this,a=e?e:function(){};t._prepareContainer(),t._loadExternalResources(function(){t.beforeRender(function(){t.render(function(){t.afterRender(function(){t.beforeFinalize(function(){t.finalize(function(){t.afterFinalize(function(){return a()})})})})})})})},jQe:function(){return jQuery(this.container)},beforeRender:function(e){return e()},render:function(e){return e()},afterRender:function(e){return e()},beforeFinalize:function(e){return e()},finalize:function(e){return e()},afterFinalize:function(e){return e()},_prepareContainer:function(){var e=this,t=e.getTemplate();e.container?(jQuery(e.container).html(t.html()),t.remove()):e.container=t,e._translate(e.container)},_loadExternalResources:function(e){var t=this;return t.resources&&0!=t.resources.length?(t.app.log.info(t.type+" _loadExternalResources",t.resources),void t.app.loadResources(t.resources,e)):e()}});Component.parseHtml=function(e){var t=document.createElement("div");return jQuery(t).html(jQuery.parseHTML(e)),jQuery(t)},jQuery.queryStringToArray=function(e){var t=new Object;if(!e)return t;for(var a=e.split(/[;&]/),n=0;n<a.length;n++){var r=a[n].split("=");if(r&&2==r.length){var i=unescape(r[0]),o=unescape(r[1]);o=o.replace(/\+/g," "),t[i]=o}}return t},jQuery.fn.serializeAssoc=function(){var e=this.serializeArray(),t={};for(var a in e){var n=e[a].name,r=e[a].value;n.indexOf("[")>=0?(t[n]||(t[n]=[]),t[n].push(r)):t[n]=r}return t;var t};var Utility={_scripts:[],initDate:function(e,t,a){var n="",r=jQuery('input[name="'+e+'"]').val(),i="",o="",l="";""!=r&&(i=r.substring(0,4),o=r.substring(5,7),l=r.substring(8,10));for(var d="",u=jQuery('[data-year="'+e+'"]'),s=jQuery('[data-month="'+e+'"]'),c=jQuery('[data-day="'+e+'"]'),p=1;p<32;p++){var m=Utility.padDate(p,2);l==m&&(d=' selected="selected" '),n+='<option value="'+m+'"'+d+">"+m+"</option>",d=""}c.empty(),c.append(n),d="",n="";var f=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];for(p=1;p<13;p++)m=Utility.padDate(p,2),o==m&&(d=' selected="selected" '),n+='<option value="'+m+'"'+d+">"+f[p-1]+"</option>",d="";s.empty(),s.append(n),n="",d="";var v=t,h=a;for(v&&!isNaN(v)||(v=1901),isNaN(h)&&(h=(new Date).getFullYear()),p=v;p<=h;p++)i==p&&(d=' selected="selected" '),n+='<option value="'+p+'"'+d+">"+p+"</option>",d="";u.empty(),u.append(n)},changeDate:function(e){var t="",a=jQuery('[data-year="'+e+'"]'),n=jQuery('[data-month="'+e+'"]'),r=jQuery('[data-day="'+e+'"]'),i="",o=28;"04"==n.val()||"06"==n.val()||"09"==n.val()||"11"==n.val()?o=30:"02"!=n.val()?o=31:a.val()%4!=0&&a.val()%100!=0||(o=29);for(var l=1;l<=o;l++){var d=Utility.padDate(l,2);r.val()==d&&(i=' selected="selected" '),t+='<option value="'+d+'"'+i+">"+d+"</option>",i=""}var u=r.val();r.empty(),r.append(t),u<=o&&r.val(u);var s=jQuery('input[name="'+e+'"]'),c=s.val().split(" "),p="";c.length>1&&(p=c[1]);var m="";if(""==a.val()||""==n.val()||""==r.val())m="";else var m=a.val()+"-"+n.val()+"-"+r.val();""!=p&&(m+=" "+p),s.val(m)},padDate:function(e,t,a){return e=e.toString(),a||(a="0"),e.length<t?Utility.padDate(a+""+e,t,a):e},toggleCheck:function(e){e.prop("checked",!e.prop("checked"))},isInt:function(e){return!isNaN(e)&&function(e){return(0|e)===e}(parseFloat(e))},dbDate:function(e){var t=e.getFullYear(),a=e.getMonth()+1;return t+="-"+(a>9?a:"0"+a),t+="-"+(e.getDate()>9?e.getDate():"0"+e.getDate()),t+=" "+(e.getHours()>9?e.getHours():"0"+e.getHours()),t+=":"+(e.getMinutes()>9?e.getMinutes():"0"+e.getMinutes()),t+=":"+(e.getSeconds()>9?e.getSeconds():"0"+e.getSeconds())},jsDate:function(e){var t=e.split("-");console.log(t[0],t[1]-1,t[2].substr(0,2));var a=new Date(t[0],t[1]-1,t[2].substr(0,2));return a},formatDate:function(e,t){var a=new Date(Date.parse(e));return isNaN(a.getTime())?"":a.toLocaleDateString(jQuery.locale,jQuery.cupparisDateFormat(t))},getURLParameter:function(e){return Utility.getURLParameterFromString(location.search,e)},getURLParameterFromString:function(e,t){return decodeURIComponent((new RegExp("[?|&]"+t+"=([^&;]+?)(&|#|;|$)").exec(e)||[,""])[1].replace(/\+/g,"%20"))||null},getURLParameterRegexp:function(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null},getAllUrlParams:function(){var e={},t=location.search.split("?");if(2!=t.length)return e;var a=t[1].split("&");for(var n in a){var t=a[n].split("=");if(2==t.length){var r=t[0],i=t[1];r.indexOf("[]")>=0?(e[r]||(e[r]=[]),e[r].push(decodeURIComponent(i))):e[r]=decodeURIComponent(i)}}return e},cloneObj:function(e){return JSON.parse(JSON.stringify(e))},nl2br:function(e){return e.replace(/(?:\r\n|\r|\n)/g,"<br />")},loadScript:function(e,t){var a=this;if(a._scripts[e])t&&t();else{a._scripts[e]=!0;var n=document.getElementsByTagName("body")[0],r=document.createElement("script");r.type="text/javascript",r.src=e,r.onload=t,n.appendChild(r)}},NON_WORD_REGEXP:/[^\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\u0030-\u0039\u00B2\u00B3\u00B9\u00BC-\u00BE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D66-\u0D75\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]+/g,CAMEL_CASE_REGEXP:/([\u0061-\u007A\u00B5\u00DF-\u00F6\u00F8-\u00FF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0561-\u0587\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6\u1FC7\u1FD0-\u1FD3\u1FD6\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6\u1FF7\u210A\u210E\u210F\u2113\u212F\u2134\u2139\u213C\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5E\u2C61\u2C65\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7FA\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A])([\u0041-\u005A\u00C0-\u00D6\u00D8-\u00DE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u0386\u0388-\u038A\u038C\u038E\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E\u213F\u2145\u2183\u2C00-\u2C2E\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA\uFF21-\uFF3A\u0030-\u0039\u00B2\u00B3\u00B9\u00BC-\u00BE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D66-\u0D75\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19])/g,
TRAILING_DIGIT_REGEXP:/([\u0030-\u0039\u00B2\u00B3\u00B9\u00BC-\u00BE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D66-\u0D75\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19])([^\u0030-\u0039\u00B2\u00B3\u00B9\u00BC-\u00BE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D66-\u0D75\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19])/g,sentenceCase:function(e){return null==e?"":String(e).replace(Utility.CAMEL_CASE_REGEXP,"$1 $2").replace(Utility.TRAILING_DIGIT_REGEXP,"$1 $2").replace(Utility.NON_WORD_REGEXP," ").replace(/^ | $/g,"").toLowerCase()},camelCase:function(e){return Utility.sentenceCase(e).replace(/(\d) (?=\d)/g,"$1_").replace(/ (\w)/g,function(e,t){return t.toUpperCase()})},costantCase:function(e){return Utility.snakeCase(e).toUpperCase()},dotCase:function(e){return Utility.sentenceCase(e).replace(/ /g,".")},isLowerCase:function(e){return Utility.lowerCase(e)===e},isUpperCase:function(e){return Utility.upperCase(e)===e},lowerCase:function(e){var t=String.prototype.toLowerCase;return null==e?"":t.call(e)},paramCase:function(e){return Utility.sentenceCase(e).replace(/ /g,"-")},pascalCase:function(e){return Utility.upperCaseFirst(Utility.camelCase(e))},pathCase:function(e){return Utility.sentenceCase(e).replace(/ /g,"/")},snakeCase:function(e){return Utility.sentenceCase(e).replace(/ /g,"_")},swapCase:function(e){if(null==e)return"";for(var t="",a=0;a<e.length;a++){var n=e[a],r=n.toUpperCase();t+=r===n?n.toLowerCase():r}return t},titleCase:function(e){return Utility.sentenceCase(e).replace(/^\w| \w/g,Utility.upperCase)},upperCase:function e(t){var e=String.prototype.toUpperCase;return null==t?"":e.call(t)},upperCaseFirst:function(e){return null==e?"":(e=String(e),e.charAt(0).toUpperCase()+e.substr(1))},getMimetypeIcon:function(e){var t={"default":"fa fa-3x fa-file-o",xls:"fa fa-3x fa-file-excel-o",zip:"fa fa-3x fa-file-archive-o",mp3:"fa fa-3x fa-audio-o",jpg:"fa fa-3x fa-image-o",pdf:"fa fa-3x fa-file-pdf-o"};if(!e)return t["default"];var a=e.split(".").pop();return t[a]?t[a]:t["default"]},test:function(){log.info("test"===Utility.camelCase("test")),log.info("test"===Utility.camelCase("TEST")),log.info("testString"===Utility.camelCase("test string")),log.info("testString"===Utility.camelCase("Test String")),log.info("dotCase"===Utility.camelCase("dot.case")),log.info("pathCase"===Utility.camelCase("path/case")),log.info("version1_2_10"===Utility.camelCase("version 1.2.10")),log.info("version1_21_0"===Utility.camelCase("version 1.21.0")),log.info("testString"===Utility.camelCase("TestString")),log.info("TEST"===Utility.constantCase("test")),log.info("TEST"===Utility.constantCase("TEST")),log.info("TEST_STRING"===Utility.constantCase("test string")),log.info("TEST_STRING"===Utility.constantCase("Test String")),log.info("DOT_CASE"===Utility.constantCase("dot.case")),log.info("PATH_CASE"===Utility.constantCase("path/case")),log.info("TEST_STRING"===Utility.constantCase("TestString"))}};jQuery.locale="it",jQuery.langDefs={},jQuery.createDynamicContainer=function(e){var t="dy_"+(new Date).getTime()+"_"+Math.floor(1e4*Math.random());return jQuery("<div/>",{id:t,"class":"hide"}).appendTo("body"),e?jQuery("#"+t).html(jQuery.getDomTemplate(e).html()):jQuery("#"+t).html(" "),jQuery("#"+t)},jQuery.generalContainer=function(){return jQuery("#general_container")},jQuery.generalContainer.selector=function(){return"#general_container"},jQuery.getDomTemplate=function(e){if("SCRIPT"!=jQuery(e).prop("tagName"))return jQuery(e);var t=jQuery("<div/>");return jQuery(e).children().length?t.html(jQuery(e).children()[0].outerHTML):1==jQuery(e).length?t.html(jQuery(e).html()):jQuery.app.log.error("template not found with id "+e),t},jQuery.cupparisDateFormat=function(e){var t={numeric:{year:"numeric",month:"2-digit",day:"2-digit"},"numeric-time":{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"},"short":{year:"numeric",month:"short",day:"2-digit"},"short-2":{month:"short",day:"2-digit"},medium:{year:"numeric",month:"long",day:"2-digit"},"long":{year:"numeric",month:"long",day:"2-digit",weekday:"long"},"short-time":{hour:"2-digit",minute:"2-digit"},"long-time":{year:"numeric",month:"long",day:"2-digit",weekday:"long",hour:"2-digit",minute:"2-digit",second:"2-digit"},time:{hour:"2-digit",minute:"2-digit",second:"2-digit"},year:{year:"numeric"},"year-month":{year:"numeric",month:"long"}};return t[e]?t[e]:""},jQuery.renderTimeAmount=0,jQuery.renderJson=function(sourceContainer,destContainer,data,father){var getByDotKey=function(e,t){var a=t.split("."),n=e;for(var r in a)n=n[a[r]];return n},renderJsonElement=function renderJsonElement(jQelement,data,counter,length){jQelement.attr("data-debug")&&jQuery.app.log.debug("renderJson DEBUG:","data-attrs",jQelement.data(),"data-param",data,"counter",counter,"length",length);var attrField=jQelement.attr("data-field");try{if("undefined"!==("undefined"==typeof attrField?"undefined":_typeof(attrField))&&attrField!==!1)if(jQelement.data("template")||jQelement.data("self")){var tplId=jQelement.data("template")?jQelement.data("template"):jQelement.data("self"),istanceData=data[jQelement.data("field")];istanceData||(istanceData=data),istanceData instanceof Array?istanceData.length>0&&jQuery.renderJson(tplId,jQelement,istanceData,data):jQuery.renderJson(tplId,jQelement,istanceData,data)}else{var fieldValue=null;if(fieldValue=jQelement.data("totranslate")?data[jQelement.data("field")+"_"+jQuery.locale]:"value"!=jQelement.data("field")||_.isObject(data)&&jQelement.data("field")in data?getByDotKey(data,jQelement.data("field")):data,parseInt(jQelement.data("trim"))>0){var chars=parseInt(jQelement.data("trim"));fieldValue=jQuery.trim(fieldValue),fieldValue.length>chars&&(fieldValue=fieldValue.substring(0,chars)+"...")}if(jQelement.data("date")){var d=new Date(Date.parse(fieldValue));isNaN(d.getTime())&&(d=new Date(parseInt(fieldValue))),fieldValue=isNaN(d.getTime())?"":d.toLocaleDateString($.locale,$.cupparisDateFormat(jQelement.data("date")))}if(jQelement.is("input"))jQelement.attr("value",fieldValue);else if(jQelement.is("select")){if(jQelement.data("source"))try{var source=getByDotKey(data,jQelement.data("source")),source_order=[];source_order=jQelement.data("sourceorder")?getByDotKey(data,jQelement.data("sourceorder")):_.sortBy(_.keys(source),function(e){return e}),jQelement.html("");for(var i=0;i<source_order.length;i++){var v=source_order[i],selected=!1;v==fieldValue&&(selected=!0);var opt=jQuery("<option>").attr({value:v});selected&&opt.attr("selected","selected"),opt.html(source[v]),jQelement.append(opt)}}catch(e){jQuery.app.log.error(e)}else jQelement.find('option[value="'+fieldValue+'"]').attr("selected","selected");console.log("select",jQuery(this).find("option[value="+fieldValue+"]"),fieldValue,jQelement.data("source"))}else jQelement.is("img")?jQelement.attr("src",fieldValue):jQelement.data("append")?jQelement.append(fieldValue):jQelement.data("prepend")?jQelement.prepend(fieldValue):jQelement.html(fieldValue)}if(jQelement.data("onclick")&&(console.log("onclick"),jQelement.attr("onclick",jQelement.data("onclick"))),jQelement.data("href")){var b=eval("with (data) { "+jQelement.data("href")+" }");jQelement.attr("href",b)}if(jQelement.data("id")){var b=eval("with (data) { "+jQelement.data("id")+" }");jQelement.attr("id",b)}if(jQelement.data("remove")){var b=eval("with (data) { Boolean("+jQelement.data("remove")+") }");b&&jQelement.remove()}if(jQelement.data("class")){var b=eval("with (data) { "+jQelement.data("class")+" }");jQelement.attr("class",b)}if(jQelement.data("addclass")){var b=eval("with (data) { "+jQelement.data("addclass")+" }");jQelement.addClass(b)}if(jQelement.data("visible")){var b=eval("with (data) { Boolean("+jQelement.data("visible")+") }");b?jQelement.removeClass("hide"):jQelement.addClass("hide")}if(jQelement.data("attrs")){var s=jQelement.data("attrs"),b=eval("with (data) { var myattrs="+jQelement.data("attrs")+" }");for(var attr in myattrs)attr.indexOf("data-")>=0&&(jQuery.isArray(myattrs[attr])||jQuery.isPlainObject(myattrs[attr]))?jQelement.attr(attr,JSON.stringify(myattrs[attr])):jQelement.attr(attr,myattrs[attr])}if(jQelement.data("html")){var b=eval("with (data) { "+jQelement.data("html")+" }");jQelement.html(b)}if(jQelement.data("source")&&!jQelement.data("field"))try{var source=getByDotKey(data,jQelement.data("source")),source_order=[];source_order=jQelement.data("sourceorder")?getByDotKey(data,jQelement.data("sourceorder")):_.sortBy(_.keys(source),function(e){return e}),jQelement.html("");for(var i=0;i<source_order.length;i++){var v=source_order[i],selected=!1;v==fieldValue&&(selected=!0);var opt=$("<option>").attr({value:v});selected&&opt.attr("selected","selected"),opt.html(source[v]),jQelement.append(opt)}}catch(e){jQuery.app.log.error(e)}if(jQelement.data("video_icon")){var values=data[jQelement.data("video_icon")];"string"==typeof values&&(values=JSON.parse(values));var thumb="";thumb=values.kind&&values.kind.indexOf("youtube")>=0?values.items[0].snippet.thumbnails["default"].url:values[0].thumbnail_small,jQelement.attr("src",thumb)}if(jQelement.data("video_player")){var values=data[jQelement.data("video_player")],mode=jQelement.data("video_mode");"string"==typeof values&&(values=JSON.parse(values));var video_info=null,provider=null;if(values.kind&&values.kind.indexOf("youtube")>=0?(video_info=values.items[0],provider="youtube"):(video_info=json[0],provider="vimeo"),"dialog"==mode){if("youtube"!=provider)return void alert("non implementato");var dialog_data={video_id:video_info.id,provider:"youtube"};console.log(dialog_data),jQuery(jQelement).attr("data-video_dialog_data",JSON.stringify(dialog_data))}else if("youtube"==provider){var url="https://www.youtube.com/v/"+video_info.id,id="dy_"+(new Date).getTime()+"_"+Math.floor(1e4*Math.random());jQuery("<div/>",{id:id,"class":"hide"}).appendTo(jQelement),swfobject.embedSWF(url,id,"100%","100%","9.0.0")}}}catch(e){jQuery.app.log.warn(sourceContainer,destContainer,data,father,jQelement.prop("tagName")),jQuery.app.log.error(e)}},bindEvents=function(e){var t='[data-video_mode="dialog"]';jQuery.each(jQuery(e).find(t),function(){jQuery(this).data("video_mode")&&(jQuery(this).unbind("click"),jQuery(this).click(function(){console.log("click");var e=jQuery(this).data("video_dialog_data");console.log(e);var t="dy_"+(new Date).getTime()+"_"+Math.floor(1e4*Math.random());if(jQuery("<div/>",{id:t,"class":"hide"}).appendTo("#generalDialog .modal-body"),"youtube"==e.provider){console.log("dsadsf");var a="https://www.youtube.com/v/"+e.video_id,n="300px",r="200px",i="9.0.0";swfobject.embedSWF(a,t,n,r,i),jQuery("#generalDialog").modal("show").ok(function(){jQuery("#generalDialog .modal-body").html(""),jQuery("#"+t).remove()}).cancel(function(){jQuery("#generalDialog .modal-body").html(""),jQuery("#"+t).remove()})}}))})},sourceHtml=jQuery.getDomTemplate(sourceContainer).html();jQuery(destContainer).html("");var selectors="[data-field],[data-href],[data-id],[data-visible],[data-attrs],[data-class],[data-self],[data-addclass],";if(selectors+="[data-trim],[data-html],[data-remove],[data-source],[data-video_icon],[data-video_player]",data instanceof Array){var startTime=new Date,tmpDiv=jQuery.createDynamicContainer();for(var k in data)tmpDiv.html(sourceHtml),jQuery.each(tmpDiv.find(selectors),function(){renderJsonElement(jQuery(this),data[k],k,data.length)}),jQuery(destContainer).append(tmpDiv.html());bindEvents(destContainer);var endTime=new Date,timeDiff=endTime-startTime;jQuery.renderTimeAmount+=timeDiff/=1e3}else{var startTime=new Date;jQuery(destContainer).append(sourceHtml),jQuery.each(jQuery(destContainer).find(selectors),function(){renderJsonElement(jQuery(this),data,0,0)}),bindEvents(destContainer);var endTime=new Date,timeDiff=endTime-startTime;jQuery.renderTimeAmount+=timeDiff/=1e3}},jQuery.normalizeTemplate=function(e){var t=[],a=function(e){jQuery("<div/>",{id:"self_"+t.length,"class":"hide"}).appendTo("body");var a=jQuery("#self_"+t.length);return a.html(e),t.push("#"+a.attr("id")),a},n=function r(e){if(0==e.find("[data-self]").length){var t=a(e.html());return e.html(""),e.attr("data-self","#"+t.attr("id")),1}return jQuery.each(e.find("[data-self]"),function(){var e=r(jQuery(this));if(!e){var t=a(jQuery(this).html());jQuery(this).html(""),jQuery(this).attr("data-self","#"+t.attr("id"))}}),0};return 0==jQuery(e).find("[data-self]").length?t:(n(jQuery(e)),t)},jQuery.renderTemplate=function(e,t,a){var n=jQuery.createDynamicContainer(e),r=jQuery.normalizeTemplate("#"+n.attr("id"));jQuery.renderJson("#"+n.attr("id"),t,a);for(var i in r)jQuery(r[i]).remove();n.remove()},jQuery.getTemplate=function(e,t){var a=jQuery.createDynamicContainer();jQuery.renderTemplate(e,"#"+a.attr("id"),t);var n=a.html();return a.remove(),n},jQuery.parseTemplate=function(e,t){var a=this;a._replaceAll=function(e,t,a){if(!e)return"Invalid template source";null===a&&(a="");for(var n=e,r=n.indexOf(t);r!=-1;)n=n.replace(t,a),r=n.indexOf(t);return n};try{jQuery.each(t,function(t,n){e=a._replaceAll(e,"["+t+"]",n)});var n={tagjs:"<script>","/tagjs":"</script>"};jQuery.each(n,function(t,n){e=a._replaceAll(e,"["+t+"]",n)})}catch(r){alert(r.message)}return e},jQuery.fn.autoUpload=function(e){jQuery(this).change(e)},jQuery._msgToString=function(e){console.log("_msgToString",e);var t="No message";return e&&("string"==jQuery.type(e)?t=e:"array"==jQuery.type(e)&&(t=e.join("<br>"))),t},jQuery.getFailMessage=function(e){try{if(jQuery.isProduction)return e.status+" "+e.statusText;var t=e.status+" "+e.statusText+"<br>";return e.responseJSON&&(t+=e.responseJSON.error.message+"<br>",t+="line :"+e.responseJSON.error.line+"<br>",t+=e.responseJSON.error.file),t}catch(a){return""+a}},jQuery.waitDialogClose=function(){var e="#waitDialog";return jQuery(e).modal("hide"),jQuery(e)},jQuery.dialogsOption=function(e){for(var t in e){var a=e[t];a.dialog&&jQuery("#"+a.dialog).find(".modal-title").html(a.options.title)}};var EventManager={};EventManager.trigger=function(e,t,a){var n=a?a:function(){};console.log("trigger",e,t),jQuery.event.trigger({type:e,params:t,callback:n})},EventManager.on=function(e,t){jQuery(document).on(e,function(a){console.log("ON",e),a.preventDefault(),t(a)})},EventManager.off=function(e,t){jQuery(document).off(e)};var Server={};Server.getUrl=function(e){return Server.subdomain?Server.subdomain+e:e},Server.post=function(e,t,a){var n=Server.getUrl(e);jQuery.post(n,t,function(e){a(e)}).fail(function(e){a({error:1,msg:jQuery.getFailMessage(e)})})},Server.get=function(e,t,a){var n=Server.getUrl(e);jQuery.get(n,t,function(e){a(e)}).fail(function(e){a({error:1,msg:jQuery.getFailMessage(e)})})},Server.route=function(e,t){var a=t?t:function(t){log.debug(e.className,t)},n=Server.getUrl(e.getUrl()),r=e.getParams();Server[e.method](n,r,function(e){a(e)})},Server.subdomain=null,Template=Class.extend(TraitTranslate),Template=Template.extend({init:function(e){var t=e?e:{};for(var a in t)this[a]=t[a]},template:function(){return""},html:function t(){var e=this,a=Component.parseHtml(e.template());e._translate(a);var t=a.html();return a.remove(),t}}),Template.factory=function(e,t){var a=e?e:"",n="Template"+Utility.pascalCase(a);if(!window[n])throw"Impossibile trovare la definizione del template "+n;var r=t?t:{};return r.className=n,new window[n](r)},Template.getRenderContainer=function(e){var t=e.find("[data-render]");return 0==t.length?e:t},TemplateLeft=Template.extend({template:function(){return'\n            <div class="view-field clearfix">\n                <div class="col col-sm-12 view-msg" data-label="msg">\n                        \n                </div>\n                <div class="col col-sm-4">\n                    <div class="col col-sm-10">\n            \n                        <label data-html_label data-label="label"></label>\n                    \n                    </div>\n                </div>\n                \n             \n                <div class="col col-sm-8" data-render>\n                        \n                </div>\n                <div class="col col-sm-12">\n                    <small data-label="addedLabel" class="view-addedLabel"></small>\n                </div>\n                <div class="col col-sm-12 view-field-error text-danger" data-label="error">\n                        \n                </div>\n            </div>\n        '}}),TemplateTop=Template.extend({template:function(){return'\n            <div class="view-field clearfix">\n\n\n                <div class="col col-sm-12">\n                    <label data-label="label">\n\n                    </label>\n                </div>\n                <div class="col col-sm-12 view-msg" data-label="msg">\n\n                </div>\n                <div class="col col-sm-12" data-render>\n\n                </div>\n                <div class="col col-sm-12 view-field-error" data-label="error">\n\n                </div>\n            </div>\n        '}}),TemplateNo=Template.extend({template:function(){return'\n            <div class="col col-xs-12" data-render>\n\n            </div>\n        '}}),Modal=Component.extend({container:"body",id:"#coreDialog",body_selector:"[data-body]",_content:"",init:function(e){var t=this;t._prepareContainer()},_prepareContainer:function(){var e=this,t=e.getTemplate();e.container?(jQuery(e.container).append(t.html()),t.remove()):e.container=t,e._translate(e.container)},render:function(e){var t=this;jQuery(t.id).find(t.body_selector).html(t._content);for(var a in t.labels)t.jQe().find('[data-label="'+a+'"]').html(t.labels[a]);return e()},finalize:function(e){return e()},show:function(e,t){var a=this;a._content=e,a.render(function(){a.finalize(function(){var n=jQuery(a.id),r=t?t:{};n.find(a.body_selector).html(e),n.find("[data-button]").unbind("click"),n.find("[data-button]").click(function(){var e=jQuery(this).data("button");r[e]&&r[e](a)}),n.modal("show")})})},hide:function(){var e=this;e.jQe().modal("hide")}}),MessageModal=Modal.extend({id:"#messageDialog",body_selector:"[data-message]",_template:function(){return'\n            <div id="messageDialog" class="modal fade">\n                <div class="modal-dialog">\n        \t    <div class="modal-content">\n        \t      <div class="modal-header">\n        \t        <button data-button="ok" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n        \t        <h4 class="modal-title" data-label="titolo">Informazione</h4>\n        \t      </div>\n        \t      <div class="modal-body">\n        \t\t\t\t<div class="alert alert-info">\n        \t\t\t\t\t<span data-message class="msg">message</span>\n        \t\t\t\t</div>\n        \t      </div>\n        \t      <div class="modal-footer">\n        \t        <button type="button" data-button="ok" class="btn btn-primary" data-dismiss="modal">Chiudi</button>\n        \t\t  </div>\n        \t    </div><!-- /.modal-content -->\n        \t  </div><!-- /.modal-dialog -->\n        \t</div><!-- /.modal -->\n        '}}),ErrorModal=Modal.extend({id:"#errorDialog",body_selector:"[data-message]",_template:function(){return'\n            <div id="errorDialog" class="modal fade">\n                <div class="modal-dialog">\n                    <div class="modal-content ">\n                        <div class="modal-header">\n                            <button data-button="ok" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n                            <h4 class="modal-title">Messaggio Errore</h4>\n                        </div>\n                        <div class="modal-body">\n                            <div class="alert alert-danger">\n                                <span data-message class="msg">Error</span>\n                            </div>\n                        </div>\n                        <div class="modal-footer">\n                            <button data-button="ok" type="button" class="btn btn-primary btok" data-dismiss="modal">Chiudi</button>\n                        </div>\n                    </div><!-- /.modal-content -->\n                </div><!-- /.modal-dialog -->\n            </div><!-- /.modal -->\n\n    '}}),ConfirmModal=Modal.extend({id:"#confirmDialog",body_selector:"[data-message]",_template:function(){return'\n        <div id="confirmDialog" class="modal fade">\n\t\t  <div class="modal-dialog">\n\t\t    <div class="modal-content">\n\t\t      <div class="modal-header">\n\t\t        <button data-button="cancel" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n\t\t        <h4 class="modal-title">Richiesta di Conferma</h4>\n\t\t      </div>\n\t\t      <div class="modal-body">\n\t\t      \t<span data-message class="msg">Sei Sicuro?</span>\n\t\t      </div>\n\t\t      <div class="modal-footer">\n\t\t        <button data-button="ok" type="button" class="btn btn-primary" data-dismiss="modal">Si</button>\n\t\t        <button data-button="cancel" type="button" class="btn btn-primary" data-dismiss="modal">No</button>\n\t\t      </div>\n\t\t    </div><!-- /.modal-content -->\n\t\t  </div><!-- /.modal-dialog -->\n\t\t</div><!-- /.modal -->\n\n    '}}),ProgressModal=Modal.extend({id:"#progressDialog",body_selector:"[data-message]",progress_selector:"[data-progress_bar]",setProgress:function(e){var t=this;t.jQe().find(" .progress").css("width",e+"%"),t.jQe().find(".progress-bar ").text(e+"%")},_template:function(){return'\n        <div id="progressDialog" class="modal fade">\n\t\t  <div class="modal-dialog">\n\t\t    <div class="modal-content">\n\t\t      <div class="modal-header">\n\t\t        <button data-button="cancel" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>\n\t\t        <h4 class="modal-title">Stato richiesta</h4>\n\t\t      </div>\n\t\t      <div class="modal-body">\n\t\t        <div data-message class="msg">Attendi...</div>\n\t\t        <div class="progress progress-striped active">    \n \t\t\t\t    <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="" aria-valuemin="0" aria-valuemax="100" style="width: 100%">\n \t\t\t\t    \n                    </div>\n \t\t\t    </div>\n\t\t      \t\n\t\t      </div>\n\t\t      <div class="modal-footer">\n\t\t        <button data-button="ok" type="button" class="btn btn-primary" data-dismiss="modal">Si</button>\n\t\t        <button data-button="cancel" type="button" class="btn btn-primary" data-dismiss="modal">No</button>\n\t\t      </div>\n\t\t    </div><!-- /.modal-content -->\n\t\t  </div><!-- /.modal-dialog -->\n\t\t</div><!-- /.modal -->\n\n    '}}),CustomModal=Modal.extend({id:"#customDialog",body_selector:"[data-content]",content:function(){return"<div>content<div>"},_template:function(){return'\n        <div id="customDialog" class="modal fade">\n\t\t  <div class="modal-dialog">\n\t\t    <div class="modal-content" data-content>\n\t\t      \n\t\t    </div><!-- /.modal-content -->\n\t\t  </div><!-- /.modal-dialog -->\n\t\t</div><!-- /.modal -->\n\n    '}});var Render=Component.extend({key:null,type:null,className:"Render",templateName:null,template:null,element_selector:"[data-render_element]",control_selector:"[data-render_control]",caption_selector:"[data-render_caption]",operator_selector:"[data-control_operator]",operator:null,value:null,container:null,pluginsPath:"",app:null,resources:[],metadata:{},init:function(e,t){this.key=e,this.attrs(t)},attrs:function a(a){var e=this;if(a){for(var t in a)e[t]=a[t];return e}var a=[];for(var t in window[e.className].prototype)jQuery.inArray(t,["type","_modeRenderFunctionName","_modeFinalizeFunctionName","modes","_modeBeforeFunctionName"])>=0||_.isFunction(e[t])||(_.isObject(e[t])?a.push(t):a.push(t));return a},getJObject:function(){var e=this;return jQuery(e._template())},getHtml:function(){return this.getJObject().outerHTML},triggerEvent:function(e,t,a){EventManager.trigger(e,t,a)},_setHtmlAttributes:function(e){var t=this;for(var a in t.htmlAttributes)e.attr(a,t.htmlAttributes[a])},trigger:function(e){},on:function(e){},change:function(){},clear:function(){throw this.className+": <clear> method must be overloaded "},setMetadata:function(e){this.metadata=e}});Render.VIEW="view",Render.EDIT="edit",Render.SEARCH="search",Render.factory=function(e,t){var a=t?t:{};a.type||(a.type="input"),a.mode||(a.mode="edit");var n=null,r="Render"+Utility.pascalCase(a.type)+Utility.pascalCase(a.mode);if(!window[r])throw"Impossibile trovare la definizione "+r;try{var i=window[r].extend(a);n=new i(e),n.className=r,n.uid=Render.getNewUID()}catch(o){throw self.app.log.error(r,e,a,o),o}return n},Render.tinymceConfig={forced_root_block:""},Render.mymap=null,Render.uid=0,Render.getNewUID=function(){return Render.uid++};var TraitInput={currentValue:null,inputType:"text",type:"input",htmlAttributes:{},setValue:function(e){var t=this;jQuery(t.container).find(t.control_selector).attr("value",e).val(e)},getValue:function(){var e=this;return jQuery(e.container).find(e.control_selector).val()},_attachEvents:function(){var e=this;jQuery(e.container).find(e.control_selector).change(function(){e.currentValue=jQuery(this).val(),e.change()})},clear:function(){jQuery(this.container).find(this.control_selector).val("")}},RenderInputSearch=Render.extend(TraitInput).extend({render:function(){var e=this,t=jQuery(e.container).find(e.control_selector);e._setHtmlAttributes(t),t.attr("type",e.inputType),t.attr("name","s_"+e.key+"[]"),t.attr("value",e.value).attr("placeholder",""),t=jQuery(e.container).find(e.operator_selector),t.attr("name","s_"+e.key+"_operator"),t.attr("value",e.operator)},finalize:function(){var e=this;e._attachEvents()},_template:function(){return'\n            <input data-render_control type="text" class="form-control" placeholder="">\n            <input data-control_operator type="hidden" >\n        '}}),RenderInputEdit=Render.extend(TraitInput).extend({render:function(e){var t=this,a=jQuery(t.container).find(t.control_selector);return a.attr("value",t.value).val(t.value).attr("type",t.inputType).attr("name",t.key).attr("placeholder",""),t._setHtmlAttributes(a),e()},finalize:function(e){var t=this;return t._attachEvents(),e()},_template:function(){return'\n            <input data-render_control type="text" class="form-control" placeholder="">\n        '}}),RenderInputView=Render.extend(TraitInput).extend({render:function(e){var t=this;return jQuery(t.container).find(t.control_selector).html(t.value),e()},_template:function(){return"\n            <span data-render_control></span>\n        "},getValue:function(){return this.value}}),RenderHiddenSearch=RenderInputSearch.extend({inputType:"hidden"}),RenderHiddenEdit=RenderInputEdit.extend({inputType:"hidden"}),RenderHiddenView=RenderInputView.extend({inputType:"hidden",_template:function(){return'\n            <span data-render_control class="hide"></span>\n        '}}),RenderPasswordEdit=RenderInputEdit.extend({inputType:"password"}),RenderText=Render.extend({type:"text",classData:"text",classTemplate:"text",setValue:function(e){var t=this;jQuery(t.container).find(t.control_selector).html(e)},getValue:function(){var e=this;return jQuery(e.container).find(e.control_selector).html()}}),RenderTextEdit=RenderText.extend({render:function(e){var t=this;return t.jQe().find(t.control_selector).html(t.value),e()},_template:function(){return"<span data-render_control></span>"}}),RenderTextSearch=RenderTextEdit.extend({}),RenderTextView=RenderTextEdit.extend({}),RenderTextarea=Render.extend({type:"textarea",classData:"textarea",classTemplate:"textarea",getValue:function(){var e=this;return"view"==e.mode?jQuery(e.container).find(e.control_selector).html():jQuery(e.container).find(e.control_selector).val()}}),RenderTextareaEdit=RenderTextarea.extend({render:function(e){var t=this,a=t.jQe().find(t.control_selector);return a.attr("name",t.key),a.html(t.value),t._setHtmlAttributes(a),e()},_template:function(){return'\n            <textarea data-render_element data-render_control class="form-control" name="" value=""></textarea>\n        '}}),RenderTextareaSearch=RenderTextareaEdit.extend({render:function(e){var t=this,a=t.jQe().find(t.control_selector);return a.attr("name","s_"+t.key+"[]"),a.html(t.value),t._setHtmlAttributes(a),a=t.jQe().find(t.operator_selector),a.attr("name","s_"+t.key+"_operator"),a.attr("value",t.operator),e()},_template:function(){return'\n            <textarea data-render_element data-render_control class="form-control" name="" value=""></textarea>\n            <input data-control_operator type="hidden" >\n        '}}),RenderTextareaView=RenderTextarea.extend({_template:function(){return"\n            <span data-render_control></span>\n        "},render:function(e){var t=this;return t.jQe().find(t.control_selector).html(t.value),e()}}),RenderSelect=Render.extend({type:"select",classData:"select",classTemplate:"select",multiple:!1,metadata:{domainValuesOrder:null,domainValues:{}},operator:null,getValue:function(){var e=this;return"view"==e.mode?e.value:jQuery(e.container).find(e.control_selector).val()},_setData:function(){var e=this,t=e.jQe().find(e.control_selector);e.multiple&&t.attr("multiple","multiple");var a=[];a=e.metadata.domainValuesOrder?e.metadata.domainValuesOrder:_.sortBy(_.keys(e.metadata.domainValues),function(e){return e}),t.html("");for(var n=0;n<a.length;n++){var r=a[n],i=!1;e.multiple?jQuery.inArray(r,e.value)>=0&&(i=!0):r==e.value&&(i=!0);var o=jQuery("<option>").attr({value:r});i&&o.attr("selected","selected"),o.html(e.metadata.domainValues[r]),t.append(o)}t.attr("value",e.value)},setValue:function(e){var t=this;jQuery(t.container).find(t.control_selector).val(e).change()}}),RenderSelectEdit=RenderSelect.extend({render:function(){var e=this;e._setData();var t=e.jQe().find(e.control_selector),a=e.key,n=e.key.indexOf("[]")>0?e.key.slice(0,-2)+"_exists[]":e.key+"_exists";e.multiple&&(a+="[]"),t.attr("name",a),jQuery("<input>").attr({type:"hidden",name:n,value:1}).appendTo(e.jQe())},finalize:function(){var e=this;jQuery(e.container).find(e.control_selector).change(function(){e.change(jQuery(this).val())})},_template:function(){return'<select data-render_control class="form-control" ></select>'}}),RenderSelectSearch=RenderSelectEdit.extend({render:function(e){var t=this;t._setData();var a=t.jQe().find(t.control_selector);return a.attr("name","s_"+t.key+"[]"),jQuery("<input>").attr({type:"hidden",name:"s_"+t.key+"_operator","data-control_operator":t.key,value:t.operator}).appendTo(t.jQe()),e()}}),RenderSelectView=RenderSelectEdit.extend({render:function(e){var t=this;return t._setData(),e()},finalize:function(e){var t=this;return jQuery(t.container).find(t.control_selector).prop("disabled","disabled"),
e()}}),RenderRadio=Render.extend({type:"radio",classData:"radio",classTemplate:"radio",operator:null,metadata:{domainValuesOrder:null,domainValues:null},getValue:function(){var e=this;return"view"==e.mode?e.value:jQuery(e.container).find('[type="radio"]:checked').val()},clear:function(){var e=this;jQuery(e.container).find("input:checked").prop("checked",!1)},beforeRender:function(e){var t=this;return t.metadata.domainValues&&0!=Object.keys(t.metadata.domainValues).length||(t.metadata.domainValues={1:"Si",0:"No"},t.app.log.warn("RenderChoice "+t.key+" no domainValues found use default",t.metadata.domainValues)),e()},_setData:function(e){for(var t=this,a=(t.jQe().find(t.element_selector),t._orderValues()),n=jQuery("<div>"),r=0;r<a.length;r++)n.append(t.jQe().html());for(var i=t.value?t.value:null==t.value&&"checkbox"==t.choiceType?[]:t.value,r=0;r<a.length;r++){var o=""+a[r],l=!1;o==i&&(l=!0);var d=jQuery(n.find(t.element_selector).get(r));d.find(t.control_selector).attr("name",e).attr("value",o),d.find(t.caption_selector).html(t.metadata.domainValues[o]),d.addClass(t.choiceType),l?d.find(t.control_selector).attr("checked","checked"):d.find(t.control_selector).removeAttr("checked")}t.jQe().html(n.html())},_orderValues:function(){var e=this,t=[];return t=e.metadata.domainValuesOrder?e.metadata.domainValuesOrder:_.sortBy(_.keys(e.metadata.domainValues),function(e){return e}),t.map(String)}}),RenderRadioEdit=RenderRadio.extend({render:function(e){var t=this,a=t.key,n=t.key.indexOf("[]")>0?t.key.slice(0,-2)+"_exists[]":t.key+"_exists";return t.multiple&&(a+="[]"),t._setData(a),jQuery("<input>").attr({type:"hidden",name:n,value:1}).appendTo(t.jQe()),e()},_template:function(){return'\n            <label data-render_element class="radio-inline">\n              <input data-render_control  type="radio" value=""> <span data-render_caption></span>\n            </label>\n        '}}),RenderRadioSearch=RenderRadioEdit.extend({render:function(e){var t=this;return t._setData("s_"+t.key+"[]"),jQuery("<input>").attr({type:"hidden",name:"s_"+t.key+"_operator","data-control_operator":t.key,value:t.operator}).appendTo(t.jQe()),e()},_template:function(){return'\n            <label data-render_element class="radio-inline">\n              <input data-render_control  type="radio" value=""> <span data-render_caption></span>\n            </label>\n        '}}),RenderRadioView=RenderRadio.extend({render:function(e){var t=this,a=t.jQe().find(t.element_selector),n=t._orderValues(),r=[];for(var i in n){var o=n[i],l="fa fa-circle-o";o==t.value&&(l="fa fa-circle"),r.push({icon_class:l,text:t.metadata.domainValues[o]})}var d=jQuery.getTemplate(a,r);return a.append(d),e()},_template:function(){return'\n            <div data-render_element class="checkbox-inline">\n                <i data-class="icon_class" ></i> <span data-field="text"> </span>\n            </div>\n        '}}),RenderCheckbox=Render.extend({type:"checkbox",classData:"checkbox",classTemplate:"checkbox",operator:null,metadata:{domainValuesOrder:null,domainValues:null},getValue:function(){var e=this;if("view"==e.mode)return e.value;var t=[];return jQuery(e.container).find('[type="checkbox"]:checked').each(function(){t.push($(this).val())}),t},clear:function(){var e=this;jQuery(e.container).find("input:checked").prop("checked",!1)},beforeRender:function(e){var t=this;return t.metadata.domainValues&&0!=Object.keys(t.metadata.domainValues).length||(t.metadata.domainValues={1:"Si",0:"No"},t.app.log.warn("RenderChoice "+t.key+" no domainValues found use default",t.metadata.domainValues)),e()},_setData:function(e){for(var t=this,a=(t.jQe().find(t.element_selector),t._orderValues()),n=jQuery("<div>"),r=0;r<a.length;r++)n.append(t.jQe().html());for(var i=t.value?t.value:null==t.value&&"checkbox"==t.choiceType?[]:t.value,r=0;r<a.length;r++){var o=""+a[r],l=!1;jQuery.inArray(o,i.map(String))>=0&&(l=!0);var d=jQuery(n.find(t.element_selector).get(r));d.find(t.control_selector).attr("name",e).attr("value",o),d.find(t.caption_selector).html(t.metadata.domainValues[o]),d.addClass(t.choiceType),l?d.find(t.control_selector).attr("checked","checked"):d.find(t.control_selector).removeAttr("checked")}t.jQe().html(n.html())},_orderValues:function(){var e=this,t=[];return t=e.metadata.domainValuesOrder?e.metadata.domainValuesOrder:_.sortBy(_.keys(e.metadata.domainValues),function(e){return e}),t.map(String)}}),RenderCheckboxEdit=RenderCheckbox.extend({render:function(e){var t=this,a=t.key+"[]",n=t.key.indexOf("[]")>0?t.key.slice(0,-2)+"_exists[]":t.key+"_exists";return t._setData(a),jQuery("<input>").attr({type:"hidden",name:n,value:1}).appendTo(t.jQe()),e()},_template:function(){return'\n            <label data-render_element class="checkbox-inline">\n                <input data-render_control type="checkbox" value="">  <span data-render_caption> </span>\n            </label>\n        '}}),RenderCheckboxSearch=RenderCheckboxEdit.extend({render:function(e){var t=this;return t._setData("s_"+t.key+"[]"),jQuery("<input>").attr({type:"hidden",name:"s_"+t.key+"_operator","data-control_operator":t.key,value:t.operator}).appendTo(jQuery(t.container)),e()},_template:function(){return'\n            <label data-render_element class="checkbox-inline">\n                <input data-render_control type="checkbox" value="">  <span data-render_caption> </span>\n            </label>\n        '}}),RenderCheckboxView=RenderCheckbox.extend({render:function(e){var t=this,a=t.jQe().find(t.element_selector),n=t._orderValues(),r=[];for(var i in n){var o=n[i],l="fa fa-square-o";_.isArray(t.value)?jQuery.inArray(o,new String(t.value))>=0&&(l="fa fa-square"):o==t.value&&(l="fa fa-square"),r.push({icon_class:l,text:t.metadata.domainValues[o]})}var d=jQuery.getTemplate(a,r);return a.append(d),e()},_template:function(){return'\n            <div data-render_element class="checkbox-inline">\n                <i data-class="icon_class" ></i> <span data-field="text"> </span>\n            </div>\n        '}}),RenderImage=Render.extend({}),RenderImageView=RenderImage.extend({imageTemplate:null,getValue:function(){return jQuery(this.container).find(this.control_selector).attr("src")},render:function(e){var t=this,a=t.value;return t.imageTemplate&&("/"!=a[a.length-1]&&(a+="/"),a+=t.imageTemplate),t.jQe().find(t.control_selector).attr("src",a),e()},_template:function(){return"\n            <img data-render_control>\n        "}}),RenderSwap=Render.extend({type:"swap",classData:"swap",classTemplate:"swap",classTrue:"text-success",classFalse:"text-danger",title:"Attiva/Disattiva",domaniValues:null,_setHtmlData:function(){var e=this,t=e.jQe().find(e.control_selector);if(t.attr("title",e.title),!e.domaniValues)return void(e.value===!0||e.value===!1?e.value?(e.jQe().find("i").removeClass(e.classFalse),e.jQe().find("i").addClass(e.classTrue)):(e.jQe().find("i").removeClass(e.classTrue),e.jQe().find("i").addClass(e.classFalse)):parseInt(e.value)?(e.jQe().find("i").removeClass(e.classFalse),e.jQe().find("i").addClass(e.classTrue)):(e.jQe().find("i").removeClass(e.classTrue),e.jQe().find("i").addClass(e.classFalse)));e.jQe().find("i").removeClass(e.classFalse),e.jQe().find("i").addClass(e.classTrue);var a=_.keys(e.domainValues);if(a.length<=2)return void e.app.log.warn("domain values lenght < 2");var n=e.domainValues[a[0]];e.value==a[1]&&(n=e.domainValues[a[1]],e.jQe().find("i").addClass(e.classFalse),e.jQe().find("i").removeClass(e.classTrue)),e.jQe().find("i").html("&nbsp;"+n)},getValue:function(){return this.value},_swap:function(){var e=this,t=Route.factory("set");t.values={modelName:e.modelName,field:e.key,value:e.value},e.app.waitStart(),t.params={id:e.modelData.id},Server.route(t,function(t){e.app.waitEnd(),e._callback(t)})},_callback:function(e){return e.error?void self.app.errorDialog(e.msg):void(this.view&&app.renderView(this.view.keyId))}}),RenderSwapEdit=RenderSwap.extend({render:function(e){return this._setHtmlData(),e()},finalize:function(e){var t=this,a=t.jQe().find(t.control_selector);return a.click(function(){if(t.domainValues){var e=_.keys(t.domainValues);t.value==e[0]?t.value=e[1]:t.value=e[0]}else t.value===!0||t.value===!1?t.value=!t.value:t.value=1==parseInt(t.value)?0:1;t._setHtmlData(),t._swap()}),e()},_template:function(){return'\n            <button type="button" class="btn btn-default btn-xs" data-render_control title="">\n                <i class="fa fa-circle"></i>\n            </button>\n        '}}),RenderSwapView=RenderSwap.extend({render:function(e){return this.value=parseInt(this.value),this._setHtmlData(),e()},_template:function(){return'<i data-render_control class="fa fa-circle"></i>'}}),RenderCustom=Render.extend({type:"custom",classData:"custom",classTemplate:"custom",html:null,render:function(){var e=this;e.value&&(_.isFunction(e.value)?jQuery(e.container).html(e.value.apply(e)):jQuery(e.container).html(e.value))},getValue:function(){return jQuery(this.container).html()},setValue:function(e){jQuery(this.container).html(e)}}),RenderCustomEdit=RenderCustom.extend({_template:function(){return"\n            <div data-render_element data-render_control></div>\n        "}}),RenderCustomSearch=RenderCustomEdit.extend({}),RenderCustomView=RenderCustomEdit.extend({}),RenderDecimal=Render.extend({int_selector:"[data-render_control_int]",dec_selector:"[data-render_control_dec]",symbol_selector:"[data-render_symbol]",type:"decimal",classData:"decimal",classTemplate:"decimal",digits:2,symbol:null,symbol_position:"left",separator:",",getValue:function(){var e=this;return"view"==e.mode?e.value:jQuery(e.container).find(e.control_selector).val()},_splitNumber:function(){var e=this,t=parseFloat(e.value);if(isNaN(t))return e.value=0,["0",Array(e.digits).join("0")];var a=(t+"").split(".");return 2==a.length?a[1].length>=e.digits?a[1]=a[1].substr(0,e.digits):a[1]=""+a[1]+Array(e.digits-a[1].length+1).join("0"):a=[t,Array(e.digits+1).join("0")],a},_showSymbol:function(){var e=this;e.symbol&&(e.jQe().find("[data-render_symbol]").html(e.symbol),"left"===e.symbol_position?e.jQe().find(".symbol_left").removeClass("hide"):e.jQe().find(".symbol_right").removeClass("hide"))},setValue:function(e){var t=this,a=new String(e).split("."),n=a[0],r=0;(a.length=2)&&(r=a[1]),t.jQe().find(t.int_selector).val(n),t.jQe().find(t.dec_selector).val(r)}}),RenderDecimalEdit=RenderDecimal.extend({render:function(e){var t=this,a=t._splitNumber();return t.jQe().find(t.control_selector).attr("name",t.key).attr("value",t.value),t.jQe().find(t.int_selector).attr("value",a[0]),t.jQe().find(t.dec_selector).attr("value",a[1]),t._showSymbol(),e()},finalize:function(e){var t=this;return t.jQe().find(t.int_selector+","+t.dec_selector).change(function(){var e=jQuery(t.container).find(t.int_selector).val(),a=jQuery(t.container).find(t.dec_selector).val();jQuery(t.container).find(t.control_selector).attr("value",e+"."+a),jQuery(t.container).find(t.control_selector).trigger("change")}),e()},_template:function(){return'\n            <div class="input-group" data-render_element>\n                <span class="input-group-addon hide symbol_left" data-render_symbol></span>\n                <input class="form-control text-right" type="text" data-render_control_int>\n                <span class="input-group-addon">,</span>\n                <input class="form-control text-right" type="text" data-render_control_dec>\n                <input type="hidden" data-render_control="">\n                <span class="input-group-addon hide symbol_right" data-render_symbol></span>\n            </div>\n        '}}),RenderDecimalSearch=RenderDecimalEdit.extend({}),RenderDecimalView=RenderDecimal.extend({render:function(e){var t=this,a=t._splitNumber();return t.jQe().find(t.int_selector).html(a[0]+t.separator+a[1]),t._showSymbol(),e()},_template:function(){return'\n            <div data-render_element class="text-right">\n                <span class="hide symbol_left" data-render_symbol></span>\n                <span class="text-right" data-render_control_int></span>\n                <span class="hide symbol_right text-left" data-render_symbol></span>\n            </div>\n        '}}),RenderTexthtml=Render.extend({type:"texthtml",classData:"texthtml",classTemplate:"texthtml",safeKey:null,tinymceConfig:null,init:function(e,t){this._super(e,t),this.safeKey=e.replace(/[\])}\[{(]/g,"")},getValue:function(){var e=this;return jQuery(e.container).find(e.control_selector).val()},_createPluginObject:function(e){var t=this,a=jQuery(t.container).find("textarea.summernote");a.each(function(){var t=jQuery(this).attr("data-summernote-lang")||"en-US",a=jQuery(this),n=function(){a.summernote({height:a.attr("data-height")||200,lang:a.attr("data-summernote-lang")||"en-US",toolbar:[["cleaner",["cleaner"]],["style",["style"]],["fontsize",["fontsize"]],["style",["bold","italic","underline","strikethrough","clear"]],["color",["color"]],["para",["ul","ol","paragraph","height"]],["table",["table"]],["media",["link","picture","video"]],["misc",["codeview","fullscreen","help","undo","redo","specialCharacter"]]],popover:{image:[["imagesize",["imageSize100","imageSize50","imageSize25"]],["float",["floatLeft","floatRight","floatNone"]],["custom",["imageAttributes","imageShape"]],["remove",["removeMedia"]]]},cleaner:{el:"textarea.summernote",notTime:2400,successClass:"alert alert-success",action:"button",icon:'<i class="fa fa-file-word-o"></i>'}}),e()};return"en-US"!=t?void EventManager.trigger("loadResource",{resource:"editor.summernote/lang/summernote-"+t+".js"},n):void n()})}}),RenderTexthtmlEdit=RenderTexthtml.extend({resources:["editor.summernote/summernote.css","editor.summernote/summernote.js","editor.summernote/plugin/image-attribute/summernote-image-attributes.js","editor.summernote/plugin/specialchars/summernote-ext-specialchars.js","editor.summernote/plugin/cleaner/summernote-cleaner.js","jquery.validate/jquery.validate.js"],render:function(e){var t=this,a=t.jQe().find(t.control_selector);return a.attr("name",t.key),a.html(t.value),t._setHtmlAttributes(a),e()},finalize:function(e){var t=this;return t._createPluginObject(function(){jQuery.validator.setDefaults({ignore:":hidden:not(.summernote)"}),jQuery(t.container).find("textarea").on("summernote.change",function(e,a,n){console.log("object changed",e,a,n),jQuery(t.container).find("textarea").html(a)})}),e()},_template:function(){return'\n            <textarea data-render_element data-render_control class="summernote form-control" data-height="200" data-summernote-lang="it-IT"></textarea>\n        '}}),RenderTexthtmlView=RenderTexthtml.extend({render:function(e){var t=this,a=t.jQe().find(t.element_selector);return a.html(t.value),e()},_template:function(){return"\n            <div data-render_element data-render_control ></div>\n        "}});RenderDateSelect=Render.extend({year_selector:"[data-render_year]",month_selector:"[data-render_month]",day_selector:"[data-render_day]",picker_selector:"[data-render_picker]",h24:!0,type:"date",classData:"date",classTemplate:"date",operator:null,time:!1,dateFormat:"",timeFormat:"H:i:s",selectProps:{active:["day","month","year"],startYear:(new Date).getFullYear()-3,endYear:(new Date).getFullYear()+3},_setDateControls:function(){var e=this,t=e.selectProps.active?e.selectProps.active:[],a=(parseInt((new Date).getFullYear()),e.selectProps.startYear),n=e.selectProps.endYear,r=e.jQe().find(e.day_selector),i=jQuery("<option>").attr({value:""});i.html(e.app.translate("general-giorno")),r.append(i);for(var o=1;o<=31;o++){o=Utility.padDate(o,2);var i=jQuery("<option>").attr({value:o});i.html(o),r.append(i)}jQuery.inArray("day",t)<0&&(e.jQe().find("[data-render_day_container]").addClass("hide"),r.addClass("hide"));var l=e.jQe().find(e.month_selector),i=jQuery("<option>").attr({value:""});i.html(e.app.translate("general-mese")),l.append(i);for(var o=1;o<=12;o++){o=Utility.padDate(o,2);var i=jQuery("<option>").attr({value:o});i.html(o),l.append(i)}jQuery.inArray("month",t)<0&&(e.jQe().find("[data-render_month_container]").addClass("hide"),r.addClass("hide"));var d=e.jQe().find(e.year_selector),i=jQuery("<option>").attr({value:""});i.html(e.app.translate("general-anno")),d.append(i);for(var o=n;o>a;o--){var i=jQuery("<option>").attr({value:o});i.html(o),d.append(i)}jQuery.inArray("year",t)<0&&(e.jQe().find("[data-render_year_container]").addClass("hide"),r.addClass("hide"))},_dbDateToArray:function(e){if(!e)return["","",""];var t=e;t.indexOf(" ")>=0&&(t=t.split(" ")[0]),t.indexOf("T")>=0&&(t=t.split("T")[0]);var a=t.split("-");return a[1]&&1==a[1].length&&(a[1]="0"+a[1]),a[2]&&1==a[2].length&&(a[2]="0"+a[2]),a},_changeDate:function(){var e=this,t=e.active?e.active:["day","month","year"],a="",n=jQuery(e.container).find(e.year_selector),r=jQuery(e.container).find(e.month_selector),i=jQuery(e.container).find(e.day_selector),o="",l=28;"04"==r.val()||"06"==r.val()||"09"==r.val()||"11"==r.val()?l=30:"02"!=r.val()?l=31:n.val()%4!=0&&n.val()%100!=0||(l=29);for(var d=1;d<=l;d++){var u=Utility.padDate(d,2);i.val()==u&&(o=' selected="selected" '),a+='<option value="'+u+'"'+o+">"+u+"</option>",o=""}var s=i.val();i.empty(),i.append(a),s<=l&&i.val(s);var c=jQuery(e.container).find(e.control_selector),p=c.val().split(" "),m="";p.length>1&&(m=p[1]);var f="",v=jQuery.inArray("year",t)<0?"0000":n.val(),h=jQuery.inArray("month",t)<0?"00":r.val(),y=jQuery.inArray("day",t)<0?"00":i.val();if(""==v||""==h||""==y)f="";else var f=v+"-"+h+"-"+y;""!=m&&(f+=" "+m),c.attr("value",f).val(f)},setValue:function(e){var t=this;t.jQe().find(t.control_selector).val(e);var a=t._dbDateToArray(e);t.jQe().find(t.year_selector).val(a[0]).attr("selected","selected"),t.jQe().find(t.month_selector).val(a[1]).attr("selected","selected"),t.jQe().find(t.day_selector).val(a[2]).attr("selected","selected")},getValue:function(){var e=this;return jQuery(e.container).find(e.control_selector).val()},clear:function(){this.setValue("")}}),RenderDateSelectEdit=RenderDateSelect.extend({render:function(e){var t=this,a=t.jQe().find(t.control_selector);return a.attr("name",t.key).attr("value",t.value),t._setDateControls(),e()},finalize:function(e){var t=this;return t.jQe().find(t.year_selector+","+t.month_selector+","+t.day_selector).change(function(){t._changeDate();jQuery(t.year_selector).val()+"-"+jQuery(t.month_selector).val()+"-"+jQuery(t.day_selector).val()}),t.setValue(t.value),e()},_template:function(){return'\n            <div data-render_element  class="input-group">\n                <input data-render_control="" type="hidden" />\n                <div class="input-group-btn" data-render_day_container>\n                    <select class="form-control" data-render_day>\n                    \n                    </select>\n                </div>\n                <div class="input-group-btn" data-render_month_container>\n                    <select class="form-control" data-render_month>\n                    \n                    </select>\n                </div>\n                <div class="input-group-btn" data-render_year_container>\n                    <select class="form-control" data-render_year>\n                    \n                    </select>\n                </div>\n            </div>\n            '}}),RenderDateSelectSearch=RenderDateSelectEdit.extend({render:function(e){var t=this,a=t.jQe().find(t.control_selector);return a.attr("name","s_"+t.key+"[]").attr("value",t.value),jQuery("<input>").attr({type:"hidden",name:"s_"+t.key+"_operator","data-control_operator":t.key,value:t.operator}).appendTo(t.jQe()),t._setDateControls(),e()}}),RenderDateSelectView=RenderDateSelect.extend({dateFormat:"YYYY-MM-DD",displayDateFormat:"DD/MM/YYYY",timeFormat:"HH:mm:ss",displayTimeFormat:"HH:mm:ss",resources:["bootstrap-daterangepicker/moment.js"],finalize:function(e){var t=this;return t.setValue(t.value),e()},_toDate:function(e){var t=this,a=moment(e,t.getFormat());if(!a.isValid())throw"["+e+"] Data non valida ";return a},getFormat:function(){var e=this;return e.dateFormat+(e.time?" "+e.timeFormat:"")},getDisplayFormat:function(){var e=this;return e.displayDateFormat+(e.time?" "+e.displayTimeFormat:"")},getValue:function(){var e=this;return e.value},setValue:function(e){var t=this,a=t._toDate(e),n=jQuery(t.container).find(t.element_selector);n.html(a.format(t.getDisplayFormat())),t.value=e},_template:function(){return"\n            <span data-render_element></span>\n        "}});var TraitDatePicker={picker_selector:"[data-render_picker]",h24:!0,type:"date",operator:null,time:!1,dateFormat:"YYYY-MM-DD",displayDateFormat:"DD/MM/YYYY",timeFormat:"HH:mm:ss",displayTimeFormat:"HH:mm:ss",_setDateControls:function(){var e=this,t=e.jQe().find(e.picker_selector);t.attr("name",e.key+"_picker").attr("value",e.value)},_dbDateToArray:function(e){if(!e)return["","",""];var t=e;t.indexOf(" ")>=0&&(t=t.split(" ")[0]),t.indexOf("T")>=0&&(t=t.split("T")[0]);var a=t.split("-");return a[1]&&1==a[1].length&&(a[1]="0"+a[1]),a[2]&&1==a[2].length&&(a[2]="0"+a[2]),a},setValue:function(e){var t=this,a=moment(e,t.getFormat());if(!a.isValid())throw"["+e+"] Data non valida ";jQuery(t.container).find(t.control_selector).val(e);var n=jQuery(t.container).find(t.picker_selector).data("daterangepicker");n.setStartDate(a),n.setEndDate(a)},getValue:function(){var e=this;return"view"==e.mode?e.value:jQuery(e.container).find(e.control_selector).val()},getFormat:function(){var e=this;return e.dateFormat+(e.time?" "+e.timeFormat:"")},getDisplayFormat:function(){var e=this;return e.displayDateFormat+(e.time?" "+e.displayTimeFormat:"")},clear:function(){this.setValue("")},_createPluginObject:function(e){var t=this;return jQuery(t.container).find(t.picker_selector).daterangepicker({singleDatePicker:!0,showDropdowns:!0,timePicker:t.time,timePicker24Hour:t.h24,startDate:t.value,locale:{format:t.getFormat(),displayFormat:t.displayDateFormat+(t.time?" "+t.displayTimeFormat:"")},autoUpdateInput:!0},function(e,t,a){moment().diff(e,"years");console.log("scelto data",e.toISOString())}),e()}};RenderDatePickerEdit=Render.extend(TraitDatePicker),RenderDatePickerEdit=RenderDatePickerEdit.extend({resources:["bootstrap-daterangepicker/daterangepicker.css","bootstrap-daterangepicker/moment.js","bootstrap-daterangepicker/daterangepicker.js"],render:function(e){var t=this,a=t.jQe().find(t.control_selector);return a.attr("name",t.key).attr("value",t.value),t._setDateControls(),e()},finalize:function(e){var t=this;t._createPluginObject(function(){var e=new Date;t.value&&(e=Utility.jsDate(t.value)),t.app.log.debug("currentDate",e),jQuery(t.container).find(t.picker_selector).on("apply.daterangepicker",function(e,a){var n=t.dateFormat,r=t.displayDateFormat;t.time&&(n+=" "+t.timeFormat,r+=" "+t.displayTimeFormat),jQuery(t.container).find(t.control_selector).val(a.startDate.format(n));var i=jQuery(t.container).find(t.picker_selector);i.val(a.startDate.format(r))}),jQuery(t.container).find(t.picker_selector).data("daterangepicker").setStartDate(e),jQuery(t.container).find("[data-clear]").click(function(){t.setValue(null),t.container.find("[data-render_picker]").val("")})})},getDaterangepicker:function(){var e=this;return jQuery(e.container).find(e.picker_selector).data("daterangepicker")},_template:function(){return'\n            <div data-render_element>\n                <input data-render_control="" type="hidden" />\n                <div class="input-group">\n                    <input data-render_picker class="form-control text-right" autocomplete="off" />\n                    <a data-clear class="input-group-addon" href="javascript:void(0)"><span ><i class="fa fa-times"></i></span></a>\n                </div>\n                \n            </div>\n        '}}),RenderDatePickerSearch=RenderDatePickerEdit.extend({render:function(e){var t=this,a=t.jQe().find(t.control_selector);return a.attr("name","s_"+t.key+"[]").attr("value",t.value),jQuery("<input>").attr({type:"hidden",name:"s_"+t.key+"_operator","data-control_operator":t.key,value:t.operator}).appendTo(t.jQe()),t._setDateControls(),e()}}),RenderDatePickerView=Render.extend(TraitDatePicker),RenderDatePickerView=RenderDatePickerView.extend({invalidDateString:"",resources:["bootstrap-daterangepicker/moment.js"],finalize:function(e){var t=this;return t.setValue(t.value),e()},_toDate:function(e){var t=this,a=moment(e,t.getFormat());return a.isValid()?a:(this.app.log.warn("["+e+"] Data non valida "),null)},getValue:function(){var e=this;return e.value},setValue:function(e){var t=this,a=t._toDate(e),n=t.jQe().find(t.element_selector);a?n.html(a.format(t.getDisplayFormat())):n.html(t.invalidDateString),t.value=e},_template:function(){return"\n            <span data-render_element></span>\n        "}});var RenderDateFormatted=Render.extend({h24:!0,type:"date",operator:null,time:!1,dateFormat:"YYYY-MM-DD",timeFormat:"hh:mm:ss",date_selector:"[data-date_formatted]",time_selector:"[data-time_formatted]",resources:["bootstrap-daterangepicker/moment.js"],_setDateControls:function(){var e=this;e.time?"datetime-local":"date";if(jQuery(e.container).find(e.date_selector).attr("type","date"),e.value){var t=jQuery(e.container).find(e.control_selector);t.attr("value",e.value),jQuery(e.container).find(e.date_selector).attr("value",e.value)}e.time&&jQuery(e.container).find(e.time_selector).attr("type","time").removeClass("hide")},getFormat:function(){var e=this;return e.dateFormat+(e.time?" "+e.timeFormat:"")},_dbDateToArray:function(){var e=this;if(!e.value)return["","",""];var t=e.value;t.indexOf(" ")>=0&&(t=t.split(" ")[0]),t.indexOf("T")>=0&&(t=t.split("T")[0]);var a=t.split("-");return a[1]&&1==a[1].length&&(a[1]="0"+a[1]),a[2]&&1==a[2].length&&(a[2]="0"+a[2]),a},_changeDate:function(){alert("aaa");var e=this,t=e.active?e.active:["day","month","year"],a="",n=jQuery(e.container).find(e.year_selector),r=jQuery(e.container).find(e.month_selector),i=jQuery(e.container).find(e.day_selector),o="",l=(e.key,28);"04"==r.val()||"06"==r.val()||"09"==r.val()||"11"==r.val()?l=30:"02"!=r.val()?l=31:n.val()%4!=0&&n.val()%100!=0||(l=29);for(var d=1;d<=l;d++){var u=Utility.padDate(d,2);i.val()==u&&(o=' selected="selected" '),a+='<option value="'+u+'"'+o+">"+u+"</option>",o=""}var s=i.val();i.empty(),i.append(a),s<=l&&i.val(s);var c=jQuery(e.container).find(e.control_selector),p=c.val().split(" "),m="";p.length>1&&(m=p[1]);var f="",v=jQuery.inArray("year",t)<0?"0000":n.val(),h=jQuery.inArray("month",t)<0?"00":r.val(),y=jQuery.inArray("day",t)<0?"00":i.val();if(""==v||""==h||""==y)f="";else var f=v+"-"+h+"-"+y;""!=m&&(f+=" "+m),c.attr("value",f).val(f)},setValue:function(e){var t=this,a=moment(e,t.getFormat());if(!a.isValid())throw"["+e+"] Data non valida ";console.log("SetValue",a,e),jQuery(t.container).find(t.control_selector).val(a.format(t.getFormat())),jQuery(t.container).find("[data-render_formatted]").val(a.format(t.getFormat()))},getValue:function(){var e=this;return jQuery(e.container).find(e.control_selector).val()},clear:function(){this.setValue("")}}),RenderDateFormattedEdit=RenderDateFormatted.extend({render:function(){var e=this,t=e.jQe().find(e.control_selector);t.attr("name",e.key).attr("value",e.value),e._setDateControls()},finalize:function(){var e=this;e.setValue(e.value),jQuery(e.container).find(e.date_selector+","+e.time_selector).change(function(){var t=jQuery(e.container).find(e.date_selector).val()+" "+jQuery(e.container).find(e.time_selector).val();jQuery(e.container).find(e.control_selector).val(t)})},_template:function(){return'\n            <div class="clearfix" data-render_element>\n                <input data-render_control="" type="hidden" />\n                <div class="col col-xs-6">\n                    <input data-date_formatted class="form-control" />\n                </div>\n                <div class="col col-xs-6">\n                    <input data-time_formatted class="form-control hide" />\n                </div>\n            </div>\n        '}}),RenderDateFormattedSearch=RenderDateFormattedEdit.extend({render:function(){var e=this,t=jQuery(e.container).find(e.control_selector);t.attr("name","s_"+e.key+"[]").attr("value",e.value),jQuery("<input>").attr({type:"hidden",name:"s_"+e.key+"_operator","data-control_operator":e.key,value:e.operator}).appendTo(jQuery(e.container)),e._setDateControls(jQuery(e.container))}}),RenderDateFormattedView=RenderDateSelectView.extend({}),RenderBetweenDateSelect=Render.extend({rStart:null,rEnd:null,year_selector:"[data-render_year]",month_selector:"[data-render_month]",day_selector:"[data-render_day]",year_end_selector:"[data-render_year_end]",month_end_selector:"[data-render_month_end]",day_end_selector:"[data-render_day_end]",control_selector:"[data-render_control]",control_end_selector:"[data-render_control_end]",control_operator:"[data-render_operator]",type:"between_date_select",classData:"between_date_select",classTemplate:"between_date_select",end_key:null,end_value:null,selectEndProps:{active:["day","month","year"],startYear:(new Date).getFullYear()-3,endYear:(new Date).getFullYear()+3},selectProps:{active:["day","month","year"],startYear:(new Date).getFullYear()-3,endYear:(new Date).getFullYear()+3},init:function(e,t){this._super(e,t),this.end_key||(this.end_key="end_"+this.key)},_before:function(){var e=this;if(!e.end_key)throw"end_key not definited!"},_setDateControls:function(){var e=this,t=e.selectProps.active?e.selectProps.active:[],a=(parseInt((new Date).getFullYear()),e.selectProps.startYear),n=e.selectProps.endYear,r=jQuery(e.container).find(e.day_selector),i=jQuery("<option>").attr({value:""});i.html(e.app.translate("general-giorno")),r.append(i);for(var o=1;o<=31;o++){o=Utility.padDate(o,2);var i=jQuery("<option>").attr({value:o});i.html(o),r.append(i)}jQuery.inArray("day",t)<0&&(jQuery(e.container).find("[data-render_day_container]").addClass("hide"),r.addClass("hide"));var l=jQuery(e.container).find(e.month_selector),i=jQuery("<option>").attr({value:""});i.html(e.app.translate("general-mese")),l.append(i);for(var o=1;o<=12;o++){o=Utility.padDate(o,2);var i=jQuery("<option>").attr({value:o});i.html(o),l.append(i)}jQuery.inArray("month",t)<0&&(jQuery(e.container).find("[data-render_month_container]").addClass("hide"),r.addClass("hide"));var d=jQuery(e.container).find(e.year_selector),i=jQuery("<option>").attr({value:""});i.html(e.app.translate("general-anno")),d.append(i);for(var o=n;o>a;o--){var i=jQuery("<option>").attr({value:o});i.html(o),d.append(i)}jQuery.inArray("year",t)<0&&(jQuery(e.container).find("[data-render_year_container]").addClass("hide"),r.addClass("hide"));var t=e.selectProps.active?e.selectProps.active:[],a=(parseInt((new Date).getFullYear()),e.selectProps.startYear),n=e.selectProps.endYear,r=jQuery(e.container).find(e.day_end_selector),i=jQuery("<option>").attr({value:""});i.html(e.app.translate("general-giorno")),r.append(i);for(var o=1;o<=31;o++){o=Utility.padDate(o,2);var i=jQuery("<option>").attr({value:o});i.html(o),r.append(i)}jQuery.inArray("day",t)<0&&(jQuery(e.container).find("[data-render_day_end_container]").addClass("hide"),r.addClass("hide"));var l=jQuery(e.container).find(e.month_end_selector),i=jQuery("<option>").attr({value:""});i.html(e.app.translate("general-mese")),l.append(i);for(var o=1;o<=12;o++){o=Utility.padDate(o,2);var i=jQuery("<option>").attr({value:o});i.html(o),l.append(i)}jQuery.inArray("month",t)<0&&(jQuery(e.container).find("[data-render_month_end_container]").addClass("hide"),r.addClass("hide"));var d=jQuery(e.container).find(e.year_end_selector),i=jQuery("<option>").attr({value:""});i.html(e.app.translate("general-anno")),d.append(i);for(var o=n;o>a;o--){var i=jQuery("<option>").attr({value:o});i.html(o),d.append(i)}jQuery.inArray("year",t)<0&&(jQuery(e.container).find("[data-render_year_end_container]").addClass("hide"),r.addClass("hide"))},setValue:function(e,t){var a=this,n=jQuery(a.container),r=n.find('input[name="'+a.key+'_picker"]');r.datepicker("setDate",e);var r=n.find('input[name="'+a.end_key+'_picker"]');r.datepicker("setDate",t)},getValue:function(){var e=this,t=jQuery(e.container).find(e.control_selector).val(),a=jQuery(e.container).find(e.control_end_selector).val();
return[t,a]}}),RenderBetweenDateSelectEdit=RenderBetweenDateSelect.extend({render:function(e){var t=this;return t.rStart=Render.factory(t.key,{mode:"edit",type:"date_select",value:t.value,container:jQuery(t.container).find("[data-render_start]")}),t.rEnd=Render.factory(t.end_key,{mode:"edit",type:"date_select",value:t.end_value,container:jQuery(t.container).find("[data-render_end]")}),e()},finalize:function(e){var t=this;return t.rStart.show(),t.rEnd.show(),e()},_template:function(){return'\n            <div>\n                <div class="col col-xs-6">\n                    <div data-label_dal></div>\n                    <div data-render_start></div>\n                </div>\n                <div class="col col-xs-6" >\n                    <div data-label_al></div>\n                    <div data-render_end></div>\n                </div>\n            </div>\n            '}}),RenderBetweenDateSelectSearch=RenderBetweenDateSelectEdit.extend({render:function(e){var t=this;return t.rStart=Render.factory(t.key,{mode:"search",type:"date_select",value:t.value,operator:t.operator,container:jQuery(t.container).find("[data-render_start]")}),t.rEnd=Render.factory(t.key,{mode:"search",type:"date_select",value:t.end_value,container:jQuery(t.container).find("[data-render_end]")}),e()},finalize:function(e){var t=this;return t.rStart.show(),t.rEnd.show(),jQuery(t.rEnd.container).find(t.rEnd.control_operator).remove(),e()}}),RenderBetweenDateSelectView=RenderBetweenDateSelect.extend({render:function(e){var t=this;return t.rStart=Render.factory(t.key,{mode:"view",type:"date_select",value:t.value,container:jQuery(t.container).find("[data-render_start]")}),t.rEnd=Render.factory(t.end_key,{mode:"view",type:"date_select",value:t.end_value,container:jQuery(t.container).find("[data-render_end]")}),e()},finalize:function(e){var t=this;return t.rStart.show(),t.rEnd.show(),e()},_template:function(){return'\n            <div>\n                <div class="col col-xs-6">\n                    <div data-label_dal></div>\n                    <div data-render_start></div>\n                </div>\n                <div class="col col-xs-6" >\n                    <div data-label_al></div>\n                    <div data-render_end></div>\n                </div>\n            </div>\n            '}}),RenderBetweenDatePicker=Render.extend({resources:["bootstrap-daterangepicker/daterangepicker.css","bootstrap-daterangepicker/moment.js","bootstrap-daterangepicker/daterangepicker.js"],picker_selector:"[data-render_picker]",picker_end_selector:"[data-render_picker_end]",control_selector:"[data-render_control]",control_end_selector:"[data-render_control_end]",control_operator:"[data-render_operator]",type:"between_date_picker",classData:"between_date_picker",classTemplate:"between_date_picker",end_key:null,end_value:null,init:function(e,t){this._super(e,t),this.end_key||(this.end_key="end_"+this.key)},_validateEdit:function(){var e=this;if(!e.end_key)throw"end_key not definited!"},_renderSearch:function(){var e=this,t=jQuery(e.container).find(e.control_selector);t.attr("name","s_"+e.key+"[]").attr("value",e.value),t=jQuery(e.container).find(e.control_end_selector),t.attr("name","s_"+e.end_key+"[]").attr("value",e.end_value),t=jQuery(e.container).find(e.operator_selector),t.attr("name","s_"+e.key+"_operator"),t.attr("value",e.operator)},setValue:function(e,t){var a=this,n=jQuery(a.container),r=n.find('input[name="'+a.key+'_picker"]');r.datepicker("setDate",e);var r=n.find('input[name="'+a.end_key+'_picker"]');r.datepicker("setDate",t)},getValue:function(){var e=this,t=jQuery(e.container).find(e.control_selector).val(),a=jQuery(e.container).find(e.control_end_selector).val();return[t,a]},_createPluginObject:function(e){var t=this;jQuery(t.container).find(t.picker_selector).daterangepicker({showDropdowns:!0,timePicker:t.time,locale:{format:"DD/MM/YYYY"+(t.time?" HH:mm:ss":"")}},function(e,t,a){START=e;moment().diff(e,"years");console.log("scelto data",e.toISOString())}),e()},_searchPickerTemplate:function(){return'\n            <div data-render_element>\n                <input data-render_control="" type="hidden" />\n                <input data-render_control_end="" type="hidden" /> \n                <input  data-control_operator class="form-control" type="hidden" name="" value="">\n                <div class="input-group-btn">\n                    <input data-render_picker class="form-control text-right" autocomplete="off"/>\n                </div>\n            </div>\n        '}}),RenderBetweenDatePickerEdit=RenderBetweenDatePicker.extend({render:function(e){var t=this,a=jQuery(t.container).find(t.control_selector);return a.attr("name",t.key).attr("value",t.value),a=jQuery(t.container).find(t.control_end_selector),a.attr("name",t.end_key).attr("value",t.end_value),e()},finalize:function(e){var t=this;t._createPluginObject(function(){var a=new Date;return t.value&&(a=Utility.jsDate(t.value)),t.app.log.debug("currentDate",a),jQuery(t.container).find(t.picker_selector).on("apply.daterangepicker",function(e,a){var n="YYYY-MM-DD"+(t.time?" HH:mm:ss":"");jQuery(t.container).find(t.control_selector).val(a.startDate.format(n)),jQuery(t.container).find(t.control_end_selector).val(a.endDate.format(n))}),jQuery(t.container).find(t.picker_selector).data("daterangepicker").setStartDate(a),e()})},_template:function(){return'\n            <div data-render_element>\n                <input data-render_control="" type="hidden" />\n                <input data-render_control_end="" type="hidden" /> \n                <div class="input-group-btn">\n                    <input data-render_picker class="form-control text-right" autocomplete="off"/>\n                </div>\n            </div>\n        '}}),RenderBetweenDatePickerSearch=RenderBetweenDatePickerEdit.extend({render:function(e){var t=this,a=jQuery(t.container).find(t.control_selector);return a.attr("name",t.key).attr("value",t.value),a=jQuery(t.container).find(t.control_end_selector),a.attr("name",t.end_key).attr("value",t.end_value),a=jQuery(t.container).find(t.operator_selector),a.attr("name","s_"+t.key+"_operator"),a.attr("value",t.operator),e()},_template:function(){return'\n            <div data-render_element>\n                <input data-render_control="" type="hidden" />\n                <input data-render_control_end="" type="hidden" />\n                <input data-render_control_operator="" type="hidden" /> \n                <div class="input-group-btn">\n                    <input data-render_picker class="form-control text-right" autocomplete="off"/>\n                </div>\n            </div>\n        '}}),RenderBetweenDatePickerView=RenderBetweenDateSelectView.extend({}),RenderBetweenDateFormatted=Render.extend({rStart:null,rEnd:null,year_end_selector:"[data-render_year_end]",month_end_selector:"[data-render_month_end]",day_end_selector:"[data-render_day_end]",picker_selector:"[data-render_picker]",picker_end_selector:"[data-render_picker_end]",control_selector:"[data-render_control]",control_end_selector:"[data-render_control_end]",control_operator:"[data-render_operator]",type:"between_date",classData:"between_date",classTemplate:"between_date",end_key:null,end_value:null,selectEndProps:{active:["day","month","year"],startYear:(new Date).getFullYear()-3,endYear:(new Date).getFullYear()+3},init:function(e,t){this._super(e,t),this.end_key||(this.end_key="end_"+this.key)},_validateEdit:function(){var e=this;if(!e.end_key)throw"end_key not definited!"},_setPickerDateControls:function(e){},_setDateControls:function(e){return},setValue:function(e,t){var a=this,n=jQuery(a.container),r=n.find('input[name="'+a.key+'_picker"]');r.datepicker("setDate",e);var r=n.find('input[name="'+a.end_key+'_picker"]');r.datepicker("setDate",t)},getValue:function(){var e=this,t=jQuery(e.container).find(e.control_selector).val(),a=jQuery(e.container).find(e.control_end_selector).val();return[t,a]}}),RenderBetweenDateFormattedEdit=RenderBetweenDateFormatted.extend({render:function(e){var t=this;return t.rStart=Render.factory(t.key,{mode:"edit",type:"date_formatted",value:t.value,container:jQuery(t.container).find("[data-render_start]")}),t.rEnd=Render.factory(t.end_key,{mode:"edit",type:"date_formatted",value:t.end_value,container:jQuery(t.container).find("[data-render_end]")}),e()},finalize:function(e){var t=this;return t.rStart.show(),t.rEnd.show(),e()},_template:function(){return'\n            <div>\n                <div class="col col-xs-6">\n                    <div data-label_dal></div>\n                    <div data-render_start></div>\n                </div>\n                <div class="col col-xs-6" >\n                    <div data-label_al></div>\n                    <div data-render_end></div>\n                </div>\n            </div>\n            '}}),RenderBetweenDateFormattedSearch=RenderBetweenDateFormattedEdit.extend({}),RenderBetweenDateFormattedView=RenderBetweenDateSelectView.extend({resources:["bootstrap-daterangepicker/moment.js"]}),TraitUpload={_setUploadAjaxForm:function(e){var t=this;e.jQe().find(".btok").addClass("disabled");var a=Route.factory(t.routeName,{});e.jQe().find("form").attr("action",Server.getUrl(a.getUrl())),e.jQe().find("form").ajaxForm({beforeSubmit:function(a,n,r){r.dataType="json",t._hideError(e),t.app.waitStart()},error:function(a,n,r){t.app.waitEnd(),t._showError(e,"Upload error "+a+" "+n+" "+r),e.jQe().find('[data-button="ok"]').addClass("disabled")},success:function(a){if(t.app.waitEnd(),a.error){var n=null;try{var r=JSON.parse(a.msg);n="";for(l in r)n+="<div>"+r[l]+"</div>"}catch(i){n=a.msg}return t._showError(e,n),void e.jQe().find('[data-button="ok"]').addClass("disabled")}var o=Server.getUrl("/imagecache/small/"+a.result.filename);e.jQe().find("[data-icon]").attr("src",o);for(var l in a.result)e.jQe().find("form").find('input[name="'+l+'"]').attr("value",a.result[l]);e.jQe().find('[data-button="ok"]').removeClass("disabled"),t.afterUpload(a)}}),e.jQe().find('input[name="file"]').autoUpload(function(){e.jQe().find("form").submit()})},_createDialogView:function(e){var t=this;t.vkey&&(t.app.removeView(t.vkey),e.jQe().find("[data-view_container]").html(""));var a=[];for(var n in t.uploadFields)a.push(t.uploadFields[n]);for(var n in t.fields)a.push(t.fields[n]);t.vkey=t.app.addView(new ConfEdit({container:e.jQe().find("[data-view_container]"),actions:[],modelName:t.modelName,routeName:null,fields:a,data:{value:{modelName:t.modelName,type:t.metadata.relationName},metadata:{}}})),t._setUploadFieldsType(),t._setFieldsType(),t.app.renderView(t.vkey)},_dialogTemplate:function(){return'\n         \n            <div class="modal-content">\n                <div class="modal-header">\n                    <button data-button="cancel" type="button" class="close" data-dismiss="modal"\n                        aria-hidden="true">&times;</button>\n                    <h4 class="modal-title"></h4>\n                </div>\n                <div class="modal-body">\n                    <div data-error_container class="alert alert-danger hide">\n                    </div>\n                '+this._dialogContentTemplate()+'\n                </div>\n                <div class="modal-footer">\n                    <button data-button="canel" type="button" class="btn btn-primary btcancel"\n                        data-dismiss="modal">Annulla</button>\n                    <button data-button="ok" type="button" class="btn btn-primary btok"\n                        data-dismiss="modal">Ok</button>\n                </div>\n            </div>\n            <!-- /.modal-content -->\n               \n        '},_showError:function(e,t){e.jQe().find("[data-error_container]").removeClass("hide").html(t)},_hideError:function(e){e.jQe().find("[data-error_container]").addClass("hide").html("")},addUpload:function(e){var t=this,a=app.customDialog(t._dialogTemplate(),{ok:function(e){t.ok(e)},cancel:function(e){t.cancel(e)}});t._createDialogView(a),a.jQe().find(".modal-body").find("[data-preview]").html(t._previewItemTemplate()),t._setUploadAjaxForm(a)},_createItem:function(e,t){var a=this;e.status=t,e.type=a.metadata.relationName,e.random_id=e.id?e.id:(new Date).getTime(),e.langs=a.langs,e.label=e[a.labelField]?e[a.labelField]:"";var n=Component.parseHtml(a._itemTemplate());jQuery(n).find("[data-preview]").html(a._previewItemTemplate()),0==n.find("[data-model_fields]").length&&a.app.log.error("[data-model_fields] selector not found");for(var r in a.uploadFields){var i=a.uploadFields[r];_.indexOf(a.mainformFields,i)<0||n.find("[data-model_fields]").append(jQuery("<input>").attr({type:"hidden",name:a.key+"-"+i+"[]",value:e[i]}))}for(var r in a.fields){var i=a.fields[r];_.indexOf(a.mainformFields,i)<0||n.find("[data-model_fields]").append(jQuery("<input>").attr({type:"hidden",name:a.key+"-"+i+"[]",value:e[i]}))}a.app.log.debug("RenderHasmanyUploadImage._createItem",e),jQuery.renderTemplate(jQuery(n),jQuery(n),e),a._showItemUploadedPreview(n,e),n.find("[data-pk]").attr("data-pk",e.id);var o=n.html();return n.remove(),o}},RenderAutocomplete=Render.extend({url:null,type:"autocomplete",classData:"autocomplete",classTemplate:"autocomplete",autocomplete_view_selector:"[data-render_autocomplete_view]",autocomplete_input_selector:"[data-render_autocomplete_input]",fields:[],modelData:null,resources:["typeahead/bootstrap3-typeahead.min.js","typeahead/typeahead.bundle.js","typeahead/typeaheadjs.css"],metadata:{autocompleteModel:null,method:null,separator:null,n_items:null,model_description:[]},_getLabelValue:function(e){var t=this,a=t.app.translate("general-search");if(!e)return a;if(!t.metadata.model_description)return e.label?e.label:a;a="";var n=t.metadata.separator?t.metadata.separator:" ";for(var r in t.metadata.model_description)e[t.metadata.model_description[r]]&&(a+=e[t.metadata.model_description[r]],r<t.metadata.model_description.length-1&&(a+=n));return a},_getInputViewName:function(){var e=this,t=e.key;return t.indexOf("[]")>=0?(t=t.substr(0,t.length-2),t+"_view[]"):t+"_view"},_getFieldValue:function(e){var t=this;return e&&0!==e.length&&t.fields&&0!==t.fields.length?e[t.fields[0]]:""},_createUrl:function(){var e=this,t=Route.factory("autocomplete",{values:{modelName:e.metadata.autocompleteModel}}),a=e.url?e.url:t.getUrl();if(a+="?",e.metadata.fields)for(var n in e.metadata.fields)a+="field[]="+e.metadata.fields[n]+"&";return a+=e.metadata.separator?"&separator="+e.metadata.separator:"",a+=e.metadata.n_items?"&n_items="+e.metadata.n_items:"",a+=e.metadata.method?"&method="+e.metadata.method:""},_renderSelectedValue:function(){var e=this,t=jQuery(e.container).find("[data-render_element]");t.on("typeahead:selected",function(t,a){var n=jQuery(e.container).find('input[name="'+e.key+'"]'),r=e._getInputViewName(),i=jQuery(e.container).find('[data-render_autocomplete_view="'+r+'"]');a.id?n.val(a.id):n.val(""),i.text(e._getLabelValue(a.data)),e.ev_selected(a)})},getAutocompleteRow:function(e){return e},ev_selected:function(e){},getValue:function(){var e=this;return jQuery(e.container).find(e.control_selector).val()}});RenderAutocompleteEdit=RenderAutocomplete.extend({render:function(e){var t=this,a=jQuery(t.container).find(t.control_selector);a.attr("name",t.key).attr("value",t.value);var a=jQuery(t.container).find(t.autocomplete_input_selector),n=t._getInputViewName();a.attr("name",n).val(t._getFieldValue(t.modelData)).attr("value",t._getFieldValue(t.modelData));var a=jQuery(t.container).find(t.autocomplete_view_selector);return a.attr("data-render_autocomplete_view",n).html(t._getLabelValue(t.modelData)),e()},finalize:function(e){var t=this,a=jQuery(t.container).find(t.autocomplete_input_selector),n=t._createUrl(),r=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.label)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:n+"&term=%QUERY",wildcard:"%QUERY",filter:function(e){return jQuery.map(e.result,function(e){return t.getAutocompleteRow(e)})}}});return r.initialize(),a.typeahead(null,{displayKey:"label",source:r.ttAdapter()}),t._renderSelectedValue(),e()},_template:function(){return'<div class="input-group">\n                    <span style="height:19px" class="input-group-addon" id="basic-addon1" data-render_autocomplete_view data-lang="autocomplete-nonselezionato"></span>\n                    <input data-render_control type="hidden" name="" value="">\n                    <div data-render_element class="autosuggest" data-minLength="1" data-queryURL="php/view/demo.autosuggest.php?limit=10&search=">\n                        <input data-render_autocomplete_input type="text" name="src" placeholder="" class="form-control typeahead" />\n                    </div>\n                </div>'}});var RenderHasmanyUploadImage=Render.extend({langs:["it"],limit:null,modelName:null,uploadModelName:null,routeName:"uploadfile",vkey:null,labelField:"filename",uploadFields:["ext","random","id","status","original_name","filename","mimetype","modelName","type"],fields:["nome","descrizione"],mainformFields:["nome","descrizione","original_name","filename","ext","random","id","status","mimetype"],icon_selector:"[data-icon_img]",_showItemUploadedPreview:function(e,t){var a=t.filename?t.filename:t.full_filename,n=Server.getUrl("/imagecache/small/"+a);jQuery(e).find("[data-icon]").attr("src",n)},_bindActions:function(){var e=this;jQuery(e.container).find("[data-button_delete]").unbind("click"),jQuery(e.container).find("[data-button_delete]").click(function(){var t=jQuery(this).closest("[data-upload_item]").index();e.deleteItem(t)}),jQuery(e.container).find("[data-button_edit]").unbind("click"),jQuery(e.container).find("[data-button_edit]").click(function(){return void alert("da implementae")})},_checkLimit:function(){var e=this;if(!e.limit)return jQuery(e.container).find("[data-render_limit]").addClass("hide"),void jQuery(e.container).find("[data-button_add]").removeClass("hide");var t=0;jQuery.each(jQuery(e.container).find("[data-upload_item]"),function(){jQuery(this).hasClass("hide")||t++}),e.app.log.debug("CHECK LIMIT",t,e.limit),t>=e.limit?(jQuery(e.container).find("[data-render_limit]").removeClass("hide"),jQuery(e.container).find("[data-button_add]").addClass("hide")):(jQuery(e.container).find("[data-render_limit]").addClass("hide"),jQuery(e.container).find("[data-button_add]").removeClass("hide"))},renderNewItem:function(e){var t=this;t.app.log.debug("upload new item",t.container,'[data-render_list="'+t.key+'"]',e);var a=t._createItem(e,"new");jQuery(t.container).find('[data-render_list="'+t.key+'"]').append(a),t._bindActions(),t._checkLimit()},deleteItem:function(e){var t=this,a=jQuery(t.container).find("[data-render_list]"),n=a.find('input[name="'+t.key+'-status[]"]:eq('+e+")").val();t.app.log.debug(t.uploadType+".deleteItem  status "+n),"new"==n?(a.find("[data-upload_item]:eq("+e+")").remove(),t._checkLimit()):app.confirmDialog("Rimuovo l'immagine ?",{ok:function(){a.find('input[name="'+t.key+'-status[]"]:eq('+e+")").attr("value","deleted"),a.find("[data-upload_item]:eq("+e+")").addClass("hide"),t._checkLimit()}})},ok:function(e){var t=this,a=e.jQe().find("form").serializeAssoc();a.updated_at=new Date,t.renderNewItem(a)},cancel:function(){},_setUploadFieldsType:function(){var e=this,t=app.getView(e.vkey);for(var a in e.uploadFields)t.fields_config[e.uploadFields[a]]={type:"hidden"}},_setFieldsType:function(){var e=this,t=app.getView(e.vkey);for(var a in e.fields)t.fields_config[e.fields[a]]={type:"input"}},getValue:function(){var e=this,t=[];return jQuery.each(jQuery(e.container+" ul li"),function(){var e=jQuery(this).find("input").serializeArray(),a={};for(var n in e)a[e[n].name]=e[n].value;t.push(a)}),t},afterUpload:function(e){},_dialogContentTemplate:function(){return'\n            <div id="loader_foto"></div>\n            <form enctype="multipart/form-data" method="POST"\n                action="" encoding="multipart/form-data"\n                name="ormupload">\n                <div data-custom_html>\n        \n                </div>\n                <table class="table">\n                    <tr>\n                        <td>\n                            <div >\n                                <span data-label="general-accepted-extensions"></span>:</div>\n                                <div data-label="general-extensions-foto"></div>\n                                <div >Max <span data-label="general-upload-max-filesize" ></span> \n                            </div>\n                        </td>\n                        <td>\n                            <div class="btn-group">\n                                <input class="btn btn-default" type="file" name="file">\n                            </div>\n                        </td>\n                        <td>\n                            <div >\n                                <div data-preview data-field="data"></div>\n                            </div>\n                        </td>\n                        <td>\n\n                        </td>\n                    </tr>\n                </table>\n                <div data-view_container>\n            \n                </div>\n            </form>\n            \n        '},_previewItemTemplate:function(){return"\n            <img data-icon class=\"button-move\" src=\"\" data-attrs=\"{src:(typeof urls !== 'undefined')?Server.getUrl(urls+'small'):Server.getUrl('/imagecache/small/'+filename)}\">\n        "}});RenderHasmanyUploadImageEdit=RenderHasmanyUploadImage.extend(TraitUpload),RenderHasmanyUploadImageEdit=RenderHasmanyUploadImageEdit.extend({resources:["jquery.form.js","jquery-sortable.js"],render:function(e){var t=this,a="";t.jQe().find("[data-upload_title]").html(t.app.translate("model-"+t.uploadModelName,2)),t.jQe().find("[data-button_add]").html(t.app.translate("general-add")+" "+t.app.translate("model-"+t.uploadModelName,1)),t.jQe().find("[data-render_list]").attr("data-render_list",t.key);for(var n in t.value)a+=t._createItem(t.value[n],"updated");t.jQe().find("[data-render_limit]").addClass("hide"),t.jQe().find('[data-render_list="'+t.key+'"]').html(a),t.jQe().find("[data-pk]").attr("data-pk",t.key);var r=t.key+"_exists";return jQuery("<input>").attr({type:"hidden",name:r,value:1}).appendTo(t.jQe()),e()},finalize:function(e){var t=this;return t._bindActions(),t._checkLimit(),0==jQuery(t.container).length?void t.app.log.warn("Upload "+t.uploadType+" container not found ",t.container):(jQuery(t.container).find("[data-button_add]").click(function(){t.addUpload()}),jQuery(t.container).find(".sort_class").sortable({handle:".button-move"}),e())},_itemTemplate:function(){return'\n            <li class="list-unstyled" data-upload_item>\n                <div class="col col-sm-12 thumbnail">\n                    <div data-model_fields></div>\n                    <div class="clearfix">\n                        <small class="pull-left" data-field="label" data-trim="12" data-attrs="{title:label}"></small>\n                        <button class="btn-danger btn-xs pull-right" type="button" data-button_delete data-pk="" title="Cancella Foto"><i class="fa fa-times-circle"></i></button>\n    \n                    </div>\n                    <div data-preview data-field="data"></div>\n                </div>\n            </li>\n        '},_template:function(){return'\n            <div class="" data-render_element >\n               <div class="col col-sm-12">\n                    <div class="panel panel-info">\n                        <div class="panel-heading" data-upload_title>\n                            <br/>\n                            <span><small data-foto-msg></small></span>\n                        </div>\n                        <div class="panel-body">\n                            <ul class="list-group sort_class list-inline" data-render_list >\n                            <!--  -- contenitore lista fotos -- -->\n                            </ul>\n                            <div>\n                                <div data-render_limit data-lang="general-max_limit_reached"></div>\n                                \n                            </div>\n                        </div>\n                        <div class="panel-footer">\n                            <div>\n                                <button data-button_add data-pk="" type="button" class="btn btn-primary">\n                                    <span data-lang="general-add"></span> <span data-lang="general-foto"></span>\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n               </div>\n           </div>\n        '}}),RenderHasmanyUploadImageView=RenderHasmanyUploadImage.extend({render:function(e){var t=this;if(t.value&&t.value.length>0){var a=t.value;if(t.limit){a=[];for(var n=0;n<t.limit;n++)n<t.value.length&&a.push(t.value[n])}for(var r in a){var i=Component.parseHtml(t._previewItemTemplate());t.jQe().find("[data-render_list]").append(jQuery.getTemplate(i,a[r]))}}else t.jQe().find("[data-button_upload]").addClass("disabled");return e()},_template:function(){return'\n            <div data-render_element>\n                <ul class="list-unstyled" data-render_list >\n                    <!--  -- contenitore lista fotos -- -->\n                </ul>\n            </div>\n        '},_itemTemplate:function(){return'\n        <li>\n            <img class="img-circle img-list" src="" data-attrs="{src:Server.getUrl(urls+\'icon\')}" />\n        </li>\n    '}});var RenderHasmanyUploadAttachment=Render.extend({langs:["it"],limit:null,modelName:null,uploadModelName:null,routeName:"uploadfile",iconSize:"default",icons:{"default":{"default":"fa fa-2x fa-file-o",xls:"fa fa-2x fa-file-excel-o",zip:"fa fa-2x fa-file-archive-o",mp3:"fa fa-2x fa-audio-o",jpg:"fa fa-2x fa-image-o",pdf:"fa fa-2x fa-file-pdf-o",txt:"fa fa-2x fa-file-text-o"},big:{"default":"fa fa-3x fa-file-o",xls:"fa fa-3x fa-file-excel-o",zip:"fa fa-3x fa-file-archive-o",mp3:"fa fa-3x fa-audio-o",jpg:"fa fa-3x fa-image-o",pdf:"fa fa-3x fa-file-pdf-o",txt:"fa fa-3x fa-file-text-o"},small:{"default":"fa fa-file-o",xls:"fa fa-file-excel-o",zip:"fa fa-file-archive-o",mp3:"fa fa-audio-o",jpg:"fa fa-image-o",pdf:"fa fa-file-pdf-o",txt:"fa fa-file-text-o"}},vkey:null,labelField:"filename",uploadFields:["ext","random","id","status","original_name","filename","mimetype","modelName","type"],fields:["nome","descrizione"],mainformFields:["nome","descrizione","original_name","filename","ext","random","id","status","mimetype"],icon_selector:"[data-icon_img]",_showItemUploadedPreview:function(e,t){var a=this;e.find(a.icon_selector).addClass(a.icons[t.ext]).addClass("fa-3x")},_bindActions:function(){var e=this;jQuery(e.container).find("[data-button_delete]").unbind("click"),jQuery(e.container).find("[data-button_delete]").click(function(){var t=jQuery(this).closest("[data-upload_item]").index();e.deleteItem(t)}),jQuery(e.container).find("[data-button_edit]").unbind("click"),jQuery(e.container).find("[data-button_edit]").click(function(){return void alert("da implementae")})},_checkLimit:function(){var e=this;if(!e.limit)return jQuery(e.container).find("[data-render_limit]").addClass("hide"),void jQuery(e.container).find("[data-button_add]").removeClass("hide");var t=0;jQuery.each(jQuery(e.container).find("[data-upload_item]"),function(){jQuery(this).hasClass("hide")||t++}),t>=e.limit?(jQuery(e.container).find("[data-render_limit]").removeClass("hide"),jQuery(e.container).find("[data-button_add]").addClass("hide")):(jQuery(e.container).find("[data-render_limit]").addClass("hide"),jQuery(e.container).find("[data-button_add]").removeClass("hide"))},renderNewItem:function(e){var t=this;t.app.log.debug("upload new item",t.container,'[data-render_list="'+t.key+'"]',e);var a=t._createItem(e,"new");jQuery(t.container).find('[data-render_list="'+t.key+'"]').append(a),t._bindActions(),t._checkLimit()},deleteItem:function(e){var t=this,a=jQuery(t.container).find("[data-render_list]"),n=a.find('input[name="'+t.key+'-status[]"]:eq('+e+")").val();t.app.log.debug(t.uploadType+".deleteItem  status "+n),"new"==n?(a.find("[data-upload_item]:eq("+e+")").remove(),t._checkLimit()):app.confirmDialog("Rimuovo Documento?",{ok:function(){a.find('input[name="'+t.key+'-status[]"]:eq('+e+")").attr("value","deleted"),a.find("[data-upload_item]:eq("+e+")").addClass("hide"),t._checkLimit()}})},ok:function(e){var t=this,a=e.find("form").serializeAssoc();a.updated_at=new Date,t.renderNewItem(a)},cancel:function(){},_setUploadFieldsType:function(){var e=this,t=app.getView(e.vkey);for(var a in e.uploadFields)t.fields_config[e.uploadFields[a]]={type:"hidden"}},_setFieldsType:function(){var e=this,t=app.getView(e.vkey);for(var a in e.fields)t.fields_config[e.fields[a]]={type:"input"}},getValue:function(){var e=this,t=[];return jQuery.each(jQuery(e.container+" ul li"),function(){var e=jQuery(this).find("input").serializeArray(),a={};for(var n in e)a[e[n].name]=e[n].value;t.push(a)}),t},afterUpload:function(e){},_dialogContentTemplate:function(){return'\n            <div id="loader_foto"></div>\n            <form enctype="multipart/form-data" method="POST"\n                action="" encoding="multipart/form-data"\n                name="ormupload">\n                <div data-custom_html>\n        \n                </div>\n                <table class="table">\n                    <tr>\n                        <td>\n                            <div >\n                                <span data-label="general-accepted-extensions"></span>:</div>\n                                <div data-label="general-extensions-attachment"></div>\n                                <div >Max <span data-label="general-upload-max-filesize" ></span> \n                            </div>\n                        </td>\n                        <td>\n                            <div class="btn-group">\n                                <input class="btn btn-default" type="file" name="file">\n                            </div>\n                        </td>\n                        <td>\n                            <div >\n                                <div data-preview data-field="data"></div>\n                            </div>\n                        </td>\n                        <td>\n\n                        </td>\n                    </tr>\n                </table>\n                <div data-view_container>\n            \n                </div>\n            </form>\n            \n        '},_previewItemTemplate:function(){return'\n            <i class="button-move fa fa-3x fa-file-pdf-o" data-icon></i>\n        '}});RenderHasmanyUploadAttachmentEdit=RenderHasmanyUploadAttachment.extend(TraitUpload),RenderHasmanyUploadAttachmentEdit=RenderHasmanyUploadAttachmentEdit.extend({resources:["jquery.form.js","jquery-sortable.js"],render:function(e){var t=this,a="";t.jQe().find("[data-upload_title]").html(t.app.translate("model-"+t.uploadModelName,2)),t.jQe().find("[data-button_add]").html(t.app.translate("general-add")+" "+t.app.translate("model-"+t.uploadModelName,1)),t.jQe().find("[data-render_list]").attr("data-render_list",t.key);for(var n in t.value)a+=t._createItem(t.value[n],"updated");t.jQe().find("[data-render_limit]").addClass("hide"),t.jQe().find('[data-render_list="'+t.key+'"]').html(a),t.jQe().find("[data-pk]").attr("data-pk",t.key);var r=t.key+"_exists";return jQuery("<input>").attr({type:"hidden",name:r,value:1}).appendTo(t.jQe()),e()},finalize:function(e){var t=this;return t._bindActions(),t._checkLimit(),0==jQuery(t.container).length?void t.app.log.warn("Upload "+t.uploadType+" container not found ",t.container):(jQuery(t.container).find("[data-button_add]").click(function(){t.addUpload()}),jQuery(t.container).find(".sort_class").sortable({handle:".button-move"}),e())},_itemTemplate:function(){return'\n            <li class="list-unstyled" data-upload_item>\n                <div class="col col-sm-12 thumbnail">\n                    <div data-model_fields></div>\n                    <div class="clearfix">\n                        <small class="pull-left" data-field="label" data-trim="12" data-attrs="{title:label}"></small>\n                        <button class="btn-danger btn-xs pull-right" type="button" data-button_delete data-pk="" title="Cancella Foto"><i class="fa fa-times-circle"></i></button>\n    \n                    </div>\n                    <div data-preview data-field="data"></div>\n                </div>\n            </li>\n        ';
},_template:function(){return'\n            <div class="" data-render_element >\n               <div class="col col-sm-12">\n                    <div class="panel panel-info">\n                        <div class="panel-heading" data-upload_title>\n                            <br/>\n                            <span><small data-foto-msg></small></span>\n                        </div>\n                        <div class="panel-body">\n                            <ul class="list-group sort_class list-inline" data-render_list >\n                            <!--  -- contenitore lista fotos -- -->\n                            </ul>\n                            <div>\n                                <div data-render_limit data-lang="general-max_limit_reached"></div>\n                                \n                            </div>\n                        </div>\n                        <div class="panel-footer">\n                            <div>\n                                <button data-button_add data-pk="" type="button" class="btn btn-primary">\n                                    <span data-lang="general-add"></span> <span data-lang="general-foto"></span>\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n               </div>\n           </div>\n        '}});var RenderHasmanyUploadAttachmentView=RenderHasmanyUploadAttachment.extend((_RenderHasmanyUploadA={_template:function(){return'\n            <div data-render_element>\n                <ul class="list-unstyled" data-render_list >\n                    <!--  -- contenitore lista fotos -- -->\n                </ul>\n            </div>\n        '},_itemTemplate:function(){return'\n            <li>\n                <a class="small" target="_blank" href="#"\n                        data-href="\'/downloadfile/\'+id" data-totranslate="true" data-attrs="{\'title\':full_filename}" data-append="true">\n                            <i data-class="icon" />\n                </a>\n            </li>\n        '},render:function(e){var t=this;if(t.value&&t.value.length>0){var a=t.value;if(t.limit){a=[];for(var n=0;n<t.limit;n++)n<t.value.length&&a.push(t.value[n])}for(var r in a){a[r].icon=t.icons[t.iconSize][a[r].ext];var i=Component.parseHtml(t._previewItemTemplate());t.jQe().find("[data-render_list]").append(jQuery.getTemplate(i,a[r]))}}else t.jQe().find("[data-button_upload]").addClass("disabled");return e()}},_defineProperty(_RenderHasmanyUploadA,"_template",function(){return'\n            <div data-render_element>\n                <ul class="list-unstyled" data-render_list >\n                    <!--  -- contenitore lista fotos -- -->\n                </ul>\n            </div>\n        '}),_defineProperty(_RenderHasmanyUploadA,"_itemTemplate",function(){return'\n        <li>\n            <img class="img-circle img-list" src="" data-attrs="{src:Server.getUrl(urls+\'icon\')}" />\n        </li>\n    '}),_RenderHasmanyUploadA)),RenderHasmany=Render.extend({type:"hasmany",_views:[],jsonData:null,limit:null,separator:null,fields:[],init:function(e,t){this._super(e,t)},metadata:{modelRelativeName:null,relationName:null},getValue:function(){var e=this;if("view"==e.mode)return e.value;if(!e.jsonData)return[];var t=Object.keys(e.jsonData.result);t.push("status");for(var a=[],n='input[name*="'+Utility.snakeCase(e.metadata.modelRelativeName)+'-status"]',r=jQuery(e.container).find(n).length,i=0;i<r;i++){var o={};for(var l in t){var d=t[l],u='input[name*="'+Utility.snakeCase(e.metadata.modelRelativeName)+"-"+d+'"]';console.log("field selector",u),o[d]=jQuery(jQuery(e.container).find(u).get(i)).val()}console.log(i,o),a.push(o)}return a},_bindDeleteEvents:function(){var e=this;jQuery(e.container).find("[data-button_delete]").unbind("click"),jQuery(e.container).find("[data-button_delete]").click(function(){var t=jQuery(this).closest("li").index(),a=jQuery(this).closest("li").find("[data-view_index]").data("view_index");e.app.log.debug("found index ",t,"viewindex",a),e.deleteHasManyItem(e.hasManyModelRelativeName,t,a)})},renderNewItem:function(e){var t=this,a="updated",n=[];if(e)e.status=a;else{n=Object.keys(t.jsonData.result),e={};for(var r in t.jsonData.result)e[r]=t.jsonData.result[r];e.status="new"}console.log("renderNewItem",e);var i=t.modelConf?t.modelConf:app.getConf(t.metadata.relationName,"edit");i.actions=[],jQuery.inArray("status",i.fields)<0&&i.fields.push("status"),jQuery.inArray("id",i.fields)<0&&i.fields.push("id"),i.fields_config.status={type:"hidden"},i.langs=t.langs,i.prefixKey=t.key+"-",i.modelName=t.metadata.relationName,i.routeName=null;var o=Component.parseHtml(t._itemTemplate());o.attr("id",t.key+"_"+Math.floor(1e5*Math.random())),o.find("[data-hasmany_item]").attr("data-hasmany_item",o.attr("id")),t.jQe().find('[data-render_list="'+t.key+'"]').append(o.html()),i.container='[data-hasmany_item="'+o.attr("id")+'"]',o.remove(),i.data={value:e,translations:t.jsonData.translations,metadata:t.jsonData.metadata,resultParams:t.jsonData.resultParams};var l=new ViewHasmanyEdit(i);l.hasManyIndex=t._views.length,console.log("LLL",l),t._views.push(l),jQuery(i.container).attr("data-view_index",l.hasManyIndex),l.show(),console.log("VIEW: ",l)},deleteHasManyItem:function(e,t,a){var n=this,r=jQuery(n.container).find('[data-render_id="'+n.key+'"]'),i=r.find('input[name="'+n.key+"-status["+a+']"]').val();n.app.log.debug("deleteHasManyItem index",a," status ",i),"new"==i?r.find("[data-hasmany_item_structure]:eq("+t+")").remove():(r.find('input[name="'+n.key+"-status["+a+']"]').val("deleted"),r.find("[data-hasmany_item_structure]:eq("+t+")").addClass("hide"))},getJsonData:function(e){var t=this,a=Route.factory("insert_hasmany",{values:{modelName:t.metadata.relationName}});Server.route(a,function(t){e(t)})}}),RenderHasmanyEdit=RenderHasmany.extend({resources:["jquery-sortable.js"],render:function(e){var t=this;console.log("edit"),t.jQe().find("[data-render_list]").attr("data-render_list",t.key);var a=t.key+"_exists";return jQuery("<input>").attr({type:"hidden",name:a,value:1}).appendTo(t.jQe()),e()},finalize:function(e){var t=this;t.app.log.debug("finalize ",t.key," modelName "+t.metadata.relationName,jQuery(t.container).find('[data-hasmany_container="'+t.metadata.relationName+'"]').length);var a=function(){console.log("_tmp",t.value);for(var a in t.value){var n=t.value[a];t.renderNewItem(n)}return jQuery(t.container).find("[data-hasmany_title]").html(t.app.translate("model-"+Utility.snakeCase(t.metadata.relationName),2)),jQuery(t.container).find("[data-button_add]").html(t.app.translate("general-add")+" "+t.app.translate("model-"+Utility.snakeCase(t.metadata.relationName))),t._bindDeleteEvents(),jQuery(t.container).find("[data-button_add]").click(function(){t.renderNewItem(),t._bindDeleteEvents()}),jQuery(t.container).find(".sort_class").sortable({handle:".button-move"}),e()};t.jsonData?a():(console.log("JSONDATA",t.jsonData),t.getJsonData(function(e){t.jsonData=e,a()}))},_template:function(){return'\n            <div class="" data-render_element >\n               <div class="col col-sm-12">\n                <div class="panel panel-warning">\n                    <div class="panel-heading" data-hasmany_title>\n                    </div>\n                    <div class="panel-body">\n                        <p data-hasmany_title_msg></p>\n                        <ul class="list-unstyled sort_class hasmany-list" data-render_list >\n                        <!--  -- contenitore hasmany -- -->\n                        </ul>\n                        <div>\n                            <!--<div data-render_limit>Limite massimo raggiunto</div>-->\n        \n                        </div>\n                    </div>\n                    <div class="panel-footer">\n                        <div >\n                                <button data-button_add data-pk="" type="button" class="btn btn-primary"></button>\n                            </div>\n                    </div>\n                </div>\n                </div>\n            </div>\n        '},_itemTemplate:function(){return'\n            <li class="col col-lg-6 col-md-6 col-sm-12 col-xs-12" data-hasmany_item_structure>\n                <div class="clearfix" >\n                  <div class="col col-sm-12 button-move" data-hasmany_item>\n                  </div>\n    \n                </div>\n                <hr />\n            </li>\n        '}}),RenderHasmanyView=RenderHasmany.extend({render:function(e){var t=this;if(t.value&&t.value.length>0){var a=[],n=t.limit&&t.limit<t.value.length?t.limit:t.value.length,r=Component.parseHtml(t._itemTemplate());if(t.templateId||t.template){r=t.templateId?jQuery(t.templateId):Component.parseHtml(t.template);for(var i=0;i<n;i++)a.push(t.value[i])}else for(var o=t.separator?t.separator:" ",i=0;i<n;i++){var l="";for(var d in t.fields){var u=t.fields[d];l+=t.value[i][u],d<t.fields.length-1&&(l+=o)}a.push({label:l})}var s={items:a};t.jQe().find('[data-field="items"]').html(r.html()),jQuery.renderTemplate(t.jQe(),t.jQe(),s)}else t.jQe().find("[data-button_upload]").addClass("disabled");return e()},_template:function(){return'\n            <div data-render_element>\n                <div class="list-unstyled" data-render_list >\n                    <!--  -- contenitore lista hasmany data dal template  default_hasmany_view_items_tpl-- -->\n                    <ul class="list-unstyled" data-field="items" data-self>\n                    </ul>\n                </div>\n            </div>\n        '},_itemTemplate:function(){return'      \n            <li>\n                <span data-field="label" ></span>\n            </li>\n        '}}),RenderHasmanyThrough=Render.extend({selected:[],modelName:"none",last_searched_result:null,hasmany_container:"[data-hasmany_container]",selected_container:"[data-selected_container]",title_selector:"[data-render_title]",morph:null,label_field:null,addNew:!1,searchField:null,searchDescription:null,itemAddTemplate:null,itemViewTemplate:null,listItemsTemplate:null,metadata:{autocompleteModel:null},init:function(e,t){this._super(e,t),this.selected=[],this.last_searched_result=null},getValue:function(){var e=this;return"view"==e.mode?e.value:null},_populate:function(e){var t=this,a=jQuery(t.container).find('[data-hasmany_container="'+t.key+'"]');jQuery(a).find("[data-add]").unbind("click"),jQuery(a).html(jQuery("#default_spinner_tpl").html());var n=null,r=t.morph,n=(t.label_field,"/api/json/autocomplete/"+t.metadata.autocompleteModel+"?term="+e);t.search_field&&(n+="&field="+t.search_field),t.search_description&&(n+="&description="+t.search_description),t.metodo&&(n+="&method="+t.metodo),Server.get(Server.getUrl(n),{},function(e){if(e.error)return void t.app.errorDialog(e.msg);delete t.last_searched_result,t.last_searched_result=e.result;var n=Component.parseHtml(t._itemTemplate());jQuery.renderTemplate(n,a,e.result),jQuery(a).find("[data-add]").click(function(){if(r)var a=jQuery(this).data("morph_type")+"_"+jQuery(this).data("morph_id");else var a=jQuery(this).data("id");var n=e.result.find(function(e){return e.id==a});t._addItem(a,jQuery(this).data("label"),jQuery(this).data("morph_type"),jQuery(this).data("morph_id"),n.data)})})},_addItem:function(e,t,a,n,r){var i=this;if(isNaN(e)||(e=parseInt(e)),jQuery.inArray(e,i.selected)>=0)return!1;i.app.log.debug("Add item id: ",e),i.selected.push(e);var o=jQuery(i.container).find('[data-selected_container="'+i.metadata.autocompleteModel+'"]');if(!r){for(var l in i.last_searched_result)if(n){if(i.last_searched_result[l].morph_id==n&&i.last_searched_result[l].morph_type==a){r=i.last_searched_result[l].data;break}}else if(i.last_searched_result[l].id==e){r=i.last_searched_result[l].data;break}r||(r={},i.app.log.warn("nono trovato nulla "+e))}r.id=e,r.label=t,r.status="new",r.morph_type=a,r.morph_id=n,r.morph=!1,i.morph&&(r.morph=!0);var d=Component.parseHtml(i._addedItemTemplate());jQuery.renderTemplate(d,d,r),jQuery.each(d.find("input,textarea,select"),function(e,t){var a=i._getFieldName(jQuery(this).data("field"));jQuery(this).attr("name",a)}),jQuery(o).append(d.html()),d.remove(),jQuery(o).find("[data-button_delete]").unbind("click"),jQuery(i.container).find("[data-button_delete]").click(function(){var e=jQuery(this).closest("[data-hasmany_through_item]").index();i._deleteItem(e)}),jQuery(i.container).find('[data-control_container="'+i.key+'"]').trigger("change",[jQuery(this)])},_deleteItem:function(e){var t=this,a=jQuery(t.container).find('[data-selected_container="'+t.metadata.autocompleteModel+'"]'),n=t._getFieldName("id"),r=jQuery(a).find("[data-hasmany_through_item]:eq("+e+")").find('input[name="'+n+'"]').val();return isNaN(r)||(r=parseInt(r)),r?(t.selected=_.without(t.selected,r),jQuery(a).find("[data-hasmany_through_item]:eq("+e+")").remove(),void jQuery(t.container).find('[data-control_container="'+t.key+'"]').trigger("change",[jQuery(this)])):(t.app.log.warn("_deleteItem "+t.key+" index container "+e+" id non valido "+r),t.app.log.warn("selected item ",t.selected),void t.app.log.warn("find rule is ",t.container,'[data-selected_container="'+t.metadata.autocompleteModel+'"]',"[data-hasmany_through_item]:eq("+e+")",'input[name="'+t.key+'-id[]"]'))},_getFieldName:function(e){var t=this,a=t.key,n="";if(t.key.indexOf("[")>=0)var a=t.key.substr(0,t.key.indexOf("[")),n=t.key.substr(t.key.indexOf("["));var r=a+"-"+e+n+"[]";return r}}),RenderHasmanyThroughEdit=RenderHasmanyThrough.extend({resources:["jquery-sortable.js"],render:function(e){var t=this;t.jQe().find(t.hasmany_container).attr("data-hasmany_container",t.key),t.jQe().find(t.selected_container).attr("data-selected_container",t.metadata.autocompleteModel),t.jQe().find(t.title_selector).html(t.app.translate("model-"+t.metadata.autocompleteModel));var a=t.key+"_exists";return jQuery("<input>").attr({type:"hidden",name:a,value:1}).appendTo(t.jQe()),e()},finalize:function(e){var t=this;t.selected=[],t.app.log.debug("hasmany_through",t.value,t.config);var a=null,n=null;for(var r in t.value){var i=t.value[r],o=i.id;t.morph&&(a=i[t.morph.id],n=i[t.morph.type],o=n+"_"+a),t._addItem(o,i[t.label_field],n,a,i)}return t._populate(""),jQuery(t.container).find("[data-search]").change(function(){t._populate(jQuery(this).val())}),t.addNew?jQuery(t.container).find("[data-button_add]").click(function(){t.app.log.info("insert "+t.modelName);var e="<viewinsert id='addnewView' model='"+t.modelName+"'></viewinsert>";jQuery("#generalDialog .modal-body").html(e),app.parse("#generalDialog .modal-body");var a=Facade.getKeyFromId("addnewView");jQuery.generalDialog(null,{btok_label:"Salva"}).ok(function(){alert("keyid"+a),Facade.controller.actionSave(a,null,{},function(e){return Facade.removeView(a),e.error?void t.app.errorDialog(e.msg):void t.container.find("[data-search]").trigger("change")})}).cancel(function(){Facade.removeView(a)})}):jQuery(t.container).find("[data-button_add]").addClass("hide"),jQuery(t.container).find(".sort_class").sortable({handle:".button-move"}),e()},_template:function(){return'\n           <div class="" data-render_element >\n              <div class="col col-sm-12" >\n                    <div class="panel panel-info">\n                       <div class="panel-heading" data-render_title>\n        \n                       </div>\n                       <div class="panel-body padding-3">\n        \n                           <div class="col col-md-4 col-sm-12 padding-6 panel panel-default panel-body" >\n                               <h5>Elementi selezionati</h5>\n                               <ul class="list-unstyled sort_class " data-selected_container>\n                               </ul>\n        \n                           </div>\n                              <div class="col col-md-8 col-sm-12 padding-15">\n        \n                                   <div class="input-group margin-bottom-10">\n                                      <span class="input-group-addon " style="cursor:pointer">\n                                          <i class="fa fa-search"></i>\n                                          <!--\n                                          <button class="btn btn-default btn-sm" type=button data-lang="general-search">Go</button>-->\n                                      </span>\n                                      <input class="form-control "  data-search type="text" value="" placeholder="Inserire parole da ricercare">\n                                      <span class="input-group-addon ">\n                                         <i data-button_add class="fa fa-plus"></i>\n                                     </span>\n                                   </div>\n        \n                                      <div class= style="position:relative; overflow:hidden;">\n                                          <ul class="list-unstyled list-hover list-inline" data-hasmany_container data-slimscroll-visible="false" style="overflow: auto; width: auto; min-height: 60px;">\n        \n                                          </ul>\n                                      </div>\n        \n                              </div>\n                       </div>\n                    </div>\n                </div>\n            </div>\n        '},_itemTemplate:function(){return'\n           <li class="col col-md-6 col-sm-12 col-xs-12">\n               <div class="fullwidth">\n                <span style="pointer:hand" class="label label-default" data-add data-id data-label data-morph_type data-morph_id data-attrs="{\'data-id\':id,\'data-label\':label,\'data-morph_type\':morph_type,\'data-morph_id\':morph_id}">\n                    <i class="fa fa-plus"></i>\n                </span>\n               <span data-field=\'label\'></span>\n               </div>\n           </li>\n        '},_addedItemTemplate:function(){return'\n           <li class="padding-bottom-6 border-bottom-1" data-hasmany_through_item>\n               <div class="line-height-30">\n                    <span style="pointer:hand" class="button-move label label-default"><i class="fa fa-arrows"></i></span>\n                    <span style="pointer:hand" class="label label-danger" data-button_delete data-id data-label data-morph_type data-morph_id data-attrs="{\'data-id\':id,\'data-label\':label,\'data-morph_type\':morph_type,\'data-morph_id\':morph_id}"><i class="fa fa-minus"></i></span>\n        \n                    <input type="hidden" data-field="id">\n                    <input type="hidden" data-field="status">\n                    <input type="hidden" data-field="morph_type" data-remove="!morph">\n                    <input type="hidden" data-field="morph_id" data-remove="!morph">\n                    <span class="" data-field=\'label\'></span>\n               </div>\n           </li>\n        '}}),RenderHasmanyThroughView=RenderHasmanyThrough.extend({render:function(e){var t=this;if(t.app.log.info("RenderHasmany view ",t.value),t.value&&t.value.length>0){var a=t.value.length,n=[],r="";if(t.template){r=Component.parseHtml(t.template);for(var i=0;i<a;i++)n.push(t.value[i])}else{r=Component.parseHtml(t._itemTemplate());for(var o=t.separator?t.separator:" ",i=0;i<a;i++){var l="";for(var d in t.fields){var u=t.fields[d];l+=t.value[i][u],d<t.fields.length-1&&(l+=o)}n.push({label:l})}}var s={items:n};t.jQe().find('[data-field="items"]').html(r),jQuery.renderTemplate(t.jQe(),t.jQe(),s),console.log(t.jQe().html())}else t.jQe().find("[data-button_upload]").addClass("disabled");return e()},_template:function(){return'\n            <div data-render_element>\n                <ul class="list-unstyled" data-render_list data-field="items" data-self>\n                    <!--  -- contenitore lista hasmany data dal template  default_hasmany_view_items_tpl-- -->\n                </ul>\n            </div>\n        '},_itemTemplate:function(){return'\n            <li >\n                <span data-field="label"></span>\n            </li>\n\n        '}}),RenderMap=Render.extend({type:"map",classData:"map",classTemplate:"map",_lat:0,_lng:0,_hasDbValues:!1,address:null,lat_caption_selector:"[data-lat_field]",lng_caption_selector:"[data-lng_field]",lat_field_name:"lat",lng_field_name:"lng",dialogId:"#map_dialog",idViewMap:null,metadata:{apiKey:null,raggioArea:5e3,showArea:!1},getIndirizzo:function(){var e=this;return e.address?e.address:""},_showDialog:function(){var e=this,t=e._lat,a=e._lng;if(e.app.log.info("_showDialog "+t+":"+a+" markers "+Render.mymap.markers.length),0==Render.mymap.markers.length){var n=new GMapMarker;e.getIndirizzo()&&(n.address=e.getIndirizzo()),n.lat=t,n.lng=a,n.draggable=!0,e.app.log.debug("marker",n),Render.mymap.addMarker(n),Render.mymap.showQueued(function(){Render.mymap.markerToCenter(0);var t=Render.mymap.markers[0];jQuery(e.dialogId).find('input[name="'+e.lat_field_name+'"]').attr("value",t.lat).val(t.lat),jQuery(e.dialogId).find('input[name="'+e.lng_field_name+'"]').attr("value",t.lng).val(t.lng)})}else Render.mymap.updateMarker(0,{lat:t,lng:a});if(jQuery(e.dialogId).find('input[name="indirizzo"]').attr("value",e.getIndirizzo()).val(e.getIndirizzo()),jQuery(e.dialogId).find('input[name="lat"]').attr("value",t),jQuery(e.dialogId).find('input[name="lng"]').attr("value",a),e.metadata.showArea){$(e.dialogId).find("[data-area_container]").removeClass("hide");var r=$(e.dialogId).find("[data-input_raggio]");$(r).val(e.metadata.raggioArea),Render.mymap.showArea({raggio:parseInt($(r).val())}),$(r).bind("change",function(){e.metadata.raggioArea=parseInt($(r).val()),Render.mymap.showArea({raggio:parseInt($(r).val())})})}jQuery(e.dialogId).modal("show").ok(function(){e._lat=Render.mymap.markers[0].lat,e._lng=Render.mymap.markers[0].lng,e.setLatLngValues()}),setTimeout(function(){Render.mymap.markers[0].address?jQuery("#map_dialog").find("[data-lnk_address]").click():Render.mymap.setCenter(t,a)},1e3)},setLatLngValues:function(){var e=this;jQuery(e.container).find("[data-lat_field]").html(e._lat),jQuery(e.container).find("[data-lng_field]").html(e._lng);var t={};e.lat_field?t[e.lat_field]=e._lat:t.lat=e._lat,e.lng_field?t[e.lng_field]=e._lng:t.lng=e._lng,e.change(t)},activateMap:function(e,t){var a=this,n=t?t:{},r={elementId:"gmap",zoom:8,lat:a._lat,lng:a._lng,language:"it"};_.extend(r,n),Render.mymap?(setTimeout(function(){google.maps.event.trigger(Render.mymap.gmap,"resize")},500),e()):(Render.mymap=new GMap("Render.mymap"),Render.mymap.apiKey=a.metadata.apiKey,Render.mymap.elementId=r.elementId,Render.mymap.zoom=r.zoom,Render.mymap.lat=r.lat,Render.mymap.lng=r.lng,Render.mymap.language=r.language,Render.mymap.markerDragend=function(e,t){a.app.log.debug("pos",e.lat(),e.lng()),jQuery("#map_dialog").find('input[name="lat"]').attr("value",e.lat()).val(e.lat()),jQuery("#map_dialog").find('input[name="lng"]').attr("value",e.lng()).val(e.lng()),a._lat=e.lat(),a._lng=e.lng()},Render.mymap.app=a.app,Render.mymap.afterLoadScript=function(){},Render.mymap.afterInitialize=function(){console.log("afterInitialize"),setTimeout(function(){google.maps.event.trigger(Render.mymap.gmap,"resize")},500),e()},Render.mymap.loadScript())},getValue:function(){var e=this;return{lng:e._lng,lat:e._lat}},_dialogTemplate:function(){return'\n            <div id="map_dialog" class="modal fade">\n                <div class="modal-dialog">\n                    <div class="modal-content">\n                        <div class="modal-header">\n                            <button type="button" class="close" data-dismiss="modal"\n                                    aria-hidden="true">&times;</button>\n                            <h4 class="modal-title">Seleziona coordinate</h4>\n                        </div>\n                        <div class="modal-body">\n                            <div class="row">\n                                <div class="col col-xs-6">\n                                    <div class="input-group">\n                                        <span class="input-group-addon" id="basic-addon1">Indirizzo:</span>\n                                        <input type="text" class="form-control" name="indirizzo" aria-describedby="basic-addon1">\n                                        <span class="input-group-addon" id="basic-addon2"><a data-lnk_address href="javascript:void(0)"  ><i class="fa fa-search"></i> Cerca indirizzo</a></span>\n            \n                                    </div>\n                                </div>\n                                <div class="col col-xs-3">\n                                    <div class="input-group">\n                                        <span class="input-group-addon" id="basic-addon1">Lat:</span>\n                                        <input type="text" class="form-control" name="lat" aria-describedby="basic-addon1">\n                                    </div>\n                                </div>\n                                <div class="col col-xs-3">\n                                    <div class="input-group">\n                                        <span class="input-group-addon" id="basic-addon1">Lng:</span>\n                                        <input type="text" class="form-control" name="lng" aria-describedby="basic-addon1">\n    \n    \n                                    </div>\n                                </div>\n            \n                                <!-- <span>Lat:</span> <input  type="text" name="lat"> , <span>Lng:</span> <input type="text" name="lng">  -->\n    \n    \n                            </div>\n                            <div data-area_container class="row hide">\n                                <div class="col col-xs-12" >\n                                    <div class="input-group">\n                                        <span class="input-group-addon" id="basic-addon1">Cerchio di raggio in metri?</span>\n                                        <input class="form-control" data-input_raggio type="text" value="1000">\n                                    </div>\n                                </div>\n            \n            \n                                <!-- <span>Lat:</span> <input  type="text" name="lat"> , <span>Lng:</span> <input type="text" name="lng">  -->\n                            </div>\n                            <div id="gmap" style="width:100%;height:400px"></div>\n                        </div>\n                        <div class="modal-footer">\n                            <button type="button" class="btn btn-primary btcancel"\n                                    data-dismiss="modal">Annulla</button>\n                            <button type="button" class="btn btn-primary btok"\n                                    data-dismiss="modal">Ok</button>\n    \n                        </div>\n    \n                    </div>\n                    <!-- /.modal-content -->\n                </div>\n                <!-- /.modal-dialog -->\n            </div>\n        '}}),RenderMapEdit=RenderMap.extend({render:function(){var e=this;0==jQuery(e.dialogId).length&&jQuery("body").append(e._dialogTemplate()),e._lat=e.value.lat,e._lng=e.value.lng,e.jQe().find(e.lat_caption_selector).html(e._lat),e.jQe().find(e.lng_caption_selector).html(e._lng)},finalize:function(){var e=this;jQuery(e.container).find("[data-button_map]").click(function(){jQuery(e.dialogId).find("[data-lnk_address]").unbind("click"),jQuery(e.dialogId).find("[data-lnk_address]").click(function(){var t=jQuery("#map_dialog").find('input[name="indirizzo"]').val();return t&&0!=t.length?void Render.mymap.updateMarkerAddress(0,t,function(t){0==t.error?(jQuery(e.dialogId).find('input[name="lat"]').attr("value",t.pos.lat()).val(t.pos.lat()),jQuery(e.dialogId).find('input[name="lng"]').attr("value",t.pos.lng()).val(t.pos.lng()),e._lat=t.pos.lat(),e._lng=t.pos.lng(),Render.mymap.setCenter(e._lat,e._lng)):e.app.errorDialog(t.msg)}):void e.app.errorDialog("Inserire un indirizzo valido")}),e.app.waitStart(),e.activateMap(function(){e.app.waitEnd(),e._showDialog()})})},_template:function(){return'\n            <div data-control_container>\n                <button class="btn btn-default" type="button" data-button_map data-lang="general-modifymap"></button>\n                <div class="clearfix">\n                    <span class="pull-left" >\n                        <span data-lang="fields-lat"></span>: <span class="badge" data-lat_field></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n                    </span>\n                    <span class="pull-left">\n                        <span data-lang="fields-lng"></span>: <span class="badge" data-lng_field></span>\n                    </span>\n                </div>\n               \n            </div>\n        '}}),RenderMapSearch=RenderMapEdit.extend({render:function(){var e=this;e._super();var t=e.jQe().find(e.operator_selector);t.attr("name","s_"+e.key+"_operator"),t.attr("value",e.operator)},_template:function(){return'\n            <div data-control_container>\n                <button class="btn btn-default" type="button" data-button_map data-lang="general-modifymap"></button>\n                <div class="clearfix">\n                    <span class="pull-left" >\n                        <span data-lang="fields-lat"></span>: <span class="badge" data-lat_field></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n                    </span>\n                    <span class="pull-left">\n                        <span data-lang="fields-lng"></span>: <span class="badge" data-lng_field></span>\n                    </span>\n                </div>\n               <\n            </div>\n        '}}),RenderMapView=RenderMap.extend({render:function(e){var t=this;t.idViewMap||(t.idViewMap="map_"+Date.now(),t.jQe().find("[data-map_container]").attr("id",t.idViewMap)),t._lat=t.value.lat,t._lng=t.value.lng;var a={elementId:t.idViewMap};t.zoom&&(a.zoom=t.zoom),t.activateMap(function(){if(0==Render.mymap.markers.length){var a=new GMapMarker;t.getIndirizzo()&&(a.address=t.getIndirizzo()),a.txt="Lat : "+t._lat+" Lng:"+t._lng,a.lat=t._lat,a.lng=t._lng,a.draggable=!0,t.app.log.debug("marker",a),Render.mymap.addMarker(a),Render.mymap.showQueued(function(){Render.mymap.markerToCenter(0);Render.mymap.markers[0]})}else Render.mymap.updateMarker(0,{lat:lat,lng:lng});return e()},a)},_template:function(){return'\n            <div data-map_container style="width:100%;height:400px"></div>\n          '}}),RenderBelongsto=Render.extend({itemViewTemplate:null,separator:null,fields:{},nullLabel:"",getValue:function(){var e=this;return e.value}}),RenderBelongstoView=RenderBelongsto.extend({render:function(e){var t=this;if(!t.value)return void jQuery(t.container).find("[data-render_element]").html(t.nullLabel);if(t._viewItemTemplate()){var a=Component.parseHtml(t._viewItemTemplate()),n=jQuery.getTemplate(a,t.value);return void jQuery(t.container).find("[data-render_element]").html(n)}var r=t.separator?t.separator:" ",i="";for(var o in t.fields){var l=t.fields[o];i+=t.value[l],o<t.fields.length-1&&(i+=r)}return jQuery(t.container).find("[data-render_element]").html(i),e()},_template:function(){return"<div data-render_element></div>"},_viewItemTemplate:function(){return!1}}),RenderCaptcha=Render.extend({captcha_img_selector:"[data-captcha_img]",getValue:function(){var e=this;return jQuery(e.container).find(e.control_selector).val()},reload:function(){var e=this,t=Route.factory("captcha");Server.route(t,function(t){jQuery(e.container).find("[data-captcha_img]").html(t)})}}),RenderCaptchaEdit=RenderCaptcha.extend({render:function(e){var t=this,a=t.jQe().find("[data-render_control]");a.attr("name",t.key),a.attr("value",t.value);var n=t.jQe().find("img").prop("src");return n+="&rand="+Math.floor(1e4*Math.random()+1),t.jQe().find(t.captcha_img_selector).prop("src",n),e()},finalize:function(e){var t=this;return jQuery(t.container).find("[data-captcha_img]").addClass("captchajs"),jQuery(t.container).find("[data-button_reload]").click(function(){t.reload()}),t.reload(),
e()},_template:function(){return'\n            <div class="row">\n                <div class="col-sm-4" data-captcha_img  >\n            \n                </div>\n                <div class="col-sm-4">\n                        <input data-render_control="" class="form-control" type="text" name="" value="">\n                </div>\n                <div class="col-sm-4">\n                    <button class="btn btn-sm btn-default" type="button" data-button_reload>Reload</button>\n                </div>\n            </div>\n        '}}),TraintInputHelped=_.extend(TraitInput,{customValue:!0,metadata:{domainValues:{}},init:function(e,t){this._super(e,t),_.has(t,"customValue")&&(this.customValue=t.customValue)},_setData:function(){var e=this,t=jQuery(e.container).find("[data-option_values]"),a=[];for(var n in e.metadata.domainValues)a.push({value:n,label:e.metadata.domainValues[n]});jQuery.renderTemplate(t,t,a)}}),RenderInputHelpedEdit=Render.extend(TraintInputHelped).extend({render:function(e){var t=this;t._setData();var a=jQuery(t.container).find("[data-render_control]");return a.attr("name",t.key),t.customValue?a.attr("value",t.value):(a.attr("readonly","true"),_.indexOf(_.keys(t.metadata.domainValues),t.value)>=0&&a.attr("value",t.value)),e()},finalize:function(e){var t=this;return jQuery(t.container).find("[data-option_values]").find("button").click(function(){var e=jQuery(t.container).find("[data-render_control]");e.attr("value",jQuery(this).data("value")).val(jQuery(this).data("value")),t.change(jQuery(this).data("value"))}),e()},_template:function(){return'\n            <div data-render_element>\n                <input  data-render_control class="form-control" type="text" name="" value="">\n                <div data-option_values>\n                    <div class="btn-group btn-group-xs" role="group" aria-label="..." data-field="data" data-self>\n                        <button type="button" class="btn btn-default" data-html="label" data-attrs="{\'data-value\':value}"></button>\n                    </div>\n                </div>\n            </div>\n        '}}),RenderInputHelpedSearch=RenderInputHelpedEdit.extend({render:function(e){var t=this;t._super(function(){var a=jQuery(t.container).find("[data-render_control]");a.attr("name","s_"+t.key+"[]");var a=jQuery(t.container).find(t.operator_selector);return a.attr("name","s_"+t.key+"_operator"),a.attr("value",t.operator),e()})},_template:function(){return'\n            <div data-render_element>\n                <input  data-control_operator class="form-control" type="hidden" name="" value="">\n                <input  data-render_control class="form-control" type="text" name="" value="">\n                <div data-option_values>\n                    <div class="btn-group btn-group-xs" role="group" aria-label="..." data-field="data" data-self>\n                        <button type="button" class="btn btn-default" data-html="label" data-attrs="{\'data-value\':value}"></button>\n                    </div>\n                </div>\n            </div>\n        '}}),Protocol=Class.extend({value:null,metadata:{},resultParams:{},validationRules:{},jsonToData:function(e){throw"override jsonToData function "}});Protocol.factory=function(e){var t="Protocol"+Utility.pascalCase(e);try{return new window[t]}catch(a){log.error("failed to create "+t,a)}};var ProtocolRecord=Protocol.extend({jsonToData:function(e){this.value=e.result,this.metadata=e.metadata?e.metadata:{},this.resultParams=e.resultParams?e.resultParams:{},this.validationRules=e.validationRules?e.validationRules:{},this.backParams=e.backParams;for(var t in e.metadata)this.metadata[t].domainValues=e.metadata[t].options?e.metadata[t].options:null,this.metadata[t].domainValuesOrder=e.metadata[t].options_order?e.metadata[t].options_order:null}}),ProtocolList=Protocol.extend({pagination:{},has_errors:!1,backParams:{},summary:{},jsonToData:function(e){this.value=e.result.data,this.metadata=e.metadata,this.pagination=_.omit(e.result,["data","has_errors"]),this.resultParams=e.resultParams,this.summary=e.summary,this.validationRules=e.validationRules,this.backParams=e.backParams,this.has_errors=1==e.result.has_errors,this.list_header=e.data_header;for(var t in e.metadata)e.metadata[t].domainValues=e.metadata[t].options?e.metadata[t].options:null,e.metadata[t].domainValuesOrder=e.metadata[t].options_order?e.metadata[t].options_order:null}}),ProtocolDummyRecord=Protocol.extend({jsonToData:function(){this.value={},this.metadata={},this.resultParams={},this.validationRules={},this.backParams={}}}),ProtocolDummyList=Protocol.extend({pagination:{},has_errors:!1,backParams:{},summary:{},translations:{},jsonToData:function(){this.value=[],this.metadata={},this.pagination={},this.resultParams={},this.summary={},this.validationRules={},this.backParams={},this.has_errors=!1,this.list_header=""}}),Route=Class.extend({className:"Route",method:null,url:null,resultType:null,protocol:null,extraParams:{},values:{},params:{},init:function(e){var t=this;if(e)for(var a in e)t[a]=e[a]},getUrl:function(e){var t=this,a=t.url,n=e?e:t.values;for(var r in n){var i="{"+r+"}",o=new RegExp(i,"g");a=a.replace(o,n[r])}return a},getParams:function(){var e=this;return jQuery.extend(e.params,e.extra_params)},getKeys:function(){var e=this,t=/\{\w+\}+/g,a=[];do{var n=t.exec(e.url);if(n){var r=n[0].substr(1);r=r.substr(0,r.length-1),a.push(r)}}while(n);return a}});Route.factory=function(e,t){var a="Route"+Utility.pascalCase(e);if(!window[a])throw"Impossibile trovare la definizione della route "+a;var n=t?t:{};return n.className=a,new window[a](n)};var RouteList=Route.extend({method:"get",url:"/api/json/{modelName}",resultType:"list",protocol:"list"}),RouteListConstraint=RouteList.extend({url:"/api/json/{modelName}/{constraintKey}/{constraintValue}"}),RouteEdit=Route.extend({method:"get",url:"/api/json/{modelName}/{pk}/edit",resultType:"record",protocol:"record"}),RouteEditConstraint=RouteEdit.extend({url:"/api/json/{modelName}/{pk}/edit/{constraintKey}/{constraintValue}"}),RouteSearch=Route.extend({method:"get",url:"/api/json/{modelName}/search",resultType:"record",protocol:"record"}),RouteSearchConstraint=RouteSearch.extend({url:"/api/json/{modelName}/search/{constraintKey}/{constraintValue}"}),RouteInsert=Route.extend({method:"get",url:"/api/json/{modelName}/create",resultType:"record",protocol:"record"}),RouteInsertConstraint=RouteInsert.extend({url:"/api/json/{modelName}/create/{constraintKey}/{constraintValue}"}),RouteInsertHasmany=Route.extend({method:"get",url:"/api/json/{modelName}/create_has_many",resultType:"record",protocol:"record"}),RouteInsertHasmanyConstraint=RouteInsertHasmany.extend({url:"/api/json/{modelName}/create_has_many/{constraintKey}/{constraintValue}"}),RouteSave=Route.extend({method:"post",url:"/api/json/{modelName}/create",resultType:"record",protocol:"record",extra_params:{_method:"POST"}}),RouteSaveConstraint=RouteSave.extend({url:"/api/json/{modelName}/create/{constraintKey}/{constraintValue}"}),RouteUpdate=Route.extend({method:"post",url:"/api/json/{modelName}/{pk}",resultType:"record",protocol:"record",extra_params:{_method:"PUT"}}),RouteUpdateConstraint=RouteUpdate.extend({url:"/api/json/{modelName}/{pk}/{constraintKey}/{constraintValue}"}),RouteCreate=Route.extend({method:"post",url:"/api/json/{modelName}/create",resultType:"record",protocol:"record"}),RouteCreateConstraint=RouteCreate.extend({url:"/api/json/{modelName}/create/{constraintKey}/{constraintValue}"}),RouteView=Route.extend({method:"get",url:"/api/json/{modelName}/{pk}",resultType:"record",protocol:"record"}),RouteViewConstraint=RouteView.extend({url:"/api/json/{modelName}/{pk}/{constraintKey}/{constraintValue}"});RouteDelete=Route.extend({method:"post",url:"/api/json/{modelName}/{pk}",resultType:"record",protocol:"record",extra_params:{_method:"DELETE"}}),RouteMultiDelete=Route.extend({method:"post",url:"/api/json/{modelName}/deleteall",resultType:"record",protocol:"record"}),RouteSet=Route.extend({method:"post",url:"/api/json/set/{modelName}/{field}/{value}",resultType:"record",protocol:"record"}),RouteAutocomplete=RouteList.extend({method:"get",url:"/api/json/autocomplete/{modelName}",resultType:"record",protocol:"record"}),RouteCalendar=RouteList.extend({}),RouteCaptcha=Route.extend({method:"get",url:"/captchajs_img",resultType:"record",protocol:"record"}),RouteUploadfile=Route.extend({method:"post",url:"/uploadfile",resultType:"record",protocol:"record"});var Paginator=Component.extend({data:{},viewKey:null,init:function(e,t){var a=this;a.viewKey=e,a.data=t},_render:function(){var e=this;return container?void jQuery(container).html(jQuery.getTemplate(e.getTemplate(),e.data)):jQuery.getTemplate(e.getTemplate(),e.data)},_finalize:function(){var e=this;jQuery(container).find("a[data-action]").click(function(){EventManager.trigger(jQuery(this).data("action"),{viewKey:e.viewKey})}),jQuery(container).find("select[data-action]").change(function(){EventManager.trigger(jQuery(this).data("action"),{viewKey:e.viewKey,perPage:jQuery(this).val()})})},_template:function(){return'\n            <ul class="pagination pagination-sm hidden-md hidden-sm hidden-xs">\n                <li><a data-action="ActionFirstPage" href="javascript:void(0)">&laquo;</a></li>\n                <li><a data-action="ActionPrevPage" href="javascript:void(0)">&lt;</a></li>\n                <li>\n                <span style="padding:2px" >\n                    <span data-keytranslate="general-pagination_total" >Tot</span>\n                    <b><span data-field="total"></span></b>,\n                &nbsp;&nbsp;\n                    <select data-field="per_page" data-source="pagination_steps" self style="height:24px" class="pagination-input" data-action="actionPerPage">\n        \n                    </select>\n                    <span data-keytranslate="general-pagination_per_page" >Per page</span>\n                </span>\n                </li>\n                <li><a class="disabled" href="javascript:void(0)" data-page_info=""> <span data-field="current_page"></span> / <span data-field="last_page"></span> </a></li>\n                <li><a data-action="ActionNextPage" href="javascript:void(0)">&gt;</a></li>\n                <li><a data-action="ActionLastPage" href="javascript:void(0)">&raquo;</a></li>\n        \n            </ul>\n            <ul class="pagination pagination-sm hidden-lg hidden-xl">\n                <li><a data-action="actionFirstPage" href="javascript:void(0)">&laquo;</a></li>\n                <li><a data-action="actionPrevPage" href="javascript:void(0)">&lt;</a></li>\n                <li><a class="disabled" href="javascript:void(0)" data-page_info="">  <span data-field="current_page"></span> / <span data-field="last_page"></span> (<span data-field="total"></span>)</a></li>\n                <li><a data-action="actionNextPage" href="javascript:void(0)">&gt;</a></li>\n                <li><a data-action="actionLastPage" href="javascript:void(0)">&raquo;</a></li>\n        \n            </ul>\n        '}}),View=Component.extend({dummyModel:"dummy",modelName:null,renderObjs:[],data:{},type:null,langs:[],defaultRenderType:null,defaultRenderClassName:null,connectedObjs:{},defaultItemTemplateName:"no",keyId:null,app:null,_customAttrs:{},viewTypeToRenderType:{list:Render.VIEW,edit:Render.EDIT,search:Render.SEARCH,view:Render.VIEW,calendar:Render.VIEW,csv:Render.EDIT},pluginsPath:"",resources:[],route:null,routeName:null,actions:[],init:function(e){var t=this;this.renderObjs={},this.connectedObjs={},this.fields={},this._customAttrs={},this.actions=[];var a=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;for(var n in e)this[n]="function"==typeof e[n]&&a.test(e[n])?function(e,t){return function(){var e=t.apply(this,arguments);return e}}(n,e[n]):e[n];var r=t.actions.filter(function(e,a){return t.actions.indexOf(e)>=a});t.actions=r},show:function(e){var t=this,a=e?e:function(){};t.labelsContext=t.modelName,console.log("labelsContext",t.labelsContext),t.beforeLoadData(function(){t.loadData(function(){t.afterLoadData(function(){t._prepareContainer(),t.beforeRender(function(){t.render(function(){t.afterRender(function(){t.beforeFinalize(function(){t._loadExternalResources(function(){t.finalize(function(){t.afterFinalize(function(){return a()})})})})})})})})})})},"delete":function(){var e=this;EventManager.off(e.keyId+"ActionFired")},setRoute:function(e){this.route=e},getRoute:function(){var e=this,t=function(t){var a=t.getKeys();t.values={};for(var n in a)t.values[a[n]]=e[a[n]]};return e.route||(e.route=Route.factory(e.routeName)),t(e.route),e.route},loadData:function(e){var t=this;if(t.modelName==t.dummyModel)return e();if(null===t.routeName)return e();var a=t.getRoute();t.app.waitStart("...",t.container),Server.route(a,function(n){if(t.app.waitEnd(t.container),n.error)return app.errorDialog(n.msg),e();var r=Protocol.factory(a.protocol);r.jsonToData(n);var i=Object.getOwnPropertyNames(r);for(var o in i)t.data[i[o]]=r[i[o]];return jQuery.langDefs=jQuery.extend(!0,n.translations,jQuery.langDefs),e()})},setId:function(e){var t=this;t.keyId=e,jQuery(t.container).attr("vkey",e)},_renderGroups:function(e){var t=this;if(t.groups&&_.isArray(t.groups)){var a=[],n=t.groups,r=jQuery(e).find("[data-group_headers]"),i=jQuery(e).find("[data-group_fields]");for(var o in n){var l;a.push((l={group_title_class:n[o].title,group_title:n[o].title},_defineProperty(l,"group_title_class",0==o?"active":""),_defineProperty(l,"group_content_class",0==o?"active":""),_defineProperty(l,"group_id","g"+o),l))}$.renderTemplate(r,r,a),$.renderTemplate(i,i,a)}},setData:function(e){this.data=e},getFormData:function(){var e=this,t=jQuery(e.container).find('form[name="data_form"]');if(0===t.length)return e.app.log.warn('form[name="data_form"] not found!'),{};"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();var a=t.serializeAssoc(),n={};for(var r in a)if(a[r].constructor===Array){var i=/(.+)(\[\d+\])(.*)$/g,o=i.exec(r);if(o&&4==o.length){var l=o[1]+"[]"+o[3];n[l]||(n[l]=[]),n[l].push(a[r]),delete a[r]}else n[r]=a[r]}else n[r]=a[r];return n},getModelData:function(){var e=this;throw"View.getModelData is abastract. viewType is "+e.type},getItemTemplate:function(e){var t=this,a=t._getRenderConfig(e),n=a.templateName?a.templateName:t.defaultItemTemplateName,r=a.labels?a.labels:{};return Template.factory(n,{labels:r,labelsContext:[t.modelName,e].join(".")})},_buildFunctionParams:function(){throw this.type+" ._buildFunctionParams not implemented"},_evaluateFunctionProp:function(){throw this.type+" ._evaluateFunctionProp not implemented"},getRenderObj:function(e){throw this.type+" .getRenderObj not implemented"},_renderViewCustomBase:function(e){throw"_renderViewCustomBase Not implemented"},_renderViewCustomComplex:function(e){throw"_renderViewCustomComplex Not implemented"},_finalizeCustom:function(){},_getRenderMode:function(e){var t=this,a=t.viewTypeToRenderType[t.type];return t.fields_config[e]&&t.fields_config[e].mode&&(a=t.fields_config[e].mode),a},_getRenderType:function(e){var t=this,a=t.fields_config[e]&&t.fields_config[e].type?t.fields_config[e].type:t.defaultRenderType;return a},_getDefaultRenderConfig:function(e){var t=this,a={mode:t._getRenderMode(e),modelName:t.modelName,langs:t.langs};return t.operator&&t.operator[e]&&(a.operator=t.operator[e]),a},_getRenderConfig:function(e,t){var a=this,n=a._getDefaultRenderConfig(e);if(!a.fields_config[e])return n;for(var r in a.fields_config[e])n[r]=a.fields_config[e][r];return n},_attachEvents:function(){},_attachEvent:function(e,t){var a=this;e.triggerEvent=function(e,n,r){var i={viewKey:a.keyId,pk:t,params:n};EventManager.trigger(e,i,r)}},fireEvent:function(e){var t=this;t.app.log.warn("View.fireEvent "+e.eventName+"  view "+e.type+" not overladed")},fireToConnected:function(e){throw" fireToConnected not implemented"},_getRenderData:function(e){throw" _getRenderData not implemented"},_setKeys:function(){throw" _setKeys not implemented"},beforeLoadData:function(e){return e()},afterLoadData:function(e){return e()}}),CollectionView=View.extend({_recordActions:[],_globalActions:[],_paginatorActions:[],type:"list",defaultItemTemplate:"no",data:{value:[],metadata:{},pagination:{},resultParams:{},summary:{},validationRules:{},backParams:{},has_errors:!1,list_header:""},init:function(e){this._recordActions=[],this._globalActions=[],this._paginatorActions=[],this._super(e)},setOrder:function(e){var t=this,a=this.getRoute(),n=this.data.resultParams.order_field,r=this.data.resultParams.order_direction;n==e?r="ASC"==r?"DESC":"ASC":(n=e,r="ASC"),a.params.order_field=n,a.params.order_direction=r,t.app.renderView(this.keyId)},_setKeys:function(){var e=this;e.keys=e.fields,e.keys&&0!==e.keys.length||e.data.value.length>0&&(e.keys=Object.keys(e.data.value[0]))},setActionListener:function(){var e=this;EventManager.on(e.keyId+"ActionFired",function(t){var a=t.params,n=null;if(a.indexOf("g")>=0){var r=parseInt(a.substr(1));n=e._globalActions[r]}else if(a.indexOf("r")>=0){var i=a.substr(1);i=i.split("_"),n=e._recordActions[parseInt(i[0])][parseInt(i[1])]}else{if(!(a.indexOf("p")>=0))throw"indentificativo azione "+a+"non trovato";var r=parseInt(a.substr(1));n=e._paginatorActions[r]}n.execute()})},_renderHeaderValues:function(e){var t=this,a=Component.parseHtml(t._headerTemplate()),n=Component.parseHtml(t._orderTemplate()),r=t.order_fields?Object.keys(t.order_fields):[];jQuery.each(e.children("th"),function(e,i){if("left"==t.actions_layout&&0===e);else if("right"==t.actions_layout&&e==t.visibleKeys.length);else{var o="right"==t.actions_layout?e:e-1,l=t.app.translate([t.modelName,t.visibleKeys[o],"msg"].join("."));jQuery.inArray(t.visibleKeys[o],r)>=0?(n.find("[data-pk]").attr("data-pk",t.visibleKeys[o]),n.find("[data-element]").html(l),jQuery(i).html(n.html()),t.data.resultParams.order_field==t.visibleKeys[o]?jQuery(i).addClass("sorting_"+t.data.resultParams.order_direction.toLowerCase()):jQuery(i).addClass("sorting"),jQuery(i).find("[data-pk]").click(function(){t.setOrder(t.visibleKeys[o])})):(a.find("[data-element]").html(l),jQuery(i).html(a.html())),jQuery(i).addClass("field-"+t.visibleKeys[o])}}),n.remove(),a.remove()},_renderHeaderActions:function(e){var t=this,a="right"!=t.actions_layout?0:t.visibleKeys.length,n=jQuery.createDynamicContainer("#"+t.prefixTemplateClass+"_azioni_header_tpl");if(jQuery(e.children()[a]).html(n.html()),jQuery(e.children()[a]).attr("data-col_actions",""),t._hasNeedSelectionAction()||0!=t._recordActions.length)if(t._hasNeedSelectionAction()){var r=Component.parseHtml(t._checkAllTemplate());jQuery(e.children()[a]).html(r),jQuery(e.children()[a]).find('[data-button="checkAll"]').change(function(){var e=jQuery(this).prop("checked");jQuery(t.container).find('input[name="check_row"]').prop("checked",e)})}else jQuery(e.children()[a]).find('[data-button="checkAll"]').remove();else jQuery(e.children()[a]).remove();n.remove()},_renderHeader:function(){for(var e=this,t=(e.jQe,e.jQe().find("[data-view_row_headers]")),a=t.find("th"),n=0;n<e.visibleKeys.length;n++)a.clone().appendTo(t);e._renderHeaderValues(t),e._renderHeaderActions(t)},_renderFooter:function(){var e=this;e.jQe;if(!e.data.summary||0==Object.keys(e.data.summary).length)return void e.jQe().find("tfoot").remove();for(var t=e.jQe().find("[data-view_row_footer]"),a=t.find("td"),n=0;n<e.visibleKeys.length;n++)a.clone().appendTo(t);var r="#"+e.prefixTemplateClass+"_view_summary_field_tpl";jQuery.each(t.children("td"),function(t,a){if("left"==e.actions_layout&&0===t);else if("right"==e.actions_layout&&t==e.visibleKeys.length);else{var n="right"==e.actions_layout?t:t-1,i=e.visibleKeys[n];if(e.data.summary[i]&&e.summary_fields)for(var o in e.summary_fields[i]){var l=e.summary_fields[i][o],d=parseFloat(e.data.summary[i][o]);isNaN(l.decimal)||(d=d.toFixed(l.decimal));var u=jQuery.getTemplate(r,{operation:e.app.translate("general-summary_"+o),value:d+(l.symbol?" "+l.symbol:"")});jQuery(a).append(u)}}})},_attachEvents:function(e){var t=this;for(var a in t.renderObjs[e]){var n=t.renderObjs[e][a],r=t.data.value[e].id;t._attachEvent(n,r)}},_attachDetailEvents:function(){var e=this;jQuery(e.container).find("[data-detail_button]").unbind("click"),jQuery(e.container).find("[data-detail_button]").click(function(){var t=jQuery(this).attr("data-key"),a=parseInt(jQuery(this).attr("data-rowdata_index")),n=parseInt(jQuery(this).attr("data-isopen")),r=jQuery(this).closest("tr"),i=t+"_"+a;if(n){console.log("isopen rimuovo",t,a);var o=jQuery(r).closest("tbody").find('[data-detail_row="'+i+'"]');return o.remove(),void jQuery(this).attr("data-isopen",0)}jQuery(this).attr("data-isopen",1);var l=e.data.value[a],d={detail_row_key:i,colspan:e.visibleKeys.length+1},u=jQuery.getTemplate("#default_view_detail_field_tpl",d);r.after(u);var o=jQuery(r).closest("tbody").find('[data-detail_row="'+i+'"]');jQuery(o).find("[data-detail_title]").html(e.app.translate(e.modelName+"-"+t)),console.log("NON open visualizzo",i,o);var s=o.find("[data-detail_container]"),c=e.detail_fields[t].func;c(s,l)})},_buildFunctionParams:function(e,t){var a=this,n={},r=t.toString().match(/function\s*\w*\s*\((.*?)\)/)[1].split(/\s*,\s*/);for(var i in r)n[r[i]]=a.data.value[e][r[i]];return _.values(n)},fireToConnected:function(e){},getChecked:function(){var e=this,t=[];return jQuery.each(jQuery(e.container).find('input[name="check_row"]:checked'),function(){t.push(jQuery(this).attr("data-pk"))}),t},_renderGlobalActions:function(){var e=this,t=e.jQe().find("[data-view_collection_actions]"),a="";for(var n in e._globalActions){var r=e._globalActions[n];r[r.htmlEvent]='EventManager.trigger("'+e.keyId+'ActionFired","'+r.objectId+'")',a+=r.html()}jQuery(t).html(a)},_renderInfoHeader:function(){var e=this;$(e.jQe).find("[data-list_header]").html(e.data.list_header)},render:function(e){var t=this;if(t.visibleKeys.length&&delete t.visibleKeys,t.visibleKeys=[],t._setActions(),t._renderInfoHeader(),0===t.data.value.length)t._renderZeroResult();else{t._setKeys(),t._setVisibleKeys(),t._renderListHeader(),t._renderPagination(),t._renderHeader(),t._renderFooter(),t._createGrid();for(var a in t.data.value)t._renderRow(a)}return e()},_renderRow:function(e){var t=this,a=t.jQe().find("[data-view_row_elements]").get(e);for(var n in t.keys){var r=t.keys[n],i=jQuery.inArray(r,t.visibleKeys),o=null;if(i>=0){"right"!=t.actions_layout&&i++,o=jQuery(jQuery(a).find("td").get(i)),o.addClass("field-"+r);var l=t.getItemTemplate(r);o.html(l.html()),t.detail_fields[r]&&(o.html(jQuery.getTemplate("#default_view_list_detail_tpl")),o.find("[data-rowdata_index]").attr("data-rowdata_index",e),o.find("[data-key]").attr("data-key",r),o=o.find("[data-detail_container]"))}var d=t._createRender(e,r,Template.getRenderContainer(o));d.show()}var u="right"!=t.actions_layout?0:t.visibleKeys.length;jQuery(jQuery(a).find("td").get(u)).attr("data-col_actions","")},finalize:function(e){var t=this;for(var a in t.data.value)t._attachEvents(a);return t._attachDetailEvents(),t._renderActions(),e()},_setActions:function(){var e=this;e._recordActions=[],e._globalActions=[],e._paginatorActions=[];var t=e.data.value.length;for(var a in e.actions){var n=null,r=e.actions[a];if(n=e.custom_actions[r]?e.custom_actions[r]:window[r],!n)throw e.app.log.debug("custom_actions",e.custom_actions),"definizione azione ("+r+" non trovata! ";if(["collection","record"].indexOf(n.prototype.type)==-1)throw"tipo azione con definito! "+actionTpl.type;if("collection"==n.prototype.type){var i=e._createAction(null,r);i.objectId="g"+e._globalActions.length,e._globalActions.push(i)}else if("record"==n.prototype.type)continue}for(var o=0;o<t;o++){e._recordActions.push([]);for(var a in e.actions){var n=null,r=e.actions[a];if(n=e.custom_actions[r]?e.custom_actions[r]:window[r],!n)throw"definizione azione ("+r+" non trovata! ";if(["collection","record"].indexOf(n.prototype.type)==-1)throw"tipo azione con definito! "+actionTpl.type;if("collection"!=n.prototype.type&&"record"==n.prototype.type){var i=e._createAction(o,r);i.objectId="r"+o+"_"+e._recordActions[o].length,e._recordActions[o].push(i)}}}if(e.pagination){var l=["ActionPrevPage","ActionNextPage","ActionFirstPage","ActionLastPage","ActionPerPage"];for(var a in l){var i=e._createAction(null,l[a]);i.objectId="p"+e._paginatorActions.length,e._paginatorActions.push(i)}}},_configViewCustomBase:function(){var e=this,t=jQuery.createDynamicContainer(e.container);0==Object.keys(e._customAttrs)&&(e._customAttrs.sourceContainer="#"+t.attr("id"))},_renderViewCustomBase:function(){var e=this,t={items:e.data.value,pagination:e.data.pagination};jQuery.renderTemplate(jQuery(e._customAttrs.sourceContainer),e.container,t),e._setActions();var a=jQuery(e.container).find('[data-field="items"]').children();for(var n in e._recordActions){var r=jQuery(a).get(n);for(var i in e._recordActions[n]){var o=e._recordActions[n][i];o.container=jQuery(r).find('[data-action="'+o.actionName+'"]'),o[o.htmlEvent]='EventManager.trigger("'+e.keyId+'ActionFired","'+o.objectId+'")',o.render()}}var e=this;for(var n in e._globalActions){var l=jQuery(e.container).not('[data-field="items"]');for(var i in e._globalActions){var o=e._globalActions[i];o.container=jQuery(l).find('[data-action="'+o.actionName+'"]'),o[o.htmlEvent]='EventManager.trigger("'+e.keyId+'ActionFired","'+o.objectId+'")',o.render()}}var l=jQuery(e.container).not('[data-field="items"]');for(var i in e._paginatorActions){var o=e._paginatorActions[i];o.container=jQuery(l).find('[data-action="'+o.actionName+'"]'),o.pagination=e.data.pagination,o[o.htmlEvent]='EventManager.trigger("'+e.keyId+'ActionFired","'+o.objectId+'")',o.render()}},_configViewCustomComplex:function(){var e=this;0==Object.keys(e._customAttrs)&&(e._customAttrs.container=jQuery(e.container).find('[data-field="items"]'),e._customAttrs.sourceHtml=jQuery.getDomTemplate(e._customAttrs.container).html(),e._customAttrs.actionTpl="#default_view_single_action_item_tpl",e._customAttrs.actionGlobalTpl="#default_view_global_action_tpl")},_renderViewCustomComplex:function(){var e=this;jQuery(e._customAttrs.container).html(""),e._setActions();for(var t in e.data.value){jQuery(e._customAttrs.container).append(e._customAttrs.sourceHtml);var a=jQuery(jQuery(e._customAttrs.container).children()[t]);jQuery.each(jQuery(a).find("[data-render]"),function(){var a=jQuery(this).data("render");e._createRender(t,a,jQuery(this))})}for(var n in e.renderObjs)for(var t in e.renderObjs[n])e.renderObjs[n][t].render();for(var n in e.renderObjs)for(var t in e.renderObjs[n])e.renderObjs[n][t].finalize();var r=jQuery(e.container).find('[data-field="items"]').children();for(var i in e._recordActions){var o=jQuery(r).get(i);for(var l in e._recordActions[i]){var d=e._recordActions[i][l];d.container=jQuery(o).find('[data-action="'+d.actionName+'"]'),d[d.htmlEvent]='EventManager.trigger("'+e.keyId+'ActionFired","'+d.objectId+'")',d.render()}}jQuery(e.container).not('[data-field="items"]');for(var l in e._globalActions){var d=e._globalActions[l];d.container=jQuery(e.container).find('[data-action="'+d.actionName+'"]'),d[d.htmlEvent]='EventManager.trigger("'+e.keyId+'ActionFired","'+d.objectId+'")',d.render()}for(var n in e.data.value)e._attachEvents(n);jQuery(e.container).not('[data-field="items"]');for(var l in e._paginatorActions){var d=e._paginatorActions[l];d.container=jQuery(e.container).find('[data-action="'+d.actionName+'"]'),d.pagination=e.data.pagination,d[d.htmlEvent]='EventManager.trigger("'+e.keyId+'ActionFired","'+d.objectId+'")',d.render()}},_setVisibleKeys:function(){var e=this;for(var t in e.keys)e.fields_config[e.keys[t]]&&"hidden"==e.fields_config[e.keys[t]].input||e.visibleKeys.push(e.keys[t])},_renderZeroResult:function(){var e=this,t=e.jQe().find("[data-view_row_elements]");t.find("td").html(e.app.translate("Nessun elemento trovato"))},_renderPagination:function(){var e=this;if(!e.pagination)return void e.jQe().find("[data-view_pagination]").remove();var t=Component.parseHtml(e._paginatorTemplate());e.jQe().find("[data-view_pagination]").html(jQuery.getTemplate(t,e.data.pagination));var a=e.jQe().find("[data-view_pagination]");for(var n in e._paginatorActions){var r=e._paginatorActions[n],i="[data-"+Utility.snakeCase(r.actionName)+"]";r.pagination=e.data.pagination,r[r.htmlEvent]='EventManager.trigger("'+e.keyId+'ActionFired","'+r.objectId+'")',r.container=a.find(i),a.find(i).html(r.html())}e.jQe().find("[data-view_pagination]").find("")},_renderListHeader:function(){var e=this,t=e.data.list_header;e.jQe().find("[data-list_header]").html(t)},_createRender:function(e,t,a){var n=this,r=n._getRenderType(t),i=r,o={},l=n._getRenderConfig(t,i);l.container=a;var d=Render.factory(t,_.extend(l,o),r);n.renderObjs[e]||(n.renderObjs[e]={}),n.renderObjs[e][t]=d,d.value=n.data.value[e][t],d.modelData=n.data.value[e];var u=n.data.metadata&&n.data.metadata[t]?n.data.metadata[t]:{};return l.metadata&&(u=_.extend(u,l.metadata)),d.setMetadata(u),d},_finalizeRow:function(e){var t=this;t.jQe;for(var a in t.keys)t.renderObjs[e][t.keys[a]].finalize()},_createGrid:function(){for(var e=this,t=e.data.value.length,a=e.visibleKeys.length,n=e.jQe().find("[data-view_row_elements]"),r=n.find("td"),i=0;i<a;i++)r.clone().appendTo(n);n=e.jQe().find("tbody tr").first();for(var i=1;i<t;i++)n.clone().prependTo(e.jQe().find("tbody"))},_renderActions:function(){var e=this;return 0===e.actions.length?(jQuery(e.jQe).find("[data-col_actions]").remove(),void jQuery(e.jQe).find("[data-view_row_actions]").remove()):(e._renderSingleActions(),void e._renderGlobalActions())},_createAction:function(e,t){var a=this,n=null;try{n=a.custom_actions[t]?new a.custom_actions[t]:new window[t]}catch(r){a.app.log.error("Impossibile creare azione "+t+" "+r)}return null===e?n.modelData=a.data.value:n.modelData=a.data.value[e],n.actionName=t,n.view=a,n},_renderSingleActions:function(){var e=this,t=e._hasNeedSelectionAction();for(var a in e._recordActions){var n=e.jQe().find("[data-view_row_elements]").get(a);jQuery(jQuery(n)).find("[data-col_actions]").html('<div class="btn-group" role="group"></div>');var r="";for(var i in e._recordActions[a]){var o=e._recordActions[a][i];o[o.htmlEvent]='EventManager.trigger("'+e.keyId+'ActionFired","'+o.objectId+'")',r+=o.html()}if(jQuery(jQuery(n)).find("[data-col_actions]").find("div").html(r),t){var l=Component.parseHtml(e._checkTemplate());$(l).find("[data-pk]").attr("data-pk",e.data.value[a].id),jQuery(jQuery(n)).find("[data-col_actions]").prepend(l)}}},_hasNeedSelectionAction:function(){var e=this;for(var t in e._globalActions)if(e._globalActions[t].needSelection)return!0;return!1},_hasRecordActions:function(){var e=this;for(var t in e.actions){var a=e.actions[t];if(defaultSingleActions[a])return!0;if(e.custom_actions[a]instanceof RecordAction)return!0}return!1}}),RecordView=View.extend({_pkName:"id",_pkValue:null,_actions:[],type:"record",defaultItemTemplateName:"left",data:{value:{},metadata:{},resultParams:{},validationRules:{},backParams:{}},setActionListener:function(){var e=this;console.log("RecordView.setActionListener"),EventManager.on(e.keyId+"ActionFired",function(t){var a=t.params,n=parseInt(a),r=e._actions[n];e._callAction(r)})},resetForm:function(){var e=this;for(var t in e.renderObjs[0]){var a=e.renderObjs[0][t];a.clear()}},_callAction:function(e){var t=this,a=null;a=t.custom_actions[e.actionName]?new t.custom_actions[e.actionName]:new window[e.actionName];for(var n in e)a[n]=e[n];a.execute()},successMsg:function(e){var t=this;jQuery(t.container).find("[data-alert]").removeClass("hide").html(e),setTimeout(function(){jQuery(t.container).find("[data-alert]").addClass("hide").html("")},1e3)},render:function(e){var t=this;t.jQe().find("[data-view_elements]").attr("data-view_elements",t.modelName),t._setKeys(),t._setActions();for(var a in t.keys)t._renderElement(t.keys[a]);return e()},finalize:function(e){var t=this;t._renderActions(),t._attachEvents();for(var a in t.keys)t._connectFields(t.keys[a]);return e()},_setActions:function(){var e=this;
e._actions=[];for(var t in e.actions){var a=null,n=e.actions[t];if(a=e.custom_actions[n]?e.custom_actions[n]:window[n],!a)throw"definizione azione ("+n+" non trovata! ";if(["collection","record"].indexOf(a.prototype.type)==-1)throw"tipo azione con definito! "+a.prototype.type;var r=e._createAction(n);r.objectId=e._actions.length,e._actions.push(r)}},_createAction:function(e){var t=this,a=null;try{a=t.custom_actions[e]?new t.custom_actions[e]:new window[e]}catch(n){t.app.log.error("Impossibile creare azione "+e+" "+n)}return a.modelData=t.data.value,a.actionName=e,a.view=t,a},_configViewCustomComplex:function(){var e=this;0==Object.keys(e._customAttrs)&&(e._customAttrs.container=jQuery(e.container),e._customAttrs.sourceHtml=jQuery.getDomTemplate(e._customAttrs.container).html(),e._customAttrs.actionTpl="#default_view_edit_action_item_tpl")},_renderViewCustomComplex:function(){var e=this;console.log("RECORD",e._customAttrs),e._setActions(),jQuery(e._customAttrs.container).html(e._customAttrs.sourceHtml),jQuery.each(jQuery(e._customAttrs.container).find("[data-render]"),function(){e._createRender(jQuery(this),jQuery(this).attr("data-render"))});for(var t in e.renderObjs[0])e.renderObjs[0][t].render();for(var t in e.renderObjs[0])e.renderObjs[0][t].finalize();for(var a in e._actions){var n=e._actions[a];n.container=jQuery(e._customAttrs.container).find('[data-action="'+n.actionName+'"]'),n[n.htmlEvent]='EventManager.trigger("'+e.keyId+'ActionFired","'+n.objectId+'")',n.render()}},_configViewCustomBase:function(){var e=this,t=jQuery.createDynamicContainer(e.container);0==Object.keys(e._customAttrs)&&(e._customAttrs.sourceContainer="#"+t.attr("id"))},_renderViewCustomBase:function(){var e=this,t=e.data.value;for(var a in e.fields){var n=e.fields[a];t[n]=e.data.value[n]}e.app.log.debug("_renderViewCustomBase",e._customAttrs,e,t),jQuery.renderTemplate(jQuery(e._customAttrs.sourceContainer),e.container,t),e._setActions();for(var a in e._actions){var r=e._actions[a];r.container=jQuery(e.container).find('[data-action="'+r.actionName+'"]'),r[r.htmlEvent]='EventManager.trigger("'+e.keyId+'ActionFired","'+r.objectId+'")',r.render()}e._attachEvents()},_setKeys:function(){var e=this;if(e.app.log.debug("ViedEdit._setKeys",e.fields),e.groups){e.keys=[];for(var t in e.groups)e.keys=e.keys.concat(e.groups[t].fields)}else e.keys=e.fields;0===e.keys.length&&e.data.value&&(e.keys=Object.keys(e.data.value))},_renderHidden:function(e){var t=this,a=jQuery.createDynamicContainer(),n=t._createRender(a,e);t.jQe().find("[data-hidden_fields]").append(a.html()),n.container=t.jQe().find("[data-hidden_fields]"),n.show(),a.remove()},_renderObjectElement:function(e){var t=this,a=t.getItemTemplate(e),n=t._getGroup(e),r=null;if(null===n){t.jQe().find('[data-view_elements="'+t.modelName+'"]').append(a.html());var i=t.jQe().find('[data-view_elements="'+t.modelName+'"]').children().length;r=jQuery(t.jQe().find('[data-view_elements="'+t.modelName+'"]').children().get(i-1))}else{t.jQe().find('[data-view_elements="'+t.modelName+'"]').find('[data-group="'+n+'"]').append(a.html());var o=t.jQe().find('[data-view_elements="'+t.modelName+'"]').find('[data-group="'+n+'"]').children().length;r=jQuery(t.jQe().find('[data-view_elements="'+t.modelName+'"]').find('[data-group="'+n+'"]').children().get(o-1))}if(1!=r.length)throw"itemContainer vuoto o non univoco "+r.length;var l=t._createRender(Template.getRenderContainer(r),e);l.show()},_getGroup:function(e){var t=this;for(var a in t.groups)if(jQuery.inArray(e,t.groups[a].fields)>=0)return a;return null},_renderElement:function(e){var t=this,a=t.fields_config[e]?t.fields_config[e].type:"input";return"hidden"==a?void t._renderHidden(e):void t._renderObjectElement(e)},_createRender:function(e,t){var a=this,n=a._getRenderType(t),r=n,i={},o=a._getRenderConfig(t,r);o.container=e,o.container.addClass("field-"+t);var l=Render.factory(a._getFieldName(t),_.extend(o,i),n);l||a.app.log.error("ViewRecord._createRender failed",t,n,r),a.renderObjs[0]||(a.renderObjs[0]={}),a.renderObjs[0][t]=l,l.value=a.data.value[t];var d=a.data.metadata&&a.data.metadata[t]?a.data.metadata[t]:{};return o.metadata&&(d=_.extend(d,o.metadata)),l.setMetadata(d),l},_renderActions:function(){var e=this;if(0==e.actions.length||e.isHasMany)return void e.jQe().find("[data-view_action]").remove();var t=e.jQe().find("[data-view_action]"),a="";for(var n in e._actions){var r=e._actions[n];r[r.htmlEvent]='EventManager.trigger("'+e.keyId+'ActionFired","'+r.objectId+'")',r.container=t,a+=r.html()}jQuery(t).html(a)},_langField:function(e,t){var a=this;for(var n in a.lang_fields){var r=a.lang_fields[n],i=t.replace(new RegExp(r+"_","g"),"");if(jQuery.inArray(i,a.langs)>=0)return a.app.log.debug("found key to translate",t,i),i}return null},_renderImgLang:function(e,t){return t?(e.find("[data-img_lang]").attr("src","/viewimage/"+t+".jpg/imagecache/lang-icon").removeClass("hide"),e):e},_getFieldName:function(e){return e},_attachEvents:function(){var e=this;for(var t in e.renderObjs[0]){var a=e.renderObjs[0][t],n=e.data.value.id;e._attachEvent(a,n)}},getRenderObj:function(e){return this.renderObjs[0][e]},_connectFields:function(e){var t=this;if(t.renderObjs[0][e]&&t.renderObjs[0][e].dependencies){var a=t.renderObjs[0][e].dependencies;for(var n in a.sources){var r=a.sources[n];t.connectedObjs[r]||(t.connectedObjs[r]=[]),t.connectedObjs[r].push(e),t.renderObjs[0][r]._emitEvent("change",t.data.value[r])}}},fireToConnected:function(e){var t=this;for(var a in t.connectedObjs){var n=a;if(t.isHasMany&&(n=t._getFieldName(n)),n==e.key)for(var r in t.connectedObjs[a]){var i=t.connectedObjs[a][r];t.app.log.debug("ViewRecord.fireToConnected evt",e,"rObject",t.renderObjs[0][i]);var o=t.renderObjs[0][i].dependencies.func;if(!_.isFunction(o))throw"func is not function in object "+i;var l=jQuery(t.container).find(t.renderObjs[0][i].container);o.apply(t,[e,l])}}}}),ViewList=CollectionView.extend({visibleKeys:[],keys:[],routeName:"list",init:function(e){this._super(e),this.defaultRenderType="text"},getModelData:function(e){throw"ViewList.getModelData not implemented"},_template:function(){return'\n            <div class="panel panel-default panel-body model-list">\n                <div data-list_header></div>\n                <div data-hidden_fields></div>\n                <div class="clearfix">\n                    <div class="col col-md-5 col-xs-12 hidden-xs list-actions" data-view_collection_actions></div>\n                    <div class="col col-md-7 col-xs-12 list-pagination" data-view_pagination></div>\n                </div>\n                <hr/>\n                <div class="table-responsive">\n                    \n                    <table class="table table-striped table-condensed table-hover table-bordered table-vertical-middle nomargin">\n                        <thead>\n                            <tr data-view_row_headers>\n                                <th >\n                                </th>\n                            </tr>\n                        </thead>\n                        <tbody>\n                            <tr data-view_row_elements>\n                                <td>\n                                </td>\n                            </tr>\n                            <!--\n                            <tr data-view_row_actions>\n                                <td colspan="100">\n                                </td>\n                            </tr>\n                            -->\n                        </tbody>\n                        <tfoot>\n                            <tr data-view_row_footer><td></td></tr>\n                        </tfoot>\n                    </table>\n                </div>\n                <hr/>\n                <div class="clearfix">\n                    <div class="col col-md-5 col-xs-12 list-actions" data-view_collection_actions></div>\n                    <div class="col col-md-7 col-xs-12 list-pagination" data-view_pagination></div>\n                </div>\n            </div>\n            '},_headerTemplate:function(){return"\n            <span data-element></span>\n        "},_orderTemplate:function(){return'\n            <a href="javascript:void(0)" data-action="actionOrder" data-pk="">\n                <span data-element></span>\n            </a>\n        '},_checkAllTemplate:function(){return'<input type="checkbox" data-button="checkAll" title="Seleziona tutti">'},_checkTemplate:function(){return'<span class="pull-left" ><input data-pk="" type="checkbox" name="check_row">&nbsp;</span>'},_paginatorTemplate:function(){return'\n            <ul class="list-inline hidden-md hidden-sm hidden-xs">\n                <li data-action_first_page><a data-first_page href="javascript:void(0)">&laquo;</a></li>\n                <li data-action_prev_page><a data-prev_page href="javascript:void(0)">&lt;</a></li>\n                <li>\n                <span style="padding:2px" >\n                    <span data-keytranslate="general-pagination_total" >Tot</span>\n                    <b><span data-field="total"></span></b>,\n                &nbsp;&nbsp;\n                    <span data-action_per_page></span>\n                    <!--<select data-action_per_page data-field="per_page" data-source="pagination_steps" self style="height:24px" class="pagination-input" data-action="actionPerPage">-->\n        <!---->\n                    <!--</select>-->\n                    <span data-keytranslate="general-pagination_per_page" >Per pagina</span>\n                </span>\n                </li>\n                <li><a class="disabled" href="javascript:void(0)" data-page_info=""> <span data-field="current_page"></span> / <span data-field="last_page"></span> </a></li>\n                <li data-action_next_page ><a data-next_page href="javascript:void(0)">&gt;</a></li>\n                <li data-action_last_page><a data-last_page href="javascript:void(0)">&raquo;</a></li>\n        \n            </ul>\n            <ul class="pagination pagination-sm hidden-lg hidden-xl">\n                <li data-action_first_page><a data-action="ActionFirstPage" href="javascript:void(0)">&laquo;</a></li>\n                <li data-action_prev_page><a data-action="ActionPrevPage" href="javascript:void(0)">&lt;</a></li>\n                <li><a class="disabled" href="javascript:void(0)" data-page_info="">  <span data-field="current_page"></span> / <span data-field="last_page"></span> (<span data-field="total"></span>)</a></li>\n                <li data-action_next_page><a data-action="ActionNextPage" href="javascript:void(0)">&gt;</a></li>\n                <li data-action_last_page><a data-action="ActionLastPage" href="javascript:void(0)">&raquo;</a></li>\n        \n            </ul>\n        '}}),ViewEdit=RecordView.extend({visibleKeys:[],keys:[],isHasMany:!1,hasManyIndex:null,routeName:"edit",init:function(e){this.resources=[this.pluginsPath+"jquery.form.js",this.pluginsPath+"jquery.validate/jquery.validate.js"],this._super(e),this.visibleKeys=[],this.keys=[],this.type="edit",this.renderObjs[0]={},this.defaultRenderType="input"},valid:function(){return jQuery(this.container).find("form").valid()},_setValidationRules:function(){var e=this,t=jQuery(e.container).find("form");if(0!=t.length){var a={};for(var n in e.data.validationRules){e.app.log.info("Validation rule key "+n);var r={},i=e.data.validationRules[n],o=i?i.split("|"):[];for(var l in o){var d=o[l];try{var u=d.split(":").length>0?d.split(":")[0]:d;if(u="V"+u,window[u]){if("Vsometimes"==u){var s=_.clone(o);s.splice(0,1);var c=new window[u](t);r=jQuery.extend(r,c.get(n,s));break}var c=new window[u](t);r=jQuery.extend(r,c.get(n,d))}else e.app.log.warn(u+" non implementata")}catch(p){e.app.log.error(p)}}a[n]=r}t.validate({rules:a})}},_template:function(){return'\n            <div class="well" data-edit-main>\n                <h3 data-label="modelMetadata.singular"></h3>\n                <div data-alert class="alert alert-success hide"></div>\n                <form name="data_form" class="model-edit">\n                    <div data-hidden_fields></div>\n                    <div data-view_elements>\n                        \n                    </div>\n                    <div data-view_action >\n                        <div data-field="data" data-self>\n        \n                        </div>\n                    </div>\n                </form>\n            </div>\n        '},_itemTemplate:function(){}}),ViewHasmanyEdit=ViewEdit.extend({visibleKeys:[],keys:[],hasManyIndex:null,routeName:"edit",prefixKey:"",init:function(e){this.resources=[this.pluginsPath+"jquery.form.js",this.pluginsPath+"jquery.validate/jquery.validate.js"],this._super(e),this.visibleKeys=[],this.keys=[],this.type="edit",this.renderObjs[0]={},this.defaultRenderType="input"},_getFieldName:function(e){var t=this,a=t.prefixKey+e;return a+=null===t.hasManyIndex?"[]":"["+t.hasManyIndex+"]"},valid:function(){return jQuery(this.container).find("form").valid()},_setValidationRules:function(){var e=this,t=jQuery(e.container).find("form");if(0!=t.length){var a={};for(var n in e.data.validationRules){e.app.log.info("Validation rule key "+n);var r={},i=e.data.validationRules[n],o=i?i.split("|"):[];for(var l in o){var d=o[l];try{var u=d.split(":").length>0?d.split(":")[0]:d;if(u="V"+u,window[u]){if("Vsometimes"==u){var s=_.clone(o);s.splice(0,1);var c=new window[u](t);r=jQuery.extend(r,c.get(n,s));break}var c=new window[u](t);r=jQuery.extend(r,c.get(n,d))}else e.app.log.warn(u+" non implementata")}catch(p){e.app.log.error(p)}}a[n]=r}t.validate({rules:a})}},_template:function(){return'\n            <div class="well" data-edit-main>\n                <div data-alert class="alert alert-success hide"></div>\n                \n                <div data-hidden_fields></div>\n                <div data-view_elements>\n                    \n                </div>\n                <div data-view_action >\n                    <div data-field="data" data-self>\n    \n                    </div>\n                </div>\n                \n            </div>\n        '}}),ViewInsert=ViewEdit.extend({routeName:"insert"}),ViewSearch=RecordView.extend({routeName:"search",type:"search",init:function(e){this._super(e),this.defaultRenderType="input",this.renderObjs[0]={}},getParams:function(){var e=this,t=jQuery(e.container).find("form");if(0===t.length)throw"impossibile trovare il form search in "+e.container;return t.serializeAssoc()},afterRender:function(e){var t=this;return 0===t.keys.length&&jQuery(t.container).remove(),e()},_template:function(){return'\n            <div class="well search-well">\n                <form name="data_form" class="model-search">\n                    <div data-hidden_fields></div>\n                    <div class="search-row" data-view_elements>\n                    </div>\n        \n                    <div class="clearfix"></div>\n                    <hr class=""/>\n        \n                    <div data-view_action>\n                        <div data-field="data" data-self>\n                        </div>\n                    </div>\n                </form>\n            </div>\n        '}}),ViewView=RecordView.extend({routeName:"view",defaultRenderType:"text",type:"view",_template:function(){return'\n            <div class="well model-view">\n                <div data-hidden_fields></div>\n                <div data-view_elements>\n                </div>\n                <div data-view_action >\n                    <div data-field="data" data-self>\n                       \n                    </div>\n                </div>\n            </div>\n        '}}),ViewCalendar=ViewList.extend({calendarContainer:null,routeName:"calendar",resources:["fullcalendar-3.8.0/fullcalendar.css","fullcalendar-3.8.0/lib/moment.min.js","fullcalendar-3.8.0/fullcalendar.js"],finalize:function(e){var t=this,a={};for(var n in t.calendar_options)if(_.isFunction(t.calendar_options[n])){var r=t.calendar_options[n];a[n]=function(){r.apply(t,_.values(arguments))}}else a[n]=t.calendar_options[n];return t.jQe().find("[data-calendar]").fullCalendar(a),t.calendarContainer=t.jQe().find("[data-calendar]"),t.loadEvents(),e()},loadEvents:function(){var e=this;e.jQe().find("[data-calendar]").fullCalendar("removeEvents");var t=[];for(var a in e.data.value){var n=e.data.value[a],r="green",i="white",o="notitle";if(e.backgroundColor){var l={},d=e.backgroundColor.toString().match(/function\s*\w*\s*\((.*?)\)/)[1].split(/\s*,\s*/);for(var u in d)l[d[u]]=n[d[u]];r=e.backgroundColor.apply(e,_.values(l))}if(e.textColor){var l={},d=e.textColor.toString().match(/function\s*\w*\s*\((.*?)\)/)[1].split(/\s*,\s*/);for(var u in d)l[d[u]]=n[d[u]];i=e.textColor.apply(e,_.values(l))}if(_.isFunction(e.title)){var l={},d=e.title.toString().match(/function\s*\w*\s*\((.*?)\)/)[1].split(/\s*,\s*/);for(var u in d)l[d[u]]=n[d[u]];o=e.title.apply(e,_.values(l))}else o=n[e.title];if(n[e.data_inizio]){var s={id:n[e.id]?model.data[e.id]:n.id,title:o,start:n[e.data_inizio],end:n[e.data_fine]?n[e.data_fine]:null,backgroundColor:r,textColor:i};t.push(s)}else e.app.log.warn("data evento non valida. Scartato:",n)}e.app.log.info("aggiunti eventi ",t),e.jQe().find("[data-calendar]").fullCalendar("addEventSource",t)},dayClick:function(e,t,a){},eventClick:function(e,t,a){},_template:function(){return'<div class="well model-calendar">\n                    <div data-hidden_fields></div>\n                    <div data-view_elements>\n                        <div data-calendar>\n                        </div>\n                    </div>\n                    <div data-view_action class="hide">\n                        <div data-field="data" data-self>\n                           \n                        </div>\n                    </div>\n                </div>\n                '}}),Conf=Class.extend({routeName:null,viewClass:null,actions:[],custom_actions:{},fields:[],fields_config:{},init:function(e){var t=this;console.log("Conf",e);var a=e?e:{};for(var n in a)if("fields_config"===n)for(var r in a.fields_config)t.fields_config[r]=a.fields_config[r];else this[n]=a[n]}});Conf.factory=function(e){var t="Conf"+Utility.pascalCase(e);if(!window[t])throw"Impossibile trovare la definizione della configurazione "+t;return new window[t]};var CollectionConf=Conf.extend({pagination:!0,detail_fields:{}}),RecordConf=Conf.extend({dependencies:{},fields_template:"left"}),ConfList=CollectionConf.extend({routeName:"list",viewClass:"ViewList",actions:["ActionDelete","ActionMultiDelete","ActionEdit","ActionView","ActionInsert"],fields_config:{id:{type:"hidden"},created_at:{type:"hidden"},updated_at:{type:"hidden"},deleted_at:{type:"hidden"},created_by:{type:"hidden"},updated_by:{type:"hidden"},descrizione:{type:"hidden"},activated:{type:"swap",mode:"edit"},verified:{type:"swap",mode:"edit"},fotos:{type:"hasmany_upload_image",limit:1},attachments:{type:"hasmany_upload_attachment",limit:1},data:{type:"date_picker"}}}),ConfEdit=RecordConf.extend({routeName:"edit",viewClass:"ViewEdit",actions:["ActionSave","ActionBack"],custom_actions:{},labels:"left",fields:[],fields_config:{id:{type:"hidden"},created_at:{type:"hidden"},updated_at:{type:"hidden"},deleted_at:{type:"hidden"},created_by:{type:"hidden"},updated_by:{type:"hidden"},activated:{type:"radio"},descrizione:{type:"texthtml"},body:{type:"texthtml"},note:{type:"texthtml"},fotos:{type:"hasmany_upload_image",templateName:"no"},attachments:{type:"hasmany_upload_attachment",templateName:"no"},data:{type:"date_picker"},data_formatted:{type:"hidden"},status:{type:"hidden"},token:{type:"hidden"},captcha:{type:"captcha"}},dependencies:{}}),ConfInsert=ConfEdit.extend({routeName:"insert",viewClass:"ViewInsert"}),ConfSearch=RecordConf.extend({routeName:"search",viewClass:"ViewSearch",actions:["ActionSearch","ActionReset"],custom_actions:{},fields:[],fields_config:{}}),ConfView=RecordConf.extend({routeName:"view",viewClass:"ViewView",labels:"left",actions:[],custom_actions:{},fields:[],fields_config:{attivo:{type:"swap"},fotos:{type:"hasmany_upload_image"},attachments:{type:"hasmany_upload_attachment"},id:{type:"hidden"},created_at:{type:"hidden"},updated_at:{type:"hidden"},deleted_at:{type:"hidden"},created_by:{type:"hidden"},updated_by:{type:"hidden"}}}),TreeConf=Class.extend({init:function(e){var t=e?e:{};for(var a in t)this[a]=t[a]},child:{}}),ConfCalendar=CollectionConf.extend({init:function(e){var t=e?e:{};for(var a in t)this[a]=t[a]},routeName:"calendar",viewClass:"ViewCalendar",data_inizio:"data",fields:[],calendar_options:{}}),Action=Class.extend((_Class$extend={container:null,htmlEvent:"onclick",type:null,controlType:"button",text:"",icon:"",cssClass:"",target:"",href:"",params:[],enabled:!0,visible:!0,title:""},_defineProperty(_Class$extend,"container",null),_defineProperty(_Class$extend,"app",null),_defineProperty(_Class$extend,"_htmlProperties",["text","icon","cssClass","target","href","params","title","enabled","visible","onclick","onchange"]),_defineProperty(_Class$extend,"init",function(e){if(e)for(var t in e)this[t]=e[t]}),_defineProperty(_Class$extend,"execute",function(){throw"func must be overloaded!"}),_defineProperty(_Class$extend,"getTemplate",function(e){var t=this,a=e?e:t["_"+t.controlType+"Template"](),n=document.createElement("div");return jQuery(n).html(jQuery.parseHTML(a)),jQuery(n)}),_defineProperty(_Class$extend,"render",function(){var e=this,t=e.getTemplate(),a=e._getData();jQuery.renderTemplate(t,e.container,a)}),_defineProperty(_Class$extend,"html",function(){var e=this,t=e.getTemplate(),a=e._getData();return jQuery.getTemplate(t,a)}),_defineProperty(_Class$extend,"_getData",function(){var e=this,t={};for(var a in e._htmlProperties){var n=e._htmlProperties[a];_.isFunction(e[n])?t[n]=e[n]():t[n]=e[n]}return"link"==e.controlType&&(t[e.htmlEvent]=null,t.href=e.execute()),t}),_defineProperty(_Class$extend,"callback",function(e){}),_Class$extend)),CollectionAction=Action.extend({type:"collection",_buttonTemplate:function(){var e="\"{'"+this.htmlEvent+"':"+this.htmlEvent+",'title':title,'data-params':params}\"";return'\n                <button  type="button" data-visible=visible data-class="cssClass"  data-attrs='+e+' data-addclass="enabled?\'\':\'disabled\'">\n                    <i data-remove="!icon" data-class="icon"></i>\n                    <span data-field="text"></span>\n                </button>    \n            '},_linkTemplate:function(){return'\n                <a data-href="href" data-visible="visible" data-class="cssClass"  data-attrs="{\'title\':title,\'data-params\':params,\'target\':target}" target="_blank" data-addclass="enabled?\'\':\'disabled\'">\n                    <i data-remove="!icon" data-class="icon"></i>\n                    <span data-field="text"></span>\n                </a>   \n            '}}),RecordAction=Action.extend({type:"record",cssClass:"btn btn-default btn-xs btn-group",_buttonTemplate:function(){var e="\"{'"+this.htmlEvent+"':"+this.htmlEvent+",'title':title,'data-params':params}\"";return'\n                <button  type="button" data-visible=visible data-class="cssClass"  data-attrs='+e+' data-addclass="enabled?\'\':\'disabled\'">\n                    <i data-remove="!icon" data-class="icon"></i>\n                    <span data-field="text"></span>\n                </button>    \n            '},_linkTemplate:function(){return'\n                <a data-href="href" data-visible="visible" data-class="cssClass"  data-attrs="{\'title\':title,\'data-params\':params,\'target\':target}" target="_blank" data-addclass="enabled?\'\':\'disabled\'">\n                    <i data-remove="!icon" data-class="icon"></i>\n                    <span data-field="text"></span>\n                </a>   \n            '}});Action.factory=function(e,t){var a="Action"+Utility.pascalCase(e);if(!window[a])throw"Impossibile trovare la definizione dell'action  "+a;var n=t?t:{};return n.className=a,new window[a](n)};var ActionEdit=RecordAction.extend({title:"Modifica",icon:"fa fa-edit",execute:function(){var e=this,t="";e.view.constraint&&(t="/"+e.view.constraintKey+"/"+e.view.constraintValue),document.location.href=Server.getUrl("/edit/"+e.view.modelName+"/"+e.modelData.id+t)}}),ActionInsert=CollectionAction.extend({title:"Inserisci",icon:"fa fa-plus text-success",cssClass:"btn btn-default btn-xs text-success",text:"Nuovo",execute:function(){var e=this,t="";e.view.constraintKey&&e.view.constraintValue&&(t="/"+e.view.constraintKey+"/"+e.view.constraintValue),document.location.href=Server.getUrl("/insert/"+e.view.modelName+t)}}),ActionSave=RecordAction.extend({title:"Salva",text:"Salva",execute:function(){var e=this;if(console.log(this),!e.view.valid())return void log.debug("actionSave form Data view is not valid!");var t=null,a=null;a=e.view.pk?"update":"save",e.view.constraintKey&&e.view.constraintValue&&(a+="_constraint"),t=Route.factory(a);var n=t.getKeys();t.values={};for(var r in n)t.values[n[r]]=e.view[n[r]];t.params=e.view.getFormData(),this.app.waitStart(),Server.route(t,function(t){e.app.waitEnd(),e.callback(t)})},callback:function(e){return e.error?void app.errorDialog(e.msg):void app.renderView(this.view.keyId)}}),ActionBack=RecordAction.extend({title:"Indietro",text:"Torna indietro",execute:function(){window.history.back()}}),ActionView=RecordAction.extend({title:"Visualizza",icon:"fa fa-list-alt",execute:function(){var e=this,t="";e.view.constraint&&(t="/"+e.view.constraintKey+"/"+e.view.constraintValue),document.location.href=Server.getUrl("/view/"+e.view.modelName+"/"+e.modelData.id+t)}}),ActionDelete=RecordAction.extend({title:"Cancella",icon:"fa fa-remove text-danger",execute:function(){var e=this;e.view;jQuery.confirmDialog("Sei sicuro di voler cancellare l'elemento?").ok(function(){var t=Route.factory("delete");t.values={modelName:e.view.modelName,pk:e.modelData.id},e.app.waitStart(),Server.route(t,function(t){e.app.waitEnd(),e.callback(t)})})},callback:function(e){return e.error?void app.errorDialog(e.msg):void app.renderView(this.view.keyId)}}),ActionMultiDelete=CollectionAction.extend({title:"Cancella selezionati",icon:"fa fa-trash text-danger",cssClass:"btn btn-default btn-xs text-danger",text:"Selezionati",needSelection:!0,execute:function(){var e=this,t=e.view.getChecked(),a=t.length;0!==a&&jQuery.confirmDialog("Sei sicuro di voler cancellare ("+a+") elementi selezionati?").ok(function(){var a=Route.factory("multi_delete");a.values={modelName:e.view.modelName},e.app.waitStart(),a.params={ids:t},Server.route(a,function(t){e.app.waitEnd(),e.callback(t)})})},callback:function(e){return e.error?void app.errorDialog(e.msg):void app.renderView(this.view.keyId)}}),ActionSearch=CollectionAction.extend({title:"Ricerca",icon:"fa fa-search",cssClass:"btn btn-xs btn-default text-info",text:"Cerca",execute:function(){var e=this,t=e.view,a=t.getParams();a.page=1,window.location.href=window.location.origin+Server.getUrl(window.location.pathname+"?"+jQuery.param(a))}}),ActionReset=CollectionAction.extend({title:"Annulla filtri ricerca",cssClass:"btn btn-xs btn-default",text:"Annulla filtri",execute:function(){console.log(this),this.view.resetForm(),this.callback()}}),ActionNextPage=CollectionAction.extend({icon:"fa fa-angle-right",cssClass:"btn btn-default btn-xs",execute:function(){var e=this.view.getRoute();this.view.data.pagination.current_page<this.view.data.pagination.last_page&&(e.params.page=this.view.data.pagination.current_page+1,this.view.setRoute(e),app.renderView(this.view.keyId),this.callback())}}),ActionPrevPage=CollectionAction.extend({icon:"fa fa-angle-left",cssClass:"btn btn-default btn-xs",execute:function(){var e=this.view.getRoute();this.view.data.pagination.current_page>1&&(e.params.page=this.view.data.pagination.current_page-1,this.view.setRoute(e),app.renderView(this.view.keyId),this.callback())}}),ActionFirstPage=CollectionAction.extend({icon:"fa fa fa-angle-double-left",cssClass:"btn btn-default btn-xs",execute:function(){var e=this.view.getRoute();this.view.data.pagination.current_page>1&&(e.params.page=1,this.view.setRoute(e),app.renderView(this.view.keyId),this.callback())}}),ActionLastPage=CollectionAction.extend({icon:"fa fa fa-angle-double-right",cssClass:"btn btn-default btn-xs",execute:function(){var e=this.view.getRoute();this.view.data.pagination.current_page<this.view.data.pagination.last_page&&(e.params.page=this.view.data.pagination.last_page,this.view.setRoute(e),app.renderView(this.view.keyId),this.callback())}}),ActionPerPage=CollectionAction.extend({icon:"fa fa fa-angle-double-right",htmlEvent:"onchange",cssClass:"btn btn-default btn-xs",init:function(e){this._super(e),this._htmlProperties.push("pagination")},execute:function(){var e=this,t=this.view.getRoute();t.params.page=1,t.params.paginateNumber=jQuery(e.container).find("select").val(),this.view.setRoute(t),app.renderView(this.view.keyId),this.callback()},_getData:function(){var e=this._super();return e.pagination.pagination_order=_.sortBy(_.keys(e.pagination.pagination_steps),function(e){return parseInt(e)}),e},_buttonTemplate:function(){var e="\"{'"+this.htmlEvent+"':"+this.htmlEvent+",'title':title,'data-params':params}\"";return'\n                <select data-field="pagination.per_page" data-source="pagination.pagination_steps" \n                        data-sourceorder="pagination.pagination_order"\n                        data-attrs='+e+'  class="pagination-input">\n        \n                </select>  \n            '}}),ValidationRules=Class.extend({form:null,init:function(e){this.form=e},get:function(e){return log.warn("metodo da implementare"),{}}}),Vrequired=ValidationRules.extend({get:function(e,t){return{required:!0}}}),Vbetween=ValidationRules.extend({get:function(e,t){var a=t.split(":"),n=a[1].split(",");return{minlength:n[0],maxlength:n[1]}}}),Vemail=ValidationRules.extend({get:function(e,t){return{email:!0}}}),Vconfirmed=ValidationRules.extend({get:function(e,t){return{equalTo:'input[name="'+e+'_confirmation"]'}}}),Vsometimes=ValidationRules.extend({get:function(e,t){var a=this,n={key:e,other_rules:t,form:a.form};return{sometimes:n}}});jQuery.validator&&jQuery.validator.addMethod("sometimes",function(e,t,a){if(jQuery(t).rules("remove","sometimes"),!jQuery(t).val())return!0;for(var n in a.other_rules){var r=a.other_rules[n],i=r.split(":").length>0?r.split(":")[0]:r;if(i="V"+i,window[i]){var o=new window[i](a.form);jQuery(t).rules("add",o.get(a.key,r))}}var l=a.form.validate(),d=l.element(jQuery(t)),u=l.errorList.length?l.errorList[0].message:"undefined error";for(var o in jQuery(t).rules())jQuery(t).rules("remove",o);return jQuery(t).rules("add",{sometimes:a}),jQuery(t).rules("add",{messages:{sometimes:u}}),d},"mesaggio dinamico");var Dashboard=Component.extend({container:null,modelName:"",tplVars:{modelName:null,constraintKey:"",constraintValue:""},viewKeys:[],init:function(e){var t=this;if(e)for(var a in e)t[a]=e[a];t.id=Math.floor(1e4*Math.random()+1),t.tplVars.id=t.id,t.tplVars.modelName=t.modelName,t.tplVars.constraintKey=t.constraintKey,t.tplVars.constraintValue=t.constraintValue,t.tplVars.autorender=!1,t.labelsContext=t.modelName},render:function(e){var t=this;return t.app.log.debug("Dashboard.render tplVars",this.tplVars),t.template?(t.app.log.debug("Dashboard use custom template"),jQuery(t.container).html(jQuery(t.template).html()),jQuery.each(jQuery(t.container).find("[data-view]"),function(){var e=jQuery(this).data("view");jQuery(this).attr("model_name")||jQuery(this).attr("model_name",t.modelName),jQuery(this).attr("id")||jQuery(this).attr("id",e+"_"+t.tplVars.id)}),jQuery(t.container).html(jQuery.getTemplate(t.container,t.tplVars))):(t.app.log.debug("Dashboard use default template",t.tplVars),jQuery(t.container).html(jQuery.getTemplate(t.getTemplate(),t.tplVars))),console.log("parse",t.jQe()),t.viewKeys=t.app.parse(t.jQe()),e()},finalize:function(e){var t=this;if(!e){if(!t.viewKeys||0==t.viewKeys.length)return;for(var a in t.viewKeys)app.renderView(t.viewKeys[a]);return e()}if(!t.viewKeys||0==t.viewKeys.length)return _cb();
var n=function r(a,n){app.renderView(t.viewKeys[a],function(){a<t.viewKeys.length-1?r(a+1,e):e()})};n(0,function(){e()})}}),DashboardTab=Dashboard.extend({reloadList:!1,searchKey:null,listKey:null,editKey:null,insertKey:null,viewKey:null,finalize:function(e){var t=this;t.searchKey=jQuery(t.container).find('[data-view="search"]').attr("vkey"),t.listKey=jQuery(t.container).find('[data-view="list"]').attr("vkey"),t.editKey=jQuery(t.container).find('[data-view="edit"]').attr("vkey"),t.insertKey=jQuery(t.container).find('[data-view="insert"]').attr("vkey"),t.viewKey=jQuery(t.container).find('[data-view="view"]').attr("vkey");var a=app.getView(t.listKey);a.dashboardInstance=t,a.custom_actions.ActionEdit=ActionEdit.extend({execute:function(){var e=this;jQuery(e.view.dashboardInstance.container).find("[data-collapse_list]").collapse("hide"),jQuery(e.view.dashboardInstance.container).find("[data-collapse_edit]").collapse("show"),jQuery(e.view.dashboardInstance.container).find('[data-view="insert"]').addClass("hide"),jQuery(e.view.dashboardInstance.container).find('[data-view="edit"]').removeClass("hide"),jQuery("[data-edit_title]").html("modifica "+t.app.translate("model-"+e.view.dashboardInstance.tplVars.model));var a=app.getView(e.view.dashboardInstance.editKey);a.pk=e.modelData.id,app.renderView(a.keyId)}}),a.actions.indexOf("ActionView")>=0&&(a.custom_actions.ActionView?a.custom_actions.ActionView=a.custom_actions.ActionView.extend({execute:function(){this._super()}}):a.custom_actions.ActionView=ActionView.extend({execute:function(){var e=this;t.showDialog(e.modelData.id)}})),a.actions.indexOf("ActionInsert")>=0&&(a.custom_actions.ActionInsert?a.custom_actions.ActionInsert=a.custom_actions.ActionInsert.extend({execute:function(){this._super()}}):a.custom_actions.ActionInsert=ActionInsert.extend({execute:function(){t.dashboardInstance.showInsert()}}));var n=ActionBack.extend({execute:function(){var e=this;e.view.dashboardInstance.showList()}}),r=ActionSave.extend({execute:function(){var e=this;e.view.dashboardInstance.reloadList=!0,this._super()}});app.getView(t.editKey)&&(app.getView(t.editKey).dashboardInstance=t,app.getView(t.editKey).custom_actions.ActionBack=n,app.getView(t.editKey).custom_actions.ActionSave=r),app.getView(t.insertKey)&&(app.getView(t.insertKey).dashboardInstance=t,app.getView(t.insertKey).custom_actions.ActionBack=n,app.getView(t.insertKey).custom_actions.ActionSave=r),app.getView(t.searchKey)&&(app.getView(t.searchKey).dashboardInstance=t,app.getView(t.searchKey).custom_actions.ActionSearch=ActionSearch.extend({execute:function(){var e=this,t=app.getView(e.view.dashboardInstance.listKey),a=app.getView(e.view.dashboardInstance.searchKey),n=t.getRoute(),r=a.getFormData();n.params=jQuery.extend(r,n.extra_params),t.setRoute(n),app.renderView(e.view.dashboardInstance.listKey)}})),e()},showDialog:function(e){var t=this;jQuery(t.container).find("[data-view_dialog]").modal("show");var a=app.getView(t.viewKey);a.pk=e,app.renderView(a.keyId)},showList:function(){var e=this;jQuery(e.container).find("[data-collapse_list]").collapse("show"),jQuery(e.container).find("[data-collapse_edit]").collapse("hide"),e.reloadList&&(e.reloadList=!1,app.renderView(e.listKey))},showInsert:function(){var e=this;jQuery(e.container).find("[data-collapse_list]").collapse("hide"),jQuery(e.container).find("[data-collapse_edit]").collapse("show"),jQuery(e.container).find('[data-view="insert"]').removeClass("hide"),jQuery(e.container).find('[data-view="edit"]').addClass("hide"),jQuery("[data-edit_title]").html("inserimento "+e.app.translate("model-"+e.tplVars.model));var t=app.getView(e.insertKey);app.renderView(t.keyId)},_template:function(){return'\n            <div id="tabContent"> \n                <header id="page-header">\n                    <div class="panel panel-default">\n                        <div class="panel-heading">\n                              <span class="title elipsis">\n                                    <strong data-label="meta"></strong>\n                              </span>\n                        </div>\n                    </div>\n                </header>\n                <div class="collapse in" data-collapse_list>\n                    <div class="padding-15">\n                        <div data-view="search"\n                                    data-attrs="{\n                                        model_name:modelName,\n                                        constraint_key:constraintKey,\n                                        constraint_value:constraintValue,\n                                        id:\'search_\'+id,\n                                        \n                                       \n                                    }"\n                                    class="viewSearch"\n                                    model_name="" >\n                        </div>\n                        <div data-view="list"\n                                    data-attrs="{\n                                        model_name:modelName,\n                                        constraint_key:constraintKey,\n                                        constraint_value:constraintValue,\n                                        id:\'list_\'+id,\n                                        \n                                    }"\n                                    class="viewList"\n                                    model_name="">\n                        </div>\n                    </div>\n                </div>\n            \n                <div class="collapse" data-collapse_edit>\n                    <div class="padding-15">\n                        <div data-view="edit"\n                                    data-attrs="{\n                                        model_name:modelName,\n                                        constraint_key:constraintKey,\n                                        constraint_value:constraintValue,\n                                        id:\'edit_\'+id,\n                                        \n                                    }"\n                                    class="viewEdit" \n                                    \n                                    model_name="" \n                                    autorender="false" \n                        ></div>\n                        <div data-view="insert" \n                                data-attrs="{\n                                    model_name:modelName,\n                                    constraint_key:constraintKey,\n                                    constraint_value:constraintValue,\n                                    id:\'insert_\'+id,\n                                    \n                                }"\n                                class="viewEdit viewInsert"\n                                model_name="" \n                                autorender="false" \n                        ></div>\n                    </div>\n                </div>\n            \n                <div data-view_dialog class="modal fade">\n                    <div class="modal-dialog">\n                        <div class="modal-content">\n                            <div class="modal-header">\n                                <button type="button" class="close" data-dismiss="modal"\n                                        aria-hidden="true">&times;</button>\n                                <h4 class="modal-title" data-html="app.translate(\'model-\' + modelName)" ></h4>\n                            </div> \n                            <div class="modal-body">\n                                <div data-view="view" \n                                data-attrs="{\n                                    model_name:modelName,\n                                    constraint_key:constraintKey,\n                                    constraint_value:constraintValue,\n                                    id:\'view_\'+id,\n                                    \n                                }"\n                                model_name="" \n                                autorender="false" \n                                ></div>\n                            </div>\n                            <div class="modal-footer">\n                                <button type="button" class="btn btn-primary btcancel"\n                                        data-dismiss="modal">Annulla\n                                </button>\n                                <button type="button" class="btn btn-primary btok"\n                                        data-dismiss="modal">Ok\n                                </button>\n                            </div>\n                        </div>\n                        <!-- /.modal-content -->\n                    </div>\n                    <!-- /.modal-dialog -->\n                </div>\n            </div>\n        '}}),DashboardEdit=Dashboard.extend({init:function(e){this.tplVars.id=e.id,this.tplVars.pk=e.pk,this._super(e)},_template:function(){return'\n            <div>\n                <div class="panel panel-default">\n                    <div class="panel-heading">\n                          <span class="title elipsis"> \n                            <strong data-html="\'Modifica \' + app.translate(\'model-\' + modelName)"></strong>\n                          </span>\n                    </div>\n                </div>\n                <div data-view="edit"\n                                        data-attrs="{\n                                            model_name:modelName,\n                                            constraint_key:constraintKey,\n                                            constraint_value:constraintValue,\n                                            id:\'edit_\'+id,\n                                            pk : pk\n                                        }"\n                                        class="viewEdit" \n                                        \n                                        model="" \n                                        autorender="false" >\n                            \n                </div>\n            </div>\n        '}}),DashboardList=Dashboard.extend({searchKey:null,listKey:null,afterFinalize:function(e){var t=this;return t.app.log.debug("listboard finalize ",this.searchKey,this.listKey),t.searchKey=jQuery(t.container).find('[data-view="search"]').attr("vkey"),t.listKey=jQuery(t.container).find('[data-view="list"]').attr("vkey"),t.app.getView(this.searchKey).custom_actions.ActionSearch=ActionSearch.extend({execute:function(){var e=app.getView(t.listKey),a=app.getView(t.searchKey),n=e.getRoute(),r=a.getFormData();n.params=jQuery.extend(r,n.extra_params),e.setRoute(n),app.renderView(t.listKey)}}),e()},actionSearch:function(){},_template:function(){return'\n            <div id="tabContent">\n                <div class="collapse in" data-collapse_list>\n                    <header id="page-header">\n                        <div class="panel panel-default">\n                            <div class="panel-heading">\n                                  <span class="title elipsis"> \n                                    <strong data-html="app.translate(\'model-\' + modelName)"></strong>\n                                  </span>\n                            </div>\n                        </div>\n                    </header>\n            \n                    <div class="padding-15">\n                        <div data-view="search"\n                                    data-attrs="{\n                                        model_name:modelName,\n                                        constraint_key:constraintKey,\n                                        constraint_value:constraintValue,\n                                        id:\'search_\'+id,\n                                       \n                                    }"\n                                    class="viewSearch"\n                                    model_name="",\n                                    autorender="false"\n                                     \n                        ></div>\n                        <div data-view="list"\n                                    data-attrs="{\n                                        model_name:modelName,\n                                        constraint_key:constraintKey,\n                                        constraint_value:constraintValue,\n                                        id:\'list_\'+id,\n                                    }"\n                                    class="viewList"\n                                    model_name="",\n                                    autorender="false"\n                                     \n                        ></div>\n                    </div>\n                </div>\n            </div>\n        '}}),DashboardInsert=Dashboard.extend({_template:function(){return'\n            <div>\n                <div class="panel panel-default">\n                    <div class="panel-heading">\n                          <span class="title elipsis"> \n                            <strong data-html="\'Inserimento \' + app.translate(\'model-\' + modelName)"></strong>\n                          </span>\n                    </div>\n                </div>           \n                <div data-view="insert"\n                                        data-attrs="{\n                                            model_name:modelName,\n                                            constraint_key:constraintKey,\n                                            constraint_value:constraintValue,\n                                            id:\'insert_\'+id\n                                          \n                                        }"\n                                        class="viewInsert" \n                                      \n                                        autorender="false" >\n                            \n                </div>\n            </div>\n        '}}),DashboardSearch=Dashboard.extend({_template:function(){return'\n            <div data-view="search"\n                                    data-attrs="{\n                                        model_name:modelName,\n                                        constraint_key:constraintKey,\n                                        constraint_value:constraintValue,\n                                        id:\'search_\'+id,\n                                        pk : pk\n                                    }"\n                                    class="viewSearch" \n                                    \n                                    model="" \n                                    autorender="false" >\n                        \n            </div>\n        '}}),DashboardView=Dashboard.extend({init:function(e){this.tplVars.id=e.id,this.tplVars.pk=e.pk,this._super(e)},_template:function(){return'\n            <div data-view="view"\n                                    data-attrs="{\n                                        model_name:modelName,\n                                        constraint_key:constraintKey,\n                                        constraint_value:constraintValue,\n                                        id:\'edit_\'+id,\n                                        pk : pk\n                                    }"\n                                    class="viewView" \n                                    \n                                    model="" \n                                    autorender="false" >\n                        \n            </div>\n        '}}),Dashboard2Columns=Dashboard.extend({reloadList:!1,searchKey:null,listKey:null,editKey:null,insertKey:null,viewKey:null,finalize:function(e){var t=this;t.searchKey=jQuery(t.container).find('[data-view="search"]').attr("vkey"),t.listKey=jQuery(t.container).find('[data-view="list"]').attr("vkey"),t.editKey=jQuery(t.container).find('[data-view="edit"]').attr("vkey"),t.insertKey=jQuery(t.container).find('[data-view="insert"]').attr("vkey"),t.viewKey=jQuery(t.container).find('[data-view="view"]').attr("vkey");var a=app.getView(t.listKey);a.dashboardInstance=t,a.actions.indexOf("ActionEdit")>=0&&(a.custom_actions.ActionEdit?a.custom_actions.ActionEdit=a.custom_actions.ActionEdit.extend({execute:function(){this._super()}}):a.custom_actions.ActionEdit=ActionEdit.extend({execute:function(){var e=this;e.view.dashboardInstance.showEdit(e.modelData.id)}})),a.actions.indexOf("ActionView")>=0&&(a.custom_actions.ActionView?a.custom_actions.ActionView=a.custom_actions.ActionView.extend({execute:function(){this._super()}}):a.custom_actions.ActionView=ActionView.extend({execute:function(){var e=this;e.view.dashboardInstance.showVista(e.modelData.id)}})),a.actions.indexOf("ActionInsert")>=0&&(a.custom_actions.ActionInsert?a.custom_actions.ActionInsert=a.custom_actions.ActionInsert.extend({execute:function(){this._super()}}):a.custom_actions.ActionInsert=ActionInsert.extend({execute:function(){var e=this;e.view.dashboardInstance.showInsert()}}));var n=ActionSave.extend({execute:function(){var e=this;e.view.dashboardInstance.reloadList=!0,this._super()},callback:function(){var e=this;e.view.dashboardInstance.showList()}});return app.getView(t.editKey)&&(app.getView(t.editKey).dashboardInstance=t,app.getView(t.editKey).custom_actions.ActionSave=n,app.getView(t.insertKey).actions=_.without(app.getView(t.insertKey).actions,"actionBack")),app.getView(t.insertKey)&&(app.getView(t.insertKey).dashboardInstance=t,app.getView(t.insertKey).custom_actions.ActionSave=n,app.getView(t.insertKey).actions=_.without(app.getView(t.insertKey).actions,"actionBack")),app.getView(t.searchKey)&&(app.getView(t.searchKey).dashboardInstance=t,app.getView(t.searchKey).custom_actions.ActionSearch=ActionSearch.extend({execute:function(){var e=this,t=app.getView(e.view.dashboardInstance.listKey),a=app.getView(e.view.dashboardInstance.searchKey),n=t.getRoute(),r=a.getFormData();n.params=jQuery.extend(r,n.extra_params),t.setRoute(n),app.renderView(e.view.dashboardInstance.listKey)}})),t.showInsert(),e()},showVista:function(e){var t=this;jQuery(t.container).find('[data-view_container="view"]').removeClass("hide"),jQuery(t.container).find('[data-view_container="edit"]').addClass("hide"),jQuery(t.container).find('[data-view_container="insert"]').addClass("hide"),jQuery("[data-view_title]").html("Vista "+t.app.translate("model-"+t.tplVars.modelName));var a=app.getView(t.viewKey);a.pk=e,app.renderView(a.keyId)},showList:function(){var e=this;e.reloadList&&(e.reloadList=!1,app.renderView(e.listKey))},showInsert:function(){var e=this;jQuery(e.container).find('[data-view_container="insert"]').removeClass("hide"),jQuery(e.container).find('[data-view_container="edit"]').addClass("hide"),jQuery(e.container).find('[data-view_container="view"]').addClass("hide"),jQuery("[data-insert_title]").html("inserimento "+e.app.translate("model-"+e.tplVars.modelName));var t=app.getView(e.insertKey);app.renderView(t.keyId)},showEdit:function(e){var t=this;jQuery(t.container).find('[data-view_container="edit"]').removeClass("hide"),jQuery(t.container).find('[data-view_container="insert"]').addClass("hide"),jQuery(t.container).find('[data-view_container="view"]').addClass("hide"),jQuery("[data-edit_title]").html("modifica "+t.app.translate("model-"+t.tplVars.modelName));var a=app.getView(t.editKey);a.pk=e,app.renderView(a.keyId)},_template:function(){return'\n            <div id="tabContent"> \n                <header id="page-header">\n                    <div class="panel panel-default">\n                        <div class="panel-heading">\n                              <span class="title elipsis">\n                                    <strong data-html="app.translate(\'model-\' + modelName)"></strong>\n                              </span>\n                        </div>\n                    </div>\n                </header>\n                <div>\n                    <div class="col col-xs-6">\n                        <div data-view="search" \n                            data-attrs="{\n                                            model_name:modelName,\n                                            constraint_key:constraintKey,\n                                            constraint_value:constraintValue,\n                                            id:\'view_\'+id,\n        \n                                        }"\n                        ></div>\n                        <div data-view="list" \n                            data-attrs="{\n                                            model_name:modelName,\n                                            constraint_key:constraintKey,\n                                            constraint_value:constraintValue,\n                                            id:\'view_\'+id,\n        \n                                        }"\n                        ></div>\n                    </div>\n                    <div class="col col-xs-6">\n                        <div data-view_container="edit">\n                            <h4 data-edit_title></h4>\n                            <div data-view="edit" \n                                data-attrs="{\n                                            model_name:modelName,\n                                            constraint_key:constraintKey,\n                                            constraint_value:constraintValue,\n                                            id:\'view_\'+id,\n        \n                                        }"\n                                        autorender="false">\n                                       \n                            </div>\n                        </div>\n                        <div data-view_container="insert">\n                            <h4 data-insert_title></h4>\n                            <div data-view="insert"\n                                data-attrs="{\n                                                model_name:modelName,\n                                                constraint_key:constraintKey,\n                                                constraint_value:constraintValue,\n                                                id:\'view_\'+id,\n            \n                                            }"\n                            \n                            ></div>\n                        </div>\n                        <div data-view_container="view">\n                            <h4 data-view_title></h4>\n                            <div data-view="view"\n                                 data-attrs="{\n                                    model_name:modelName,\n                                    constraint_key:constraintKey,\n                                    constraint_value:constraintValue,\n                                    id:\'view_\'+id,\n\n                                }"\n                                 model_name=""\n                                 autorender="false"\n                            ></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '}});